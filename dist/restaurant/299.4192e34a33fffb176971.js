"use strict";(self.webpackChunkang_fire=self.webpackChunkang_fire||[]).push([[299],{9805:(It,Ne,D)=>{D.d(Ne,{ST:()=>Ns});var m=D(2741),Z=D(8846),w=D(3948),j=D(2850),P=D(267),L=D(8682),W=D(8744);function S(){return E=>E.lift(new ce)}class ce{call(l,d){return d.subscribe(new R(l))}}class R extends W.L{constructor(l){super(l),this.hasPrev=!1}_next(l){let d;this.hasPrev?d=[this.prev,l]:this.hasPrev=!0,this.prev=l,d&&this.destination.next(d)}}var He=D(3543),ve=D(8561),tt=D(1310),lr=D(7689),Et=D(3305),Tt=D(9106),Y=D(6274),M=(D(2136),D(6043)),_=D(9665),H=D(9870),nt=D(3552);function Tn(E,l){if(void 0===l)return{merge:!1};if(void 0!==l.mergeFields&&void 0!==l.merge)throw new _.WA("invalid-argument",`Invalid options passed to function ${E}(): You cannot specify both "merge" and "mergeFields".`);return l}function hr(){if("undefined"==typeof Uint8Array)throw new _.WA("unimplemented","Uint8Arrays are not available in this environment.")}function ws(){if(!(0,_.Me)())throw new _.WA("unimplemented","Blobs are unavailable in Firestore in this environment.")}class xt{constructor(l){this._delegate=l}static fromBase64String(l){return ws(),new xt(_.Jj.fromBase64String(l))}static fromUint8Array(l){return hr(),new xt(_.Jj.fromUint8Array(l))}toBase64(){return ws(),this._delegate.toBase64()}toUint8Array(){return hr(),this._delegate.toUint8Array()}isEqual(l){return this._delegate.isEqual(l._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function qt(E){return function(E,l){if("object"!=typeof E||null===E)return!1;const d=E;for(const v of["next","error","complete"])if(v in d&&"function"==typeof d[v])return!0;return!1}(E)}class _s{enableIndexedDbPersistence(l,d){return(0,_.ST)(l._delegate,{forceOwnership:d})}enableMultiTabIndexedDbPersistence(l){return(0,_.fH)(l._delegate)}clearIndexedDbPersistence(l){return(0,_.Fc)(l._delegate)}}class we{constructor(l,d,v){this._delegate=d,this._persistenceProvider=v,this.INTERNAL={delete:()=>this.terminate()},l instanceof _.l7||(this._appCompat=l)}get _databaseId(){return this._delegate._databaseId}settings(l){const d=this._delegate._getSettings();!l.merge&&d.host!==l.host&&(0,_.yq)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),l.merge&&delete(l=Object.assign(Object.assign({},d),l)).merge,this._delegate._setSettings(l)}useEmulator(l,d,v={}){(0,_.at)(this._delegate,l,d,v)}enableNetwork(){return(0,_.Ix)(this._delegate)}disableNetwork(){return(0,_.TF)(this._delegate)}enablePersistence(l){let d=!1,v=!1;return l&&(d=!!l.synchronizeTabs,v=!!l.experimentalForceOwningTab,(0,_.Wi)("synchronizeTabs",d,"experimentalForceOwningTab",v)),d?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,v)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return(0,_.Mx)(this._delegate)}onSnapshotsInSync(l){return(0,_.sc)(this._delegate,l)}get app(){if(!this._appCompat)throw new _.WA("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(l){try{return new mt(this,(0,_.hJ)(this._delegate,l))}catch(d){throw _e(d,"collection()","Firestore.collection()")}}doc(l){try{return new Fe(this,(0,_.JU)(this._delegate,l))}catch(d){throw _e(d,"doc()","Firestore.doc()")}}collectionGroup(l){try{return new se(this,(0,_.B$)(this._delegate,l))}catch(d){throw _e(d,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(l){return(0,_.i3)(this._delegate,d=>l(new dr(this,d)))}batch(){return(0,_.qY)(this._delegate),new fr(new _.PU(this._delegate,l=>(0,_.GL)(this._delegate,l)))}loadBundle(l){return(0,_.Pb)(this._delegate,l)}namedQuery(l){return(0,_.L$)(this._delegate,l).then(d=>d?new se(this,d):null)}}class St extends _.u7{constructor(l){super(),this.firestore=l}convertBytes(l){return new xt(new _.Jj(l))}convertReference(l){const d=this.convertDocumentKey(l,this.firestore._databaseId);return Fe.forKey(d,this.firestore,null)}}class dr{constructor(l,d){this._firestore=l,this._delegate=d,this._userDataWriter=new St(l)}get(l){const d=gt(l);return this._delegate.get(d).then(v=>new Bt(this._firestore,new _.xU(this._firestore._delegate,this._userDataWriter,v._key,v._document,v.metadata,d.converter)))}set(l,d,v){const C=gt(l);return v?(Tn("Transaction.set",v),this._delegate.set(C,d,v)):this._delegate.set(C,d),this}update(l,d,v,...C){const z=gt(l);return 2===arguments.length?this._delegate.update(z,d):this._delegate.update(z,d,v,...C),this}delete(l){const d=gt(l);return this._delegate.delete(d),this}}class fr{constructor(l){this._delegate=l}set(l,d,v){const C=gt(l);return v?(Tn("WriteBatch.set",v),this._delegate.set(C,d,v)):this._delegate.set(C,d),this}update(l,d,v,...C){const z=gt(l);return 2===arguments.length?this._delegate.update(z,d):this._delegate.update(z,d,v,...C),this}delete(l){const d=gt(l);return this._delegate.delete(d),this}commit(){return this._delegate.commit()}}class rt{constructor(l,d,v){this._firestore=l,this._userDataWriter=d,this._delegate=v}fromFirestore(l,d){const v=new _.$q(this._firestore._delegate,this._userDataWriter,l._key,l._document,l.metadata,null);return this._delegate.fromFirestore(new Kt(this._firestore,v),null!=d?d:{})}toFirestore(l,d){return d?this._delegate.toFirestore(l,d):this._delegate.toFirestore(l)}static getInstance(l,d){const v=rt.INSTANCES;let C=v.get(l);C||(C=new WeakMap,v.set(l,C));let z=C.get(d);return z||(z=new rt(l,new St(l),d),C.set(d,z)),z}}rt.INSTANCES=new WeakMap;class Fe{constructor(l,d){this.firestore=l,this._delegate=d,this._userDataWriter=new St(l)}static forPath(l,d,v){if(l.length%2!=0)throw new _.WA("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${l.canonicalString()} has ${l.length}`);return new Fe(d,new _.my(d._delegate,v,new _.Ky(l)))}static forKey(l,d,v){return new Fe(d,new _.my(d._delegate,v,l))}get id(){return this._delegate.id}get parent(){return new mt(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(l){try{return new mt(this.firestore,(0,_.hJ)(this._delegate,l))}catch(d){throw _e(d,"collection()","DocumentReference.collection()")}}isEqual(l){return(l=(0,H.m9)(l))instanceof _.my&&(0,_.Eo)(this._delegate,l)}set(l,d){d=Tn("DocumentReference.set",d);try{return d?(0,_.pl)(this._delegate,l,d):(0,_.pl)(this._delegate,l)}catch(v){throw _e(v,"setDoc()","DocumentReference.set()")}}update(l,d,...v){try{return 1===arguments.length?(0,_.r7)(this._delegate,l):(0,_.r7)(this._delegate,l,d,...v)}catch(C){throw _e(C,"updateDoc()","DocumentReference.update()")}}delete(){return(0,_.oe)(this._delegate)}onSnapshot(...l){const d=mr(l),v=Sn(l,C=>new Bt(this.firestore,new _.xU(this.firestore._delegate,this._userDataWriter,C._key,C._document,C.metadata,this._delegate.converter)));return(0,_.cf)(this._delegate,d,v)}get(l){let d;return d="cache"===(null==l?void 0:l.source)?(0,_.kl)(this._delegate):"server"===(null==l?void 0:l.source)?(0,_.Xk)(this._delegate):(0,_.QT)(this._delegate),d.then(v=>new Bt(this.firestore,new _.xU(this.firestore._delegate,this._userDataWriter,v._key,v._document,v.metadata,this._delegate.converter)))}withConverter(l){return new Fe(this.firestore,this._delegate.withConverter(l?rt.getInstance(this.firestore,l):null))}}function _e(E,l,d){return E.message=E.message.replace(l,d),E}function mr(E){for(const l of E)if("object"==typeof l&&!qt(l))return l;return{}}function Sn(E,l){var d,v;let C;return C=qt(E[0])?E[0]:qt(E[1])?E[1]:"function"==typeof E[0]?{next:E[0],error:E[1],complete:E[2]}:{next:E[1],error:E[2],complete:E[3]},{next:z=>{C.next&&C.next(l(z))},error:null===(d=C.error)||void 0===d?void 0:d.bind(C),complete:null===(v=C.complete)||void 0===v?void 0:v.bind(C)}}class Bt{constructor(l,d){this._firestore=l,this._delegate=d}get ref(){return new Fe(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(l){return this._delegate.data(l)}get(l,d){return this._delegate.get(l,d)}isEqual(l){return(0,_.qK)(this._delegate,l._delegate)}}class Kt extends Bt{data(l){const d=this._delegate.data(l);return(0,_.K9)(void 0!==d,"Document in a QueryDocumentSnapshot should exist"),d}}class se{constructor(l,d){this.firestore=l,this._delegate=d,this._userDataWriter=new St(l)}where(l,d,v){try{return new se(this.firestore,(0,_.IO)(this._delegate,(0,_.ar)(l,d,v)))}catch(C){throw _e(C,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(l,d){try{return new se(this.firestore,(0,_.IO)(this._delegate,(0,_.Xo)(l,d)))}catch(v){throw _e(v,/(orderBy|where)\(\)/,"Query.$1()")}}limit(l){try{return new se(this.firestore,(0,_.IO)(this._delegate,(0,_.b9)(l)))}catch(d){throw _e(d,"limit()","Query.limit()")}}limitToLast(l){try{return new se(this.firestore,(0,_.IO)(this._delegate,(0,_.vh)(l)))}catch(d){throw _e(d,"limitToLast()","Query.limitToLast()")}}startAt(...l){try{return new se(this.firestore,(0,_.IO)(this._delegate,(0,_.e0)(...l)))}catch(d){throw _e(d,"startAt()","Query.startAt()")}}startAfter(...l){try{return new se(this.firestore,(0,_.IO)(this._delegate,(0,_.TQ)(...l)))}catch(d){throw _e(d,"startAfter()","Query.startAfter()")}}endBefore(...l){try{return new se(this.firestore,(0,_.IO)(this._delegate,(0,_.Lx)(...l)))}catch(d){throw _e(d,"endBefore()","Query.endBefore()")}}endAt(...l){try{return new se(this.firestore,(0,_.IO)(this._delegate,(0,_.Wu)(...l)))}catch(d){throw _e(d,"endAt()","Query.endAt()")}}isEqual(l){return(0,_.iE)(this._delegate,l._delegate)}get(l){let d;return d="cache"===(null==l?void 0:l.source)?(0,_.UQ)(this._delegate):"server"===(null==l?void 0:l.source)?(0,_.zN)(this._delegate):(0,_.PL)(this._delegate),d.then(v=>new jt(this.firestore,new _.W(this.firestore._delegate,this._userDataWriter,this._delegate,v._snapshot)))}onSnapshot(...l){const d=mr(l),v=Sn(l,C=>new jt(this.firestore,new _.W(this.firestore._delegate,this._userDataWriter,this._delegate,C._snapshot)));return(0,_.cf)(this._delegate,d,v)}withConverter(l){return new se(this.firestore,this._delegate.withConverter(l?rt.getInstance(this.firestore,l):null))}}class Is{constructor(l,d){this._firestore=l,this._delegate=d}get type(){return this._delegate.type}get doc(){return new Kt(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class jt{constructor(l,d){this._firestore=l,this._delegate=d}get query(){return new se(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(l=>new Kt(this._firestore,l))}docChanges(l){return this._delegate.docChanges(l).map(d=>new Is(this._firestore,d))}forEach(l,d){this._delegate.forEach(v=>{l.call(d,new Kt(this._firestore,v))})}isEqual(l){return(0,_.qK)(this._delegate,l._delegate)}}class mt extends se{constructor(l,d){super(l,d),this.firestore=l,this._delegate=d}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const l=this._delegate.parent;return l?new Fe(this.firestore,l):null}doc(l){try{return new Fe(this.firestore,void 0===l?(0,_.JU)(this._delegate):(0,_.JU)(this._delegate,l))}catch(d){throw _e(d,"doc()","CollectionReference.doc()")}}add(l){return(0,_.ET)(this._delegate,l).then(d=>new Fe(this.firestore,d))}isEqual(l){return(0,_.Eo)(this._delegate,l._delegate)}withConverter(l){return new mt(this.firestore,this._delegate.withConverter(l?rt.getInstance(this.firestore,l):null))}}function gt(E){return(0,_.Cf)(E,_.my)}class bn{constructor(...l){this._delegate=new _.Lz(...l)}static documentId(){return new bn(_.Xb.keyField().canonicalString())}isEqual(l){return(l=(0,H.m9)(l))instanceof _.Lz&&this._delegate._internalPath.isEqual(l._internalPath)}}class Ze{constructor(l){this._delegate=l}static serverTimestamp(){const l=(0,_.Bt)();return l._methodName="FieldValue.serverTimestamp",new Ze(l)}static delete(){const l=(0,_.AK)();return l._methodName="FieldValue.delete",new Ze(l)}static arrayUnion(...l){const d=(0,_.vr)(...l);return d._methodName="FieldValue.arrayUnion",new Ze(d)}static arrayRemove(...l){const d=(0,_.Ab)(...l);return d._methodName="FieldValue.arrayRemove",new Ze(d)}static increment(l){const d=(0,_.nP)(l);return d._methodName="FieldValue.increment",new Ze(d)}isEqual(l){return this._delegate.isEqual(l._delegate)}}const gr={Firestore:we,GeoPoint:_.F8,Timestamp:_.EK,Blob:xt,Transaction:dr,WriteBatch:fr,DocumentReference:Fe,DocumentSnapshot:Bt,Query:se,QueryDocumentSnapshot:Kt,QuerySnapshot:jt,CollectionReference:mt,FieldPath:bn,FieldValue:Ze,setLogLevel:function(E){(0,_.Ub)(E)},CACHE_SIZE_UNLIMITED:_.IX};var E;(function(E,l){E.INTERNAL.registerComponent(new nt.wA("firestore-compat",d=>((l,d)=>new we(l,d,new _s))(d.getProvider("app-compat").getImmediate(),d.getProvider("firestore").getImmediate()),"PUBLIC").setServiceProps(Object.assign({},gr)))})(E=M.Z),E.registerVersion("@firebase/firestore-compat","0.1.14");var ot=D(4259),qi=D(7240);function xs(E,l){return function(E,l=Z.z){return new w.y(d=>{let v;return null!=l?l.schedule(()=>{v=E.onSnapshot({includeMetadataChanges:!0},d)}):v=E.onSnapshot({includeMetadataChanges:!0},d),()=>{null!=v&&v()}})}(E,l)}function le(E,l){return xs(E,l).pipe((0,ve.U)(d=>({payload:d,type:"query"})))}function at(E,l){return le(E,l).pipe((0,He.O)(void 0),S(),(0,ve.U)(([d,v])=>{const C=v.payload.docChanges(),z=C.map(G=>({type:G.type,payload:G}));return d&&JSON.stringify(d.payload.metadata)!==JSON.stringify(v.payload.metadata)&&v.payload.docs.forEach((G,X)=>{const ut=C.find(Qt=>Qt.doc.ref.isEqual(G.ref)),bt=null==d?void 0:d.payload.docs.find(Qt=>Qt.ref.isEqual(G.ref));ut&&JSON.stringify(ut.doc.metadata)===JSON.stringify(G.metadata)||!ut&&bt&&JSON.stringify(bt.metadata)===JSON.stringify(G.metadata)||z.push({type:"modified",payload:{oldIndex:X,newIndex:X,type:"modified",doc:G}})}),z}))}function Ss(E,l,d){return at(E,d).pipe((0,tt.R)((v,C)=>function(E,l,d){return l.forEach(v=>{d.indexOf(v.type)>-1&&(E=function(E,l){switch(l.type){case"added":if(!E[l.newIndex]||!E[l.newIndex].doc.ref.isEqual(l.doc.ref))return vr(E,l.newIndex,0,l);break;case"modified":if(null==E[l.oldIndex]||E[l.oldIndex].doc.ref.isEqual(l.doc.ref)){if(l.oldIndex!==l.newIndex){const d=E.slice();return d.splice(l.oldIndex,1),d.splice(l.newIndex,0,l),d}return vr(E,l.newIndex,1,l)}break;case"removed":if(E[l.oldIndex]&&E[l.oldIndex].doc.ref.isEqual(l.doc.ref))return vr(E,l.oldIndex,1)}return E}(E,v))}),E}(v,C.map(z=>z.payload),l),[]),(0,lr.x)(),(0,ve.U)(v=>v.map(C=>({type:C.type,payload:C}))))}function vr(E,l,d,...v){const C=E.slice();return C.splice(l,d,...v),C}function $t(E){return(!E||0===E.length)&&(E=["added","removed","modified"]),E}D(2837);class zt{constructor(l,d,v){this.ref=l,this.query=d,this.afs=v}stateChanges(l){let d=at(this.query,this.afs.schedulers.outsideAngular);return l&&l.length>0&&(d=d.pipe((0,ve.U)(v=>v.filter(C=>l.indexOf(C.type)>-1)))),d.pipe((0,He.O)(void 0),S(),(0,Et.h)(([v,C])=>C.length>0||!v),(0,ve.U)(([v,C])=>C),L.iC)}auditTrail(l){return this.stateChanges(l).pipe((0,tt.R)((d,v)=>[...d,...v],[]))}snapshotChanges(l){const d=$t(l);return Ss(this.query,d,this.afs.schedulers.outsideAngular).pipe(L.iC)}valueChanges(l={}){return le(this.query,this.afs.schedulers.outsideAngular).pipe((0,ve.U)(d=>d.payload.docs.map(v=>l.idField?Object.assign(Object.assign({},v.data()),{[l.idField]:v.id}):v.data())),L.iC)}get(l){return(0,j.D)(this.query.get(l)).pipe(L.iC)}add(l){return this.ref.add(l)}doc(l){return new An(this.ref.doc(l),this.afs)}}class An{constructor(l,d){this.ref=l,this.afs=d}set(l,d){return this.ref.set(l,d)}update(l){return this.ref.update(l)}delete(){return this.ref.delete()}collection(l,d){const v=this.ref.collection(l),{ref:C,query:z}=Cs(v,d);return new zt(C,z,this.afs)}snapshotChanges(){return function(E,l){return xs(E,l).pipe((0,He.O)(void 0),S(),(0,ve.U)(([d,v])=>v.exists?(null==d?void 0:d.exists)?{payload:v,type:"modified"}:{payload:v,type:"added"}:{payload:v,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(L.iC)}valueChanges(l={}){return this.snapshotChanges().pipe((0,ve.U)(({payload:d})=>l.idField?Object.assign(Object.assign({},d.data()),{[l.idField]:d.id}):d.data()))}get(l){return(0,j.D)(this.ref.get(l)).pipe(L.iC)}}class wr{constructor(l,d){this.query=l,this.afs=d}stateChanges(l){return l&&0!==l.length?at(this.query,this.afs.schedulers.outsideAngular).pipe((0,ve.U)(d=>d.filter(v=>l.indexOf(v.type)>-1)),(0,Et.h)(d=>d.length>0),L.iC):at(this.query,this.afs.schedulers.outsideAngular).pipe(L.iC)}auditTrail(l){return this.stateChanges(l).pipe((0,tt.R)((d,v)=>[...d,...v],[]))}snapshotChanges(l){const d=$t(l);return Ss(this.query,d,this.afs.schedulers.outsideAngular).pipe(L.iC)}valueChanges(l={}){return le(this.query,this.afs.schedulers.outsideAngular).pipe((0,ve.U)(v=>v.payload.docs.map(C=>l.idField?Object.assign({[l.idField]:C.id},C.data()):C.data())),L.iC)}get(l){return(0,j.D)(this.query.get(l)).pipe(L.iC)}}const _r=new m.InjectionToken("angularfire2.enableFirestorePersistence"),Ir=new m.InjectionToken("angularfire2.firestore.persistenceSettings"),bs=new m.InjectionToken("angularfire2.firestore.settings"),As=new m.InjectionToken("angularfire2.firestore.use-emulator");function Cs(E,l=(d=>d)){return{query:l(E),ref:E}}let Ns=(()=>{class E{constructor(d,v,C,z,G,X,ut,bt,Qt,Gi,Ds,$i,zi,Er,Tr,Qi,ks){this.schedulers=ut;const Wt=(0,Tt.on)(d,X,v),xr=Qt;Gi&&(0,ot.nw)(Wt,X,Ds,zi,Er,Tr,$i,Qi),[this.firestore,this.persistenceEnabled$]=(0,Tt.cc)(`${Wt.name}.firestore`,"AngularFirestore",Wt.name,()=>{const ct=X.runOutsideAngular(()=>Wt.firestore());if(z&&ct.settings(z),xr&&ct.useEmulator(...xr),C&&!(0,Y.PM)(G)){const Sr=()=>{try{return(0,j.D)(ct.enablePersistence(bt||void 0).then(()=>!0,()=>!1))}catch(br){return"undefined"!=typeof console&&console.warn(br),(0,P.of)(!1)}};return[ct,X.runOutsideAngular(Sr)]}return[ct,(0,P.of)(!1)]},[z,xr,C])}collection(d,v){let C;C="string"==typeof d?this.firestore.collection(d):d;const{ref:z,query:G}=Cs(C,v),X=this.schedulers.ngZone.run(()=>z);return new zt(X,G,this)}collectionGroup(d,v){const C=v||(G=>G),z=this.firestore.collectionGroup(d);return new wr(C(z),this)}doc(d){let v;v="string"==typeof d?this.firestore.doc(d):d;const C=this.schedulers.ngZone.run(()=>v);return new An(C,this)}createId(){return this.firestore.collection("_").doc().id}}return E.\u0275fac=function(d){return new(d||E)(m.\u0275\u0275inject(Tt.Dh),m.\u0275\u0275inject(Tt.xv,8),m.\u0275\u0275inject(_r,8),m.\u0275\u0275inject(bs,8),m.\u0275\u0275inject(m.PLATFORM_ID),m.\u0275\u0275inject(m.NgZone),m.\u0275\u0275inject(L.HU),m.\u0275\u0275inject(Ir,8),m.\u0275\u0275inject(As,8),m.\u0275\u0275inject(ot.zQ,8),m.\u0275\u0275inject(ot.Qv,8),m.\u0275\u0275inject(ot.L6,8),m.\u0275\u0275inject(ot._Q,8),m.\u0275\u0275inject(ot.rT,8),m.\u0275\u0275inject(ot.lh,8),m.\u0275\u0275inject(ot.f7,8),m.\u0275\u0275inject(qi.nm,8))},E.\u0275prov=m.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac,providedIn:"any"}),E})()},9665:(It,Ne,D)=>{D.d(Ne,{u7:()=>vu,Jj:()=>Ut,IX:()=>Ng,my:()=>ae,xU:()=>_n,Lz:()=>Ft,WA:()=>T,F8:()=>Ni,$q:()=>ys,W:()=>In,EK:()=>Ee,PU:()=>Xh,l7:()=>nn,Ky:()=>N,Xb:()=>Te,Cf:()=>B,K9:()=>Fd,Me:()=>zd,yq:()=>Kr,Wi:()=>Ah,ET:()=>gp,Ab:()=>Tp,vr:()=>Ep,Fc:()=>Og,hJ:()=>xg,B$:()=>Sg,at:()=>Tg,oe:()=>mp,AK:()=>_p,TF:()=>Pg,JU:()=>Oh,ST:()=>Dg,fH:()=>kg,Ix:()=>Rg,Wu:()=>sp,Lx:()=>rp,qY:()=>ge,GL:()=>ur,QT:()=>op,kl:()=>ap,Xk:()=>up,PL:()=>cp,UQ:()=>lp,zN:()=>hp,nP:()=>xp,b9:()=>Jg,vh:()=>ep,Pb:()=>Lg,L$:()=>Fg,cf:()=>pp,sc:()=>yp,Xo:()=>Xg,IO:()=>Wg,iE:()=>Mh,Eo:()=>bg,i3:()=>wp,Bt:()=>Ip,pl:()=>dp,Ub:()=>Ld,qK:()=>Qg,TQ:()=>np,e0:()=>tp,r7:()=>fp,Mx:()=>Mg,ar:()=>Zg});var S,m=D(1921),Z=D(4762),w=D(3552),j=D(1773),P=D(9870),L="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},W={},ce=ce||{},R=L||self;function He(){}function ve(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function tt(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Et="closure_uid_"+(1e9*Math.random()>>>0),Tt=0;function Y(n,e,t){return n.call.apply(n.bind,arguments)}function je(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),n.apply(e,s)}}return function(){return n.apply(e,arguments)}}function M(n,e,t){return(M=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Y:je).apply(null,arguments)}function _(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function H(n,e){function t(){}t.prototype=e.prototype,n.Z=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Vb=function(r,s,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(r,o)}}function nt(){this.s=this.s,this.o=this.o}var Vi={};nt.prototype.s=!1,nt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var n=function(n){return Object.prototype.hasOwnProperty.call(n,Et)&&n[Et]||(n[Et]=++Tt)}(this);delete Vi[n]}},nt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Tn=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1},hr=Array.prototype.forEach?function(n,e,t){Array.prototype.forEach.call(n,e,t)}:function(n,e,t){const r=n.length,s="string"==typeof n?n.split(""):n;for(let i=0;i<r;i++)i in s&&e.call(t,s[i],i,n)};function xt(n){return Array.prototype.concat.apply([],arguments)}function qt(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function xn(n){return/^[\s\xa0]*$/.test(n)}var De,_s=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function we(n,e){return-1!=n.indexOf(e)}function St(n,e){return n<e?-1:n>e?1:0}e:{var dr=R.navigator;if(dr){var fr=dr.userAgent;if(fr){De=fr;break e}}De=""}function rt(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function Fe(n){const e={};for(const t in n)e[t]=n[t];return e}var _e="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function mr(n,e){let t,r;for(let s=1;s<arguments.length;s++){for(t in r=arguments[s],r)n[t]=r[t];for(let i=0;i<_e.length;i++)t=_e[i],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Sn(n){return Sn[" "](n),n}Sn[" "]=He;var Ze,n,Kt=we(De,"Opera"),se=we(De,"Trident")||we(De,"MSIE"),Is=we(De,"Edge"),jt=Is||se,mt=we(De,"Gecko")&&!(we(De.toLowerCase(),"webkit")&&!we(De,"Edge"))&&!(we(De,"Trident")||we(De,"MSIE"))&&!we(De,"Edge"),gt=we(De.toLowerCase(),"webkit")&&!we(De,"Edge");function bn(){var n=R.document;return n?n.documentMode:void 0}e:{var gr="",pr=(n=De,mt?/rv:([^\);]+)(\)|;)/.exec(n):Is?/Edge\/([\d\.]+)/.exec(n):se?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):gt?/WebKit\/(\S+)/.exec(n):Kt?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(pr&&(gr=pr?pr[1]:""),se){var yr=bn();if(null!=yr&&yr>parseFloat(gr)){Ze=String(yr);break e}}Ze=gr}var ot={};function qi(){return e=ot,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let n=0;const e=_s(String(Ze)).split("."),t=_s("9").split("."),r=Math.max(e.length,t.length);for(let o=0;0==n&&o<r;o++){var s=e[o]||"",i=t[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==s[0].length&&0==i[0].length)break;n=St(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||St(0==s[2].length,0==i[2].length)||St(s[2],i[2]),s=s[3],i=i[3]}while(0==n)}return 0<=n}();var e}var xs=R.document&&se&&(bn()||parseInt(Ze,10))||void 0,Bi=function(){if(!R.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{R.addEventListener("test",He,e),R.removeEventListener("test",He,e)}catch(t){}return n}();function le(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}function at(n,e){if(le.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(mt){e:{try{Sn(e.nodeName);var s=!0;break e}catch(i){}s=!1}s||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Ss[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&at.Z.h.call(this)}}le.prototype.h=function(){this.defaultPrevented=!0},H(at,le);var Ss={2:"touch",3:"pen",4:"mouse"};at.prototype.h=function(){at.Z.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Gt="closure_listenable_"+(1e6*Math.random()|0),vr=0;function Ki(n,e,t,r,s){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ia=s,this.key=++vr,this.ca=this.fa=!1}function $t(n){n.ca=!0,n.listener=null,n.proxy=null,n.src=null,n.ia=null}function zt(n){this.src=n,this.g={},this.h=0}function An(n,e){var t=e.type;if(t in n.g){var i,r=n.g[t],s=Tn(r,e);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&($t(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function wr(n,e,t,r){for(var s=0;s<n.length;++s){var i=n[s];if(!i.ca&&i.listener==e&&i.capture==!!t&&i.ia==r)return s}return-1}zt.prototype.add=function(n,e,t,r,s){var i=n.toString();(n=this.g[i])||(n=this.g[i]=[],this.h++);var o=wr(n,e,r,s);return-1<o?(e=n[o],t||(e.fa=!1)):((e=new Ki(e,this.src,i,!!r,s)).fa=t,n.push(e)),e};var _r="closure_lm_"+(1e6*Math.random()|0),Ir={};function bs(n,e,t,r,s){if(r&&r.once)return Ns(n,e,t,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)bs(n,e[i],t,r,s);return null}return t=z(t),n&&n[Gt]?n.N(e,t,tt(r)?!!r.capture:!!r,s):As(n,e,t,!1,r,s)}function As(n,e,t,r,s,i){if(!e)throw Error("Invalid event type");var o=tt(s)?!!s.capture:!!s,a=v(n);if(a||(n[_r]=a=new zt(n)),(t=a.add(e,t,r,o,i)).proxy)return t;if(r=function(){var e=d;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)Bi||(s=o),void 0===s&&(s=!1),n.addEventListener(e.toString(),r,s);else if(n.attachEvent)n.attachEvent(l(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function Ns(n,e,t,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)Ns(n,e[i],t,r,s);return null}return t=z(t),n&&n[Gt]?n.O(e,t,tt(r)?!!r.capture:!!r,s):As(n,e,t,!0,r,s)}function ji(n,e,t,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)ji(n,e[i],t,r,s);else r=tt(r)?!!r.capture:!!r,t=z(t),n&&n[Gt]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=wr(i=n.g[e],t,r,s))&&($t(i[t]),Array.prototype.splice.call(i,t,1),0==i.length&&(delete n.g[e],n.h--))):n&&(n=v(n))&&(e=n.g[e.toString()],n=-1,e&&(n=wr(e,t,r,s)),(t=-1<n?e[n]:null)&&E(t))}function E(n){if("number"!=typeof n&&n&&!n.ca){var e=n.src;if(e&&e[Gt])An(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(l(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=v(e))?(An(t,n),0==t.h&&(t.src=null,e[_r]=null)):$t(n)}}}function l(n){return n in Ir?Ir[n]:Ir[n]="on"+n}function d(n,e){if(n.ca)n=!0;else{e=new at(e,this);var t=n.listener,r=n.ia||n.src;n.fa&&E(n),n=t.call(r,e)}return n}function v(n){return(n=n[_r])instanceof zt?n:null}var C="__closure_events_fn_"+(1e9*Math.random()>>>0);function z(n){return"function"==typeof n?n:(n[C]||(n[C]=function(e){return n.handleEvent(e)}),n[C])}function G(){nt.call(this),this.i=new zt(this),this.P=this,this.I=null}function X(n,e){var t,r=n.I;if(r)for(t=[];r;r=r.I)t.push(r);if(n=n.P,r=e.type||e,"string"==typeof e)e=new le(e,n);else if(e instanceof le)e.target=e.target||n;else{var s=e;mr(e=new le(r,n),s)}if(s=!0,t)for(var i=t.length-1;0<=i;i--){var o=e.g=t[i];s=ut(o,r,!0,e)&&s}if(s=ut(o=e.g=n,r,!0,e)&&s,s=ut(o,r,!1,e)&&s,t)for(i=0;i<t.length;i++)s=ut(o=e.g=t[i],r,!1,e)&&s}function ut(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ca&&o.capture==t){var a=o.listener,u=o.ia||o.src;o.fa&&An(n.i,o),s=!1!==a.call(u,r)&&s}}return s&&!r.defaultPrevented}H(G,nt),G.prototype[Gt]=!0,G.prototype.removeEventListener=function(n,e,t,r){ji(this,n,e,t,r)},G.prototype.M=function(){if(G.Z.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)$t(t[r]);delete n.g[e],n.h--}}this.I=null},G.prototype.N=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},G.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var bt=R.JSON.stringify;function Qt(){var n=Wt;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Tr,Ds=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new $i,n=>n.reset());class $i{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function zi(n){R.setTimeout(()=>{throw n},0)}function Er(n,e){Tr||function(){var n=R.Promise.resolve(void 0);Tr=function(){n.then(xr)}}(),ks||(Tr(),ks=!0),Wt.add(n,e)}var ks=!1,Wt=new class{constructor(){this.h=this.g=null}add(e,t){const r=Ds.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}};function xr(){for(var n;n=Qt();){try{n.h.call(n.g)}catch(t){zi(t)}var e=Ds;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}ks=!1}function ct(n,e){G.call(this),this.h=n||1,this.g=e||R,this.j=M(this.kb,this),this.l=Date.now()}function Sr(n){n.da=!1,n.S&&(n.g.clearTimeout(n.S),n.S=null)}function br(n,e,t){if("function"==typeof n)t&&(n=M(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=M(n.handleEvent,n)}return 2147483647<Number(e)?-1:R.setTimeout(n,e||0)}function _u(n){n.g=br(()=>{n.g=null,n.i&&(n.i=!1,_u(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}H(ct,G),(S=ct.prototype).da=!1,S.S=null,S.kb=function(){if(this.da){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-n):(this.S&&(this.g.clearTimeout(this.S),this.S=null),X(this,"tick"),this.da&&(Sr(this),this.start()))}},S.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},S.M=function(){ct.Z.M.call(this),Sr(this),delete this.g};class td extends nt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:_u(this)}M(){super.M(),this.g&&(R.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ar(n){nt.call(this),this.h=n,this.g={}}H(Ar,nt);var Iu=[];function Eu(n,e,t,r){Array.isArray(t)||(t&&(Iu[0]=t.toString()),t=Iu);for(var s=0;s<t.length;s++){var i=bs(e,t[s],r||n.handleEvent,!1,n.h||n);if(!i)break;n.g[i.key]=i}}function Tu(n){rt(n.g,function(e,t){this.g.hasOwnProperty(t)&&E(e)},n),n.g={}}function Os(){this.g=!0}function Cn(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return bt(t)}catch(a){return e}}(n,t)+(r?" "+r:"")})}Ar.prototype.M=function(){Ar.Z.M.call(this),Tu(this)},Ar.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Os.prototype.Aa=function(){this.g=!1},Os.prototype.info=function(){};var Ht={},xu=null;function Ms(){return xu=xu||new G}function Su(n){le.call(this,Ht.Ma,n)}function Cr(n){const e=Ms();X(e,new Su(e,n))}function bu(n,e){le.call(this,Ht.STAT_EVENT,n),this.stat=e}function Ue(n){const e=Ms();X(e,new bu(e,n))}function Au(n,e){le.call(this,Ht.Na,n),this.size=e}function Nr(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return R.setTimeout(function(){n()},e)}Ht.Ma="serverreachability",H(Su,le),Ht.STAT_EVENT="statevent",H(bu,le),Ht.Na="timingevent",H(Au,le);var Rs={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Cu={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Wi(){}function Du(){}Wi.prototype.h=null;var Yi,Dr={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Hi(){le.call(this,"d")}function Zi(){le.call(this,"c")}function Ps(){}function kr(n,e,t,r){this.l=n,this.j=e,this.m=t,this.X=r||1,this.V=new Ar(this),this.P=od,this.W=new ct(n=jt?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ku}function ku(){this.i=null,this.g="",this.h=!1}H(Hi,le),H(Zi,le),H(Ps,Wi),Ps.prototype.g=function(){return new XMLHttpRequest},Ps.prototype.i=function(){return{}},Yi=new Ps;var od=45e3,Xi={},Ls={};function Ji(n,e,t){n.K=1,n.v=Bs(pt(e)),n.s=t,n.U=!0,Ou(n,null)}function Ou(n,e){n.F=Date.now(),Or(n),n.A=pt(n.v);var t=n.A,r=n.X;Array.isArray(r)||(r=[String(r)]),Bu(t.h,"t",r),n.C=0,t=n.l.H,n.h=new ku,n.g=lc(n.l,t?e:null,!n.s),0<n.O&&(n.L=new td(M(n.Ia,n,n.g),n.O)),Eu(n.V,n.g,"readystatechange",n.gb),e=n.H?Fe(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ea(n.A,n.u,n.s,e)):(n.u="GET",n.g.ea(n.A,n.u,null,e)),Cr(1),function(n,e,t,r,s,i){n.info(function(){if(n.g)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var f=h.split("_");o=2<=f.length&&"type"==f[1]?o+(h+"=")+c+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.X,n.s)}function Mu(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Ba}function Ru(n,e,t){let s,r=!0;for(;!n.I&&n.C<t.length;){if(s=ad(n,t),s==Ls){4==e&&(n.o=4,Ue(14),r=!1),Cn(n.j,n.m,null,"[Incomplete Response]");break}if(s==Xi){n.o=4,Ue(15),Cn(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}Cn(n.j,n.m,s,null),eo(n,s)}Mu(n)&&s!=Ls&&s!=Xi&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,Ue(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.aa&&(n.aa=!0,(e=n.l).g==n&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+t.length),ho(e),e.L=!0,Ue(11))):(Cn(n.j,n.m,t,"[Invalid Chunked Response]"),Zt(n),Mr(n))}function ad(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?Ls:(t=Number(e.substring(t,r)),isNaN(t)?Xi:(r+=1)+t>e.length?Ls:(e=e.substr(r,t),n.C=r+t,e))}function Or(n){n.Y=Date.now()+n.P,Pu(n,n.P)}function Pu(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Nr(M(n.eb,n),e)}function Fs(n){n.B&&(R.clearTimeout(n.B),n.B=null)}function Mr(n){0==n.l.G||n.I||oc(n.l,n)}function Zt(n){Fs(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,Sr(n.W),Tu(n.V),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function eo(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||ro(t.i,n)))if(t.I=n.N,!n.J&&ro(t.i,n)&&3==t.G){try{var r=t.Ca.g.parse(e)}catch(c){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0])e:if(t.u)t.ta=s[1],0<t.ta-t.U&&37500>s[2]&&t.N&&0==t.A&&!t.v&&(t.v=Nr(M(t.ab,t),6e3));else{if(t.g){if(!(t.g.F+3e3<n.F))break e;Qs(t),$s(t)}lo(t),Ue(18)}if(1>=Gu(t.i)&&t.ka){try{t.ka()}catch(c){}t.ka=void 0}}else Jt(t,11)}else if((n.J||t.g==n)&&Qs(t),!xn(e))for(s=t.Ca.g.parse(e),e=0;e<s.length;e++){let c=s[e];if(t.U=c[0],c=c[1],2==t.G)if("c"==c[0]){t.J=c[1],t.la=c[2];const h=c[3];null!=h&&(t.ma=h,t.h.info("VER="+t.ma));const f=c[4];null!=f&&(t.za=f,t.h.info("SVER="+t.za));const g=c[5];null!=g&&"number"==typeof g&&0<g&&(t.K=r=1.5*g,t.h.info("backChannelRequestTimeoutMs_="+r)),r=t;const I=n.g;if(I){const x=I.g?I.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(x){var i=r.i;!i.g&&(we(x,"spdy")||we(x,"quic")||we(x,"h2"))&&(i.j=i.l,i.g=new Set,i.h&&(so(i,i.h),i.h=null))}if(r.D){const O=I.g?I.g.getResponseHeader("X-HTTP-Session-Id"):null;O&&(r.sa=O,ee(r.F,r.D,O))}}t.G=3,t.j&&t.j.xa(),t.$&&(t.O=Date.now()-n.F,t.h.info("Handshake RTT: "+t.O+"ms"));var o=n;if((r=t).oa=cc(r,r.H?r.la:null,r.W),o.J){$u(r.i,o);var a=o,u=r.K;u&&a.setTimeout(u),a.B&&(Fs(a),Or(a)),r.g=o}else sc(r);0<t.l.length&&zs(t)}else"stop"!=c[0]&&"close"!=c[0]||Jt(t,7);else 3==t.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Jt(t,7):uo(t):"noop"!=c[0]&&t.j&&t.j.wa(c),t.A=0)}Cr(4)}catch(c){}}function to(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(ve(n)||"string"==typeof n)hr(n,e,void 0);else{if(n.T&&"function"==typeof n.T)var t=n.T();else if(n.R&&"function"==typeof n.R)t=void 0;else if(ve(n)||"string"==typeof n){t=[];for(var r=n.length,s=0;s<r;s++)t.push(s)}else for(s in t=[],r=0,n)t[r++]=s;s=(r=function(n){if(n.R&&"function"==typeof n.R)return n.R();if("string"==typeof n)return n.split("");if(ve(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n)).length;for(var i=0;i<s;i++)e.call(void 0,r[i],t&&t[i],n)}}function Nn(n,e){this.h={},this.g=[],this.i=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var r=0;r<t;r+=2)this.set(arguments[r],arguments[r+1])}else if(n)if(n instanceof Nn)for(t=n.T(),r=0;r<t.length;r++)this.set(t[r],n.get(t[r]));else for(r in n)this.set(r,n[r])}function no(n){if(n.i!=n.g.length){for(var e=0,t=0;e<n.g.length;){var r=n.g[e];Yt(n.h,r)&&(n.g[t++]=r),e++}n.g.length=t}if(n.i!=n.g.length){var s={};for(t=e=0;e<n.g.length;)Yt(s,r=n.g[e])||(n.g[t++]=r,s[r]=1),e++;n.g.length=t}}function Yt(n,e){return Object.prototype.hasOwnProperty.call(n,e)}(S=kr.prototype).setTimeout=function(n){this.P=n},S.gb=function(n){n=n.target;const e=this.L;e&&3==yt(n)?e.l():this.Ia(n)},S.Ia=function(n){try{if(n==this.g)e:{const h=yt(this.g);var e=this.g.Da();const f=this.g.ba();if(!(3>h)&&(3!=h||jt||this.g&&(this.h.h||this.g.ga()||Ju(this.g)))){this.I||4!=h||7==e||Cr(8==e||0>=f?3:2),Fs(this);var t=this.g.ba();this.N=t;t:if(Mu(this)){var r=Ju(this.g);n="";var s=r.length,i=4==yt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Zt(this),Mr(this);var o="";break t}this.h.i=new R.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==t,function(n,e,t,r,s,i,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+t+"\n"+i+" "+o})}(this.j,this.u,this.A,this.m,this.X,h,t),this.i){if(this.$&&!this.J){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!xn(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.o=3,Ue(12),Zt(this),Mr(this);break e}Cn(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,eo(this,t)}this.U?(Ru(this,h,o),jt&&this.i&&3==h&&(Eu(this.V,this.W,"tick",this.fb),this.W.start())):(Cn(this.j,this.m,o,null),eo(this,o)),4==h&&Zt(this),this.i&&!this.I&&(4==h?oc(this.l,this):(this.i=!1,Or(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,Ue(12)):(this.o=0,Ue(13)),Zt(this),Mr(this)}}}catch(h){}},S.fb=function(){if(this.g){var n=yt(this.g),e=this.g.ga();this.C<e.length&&(Fs(this),Ru(this,n,e),this.i&&4!=n&&Or(this))}},S.cancel=function(){this.I=!0,Zt(this)},S.eb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Cr(3),Ue(17)),Zt(this),this.o=2,Mr(this)):Pu(this,this.Y-n)},(S=Nn.prototype).R=function(){no(this);for(var n=[],e=0;e<this.g.length;e++)n.push(this.h[this.g[e]]);return n},S.T=function(){return no(this),this.g.concat()},S.get=function(n,e){return Yt(this.h,n)?this.h[n]:e},S.set=function(n,e){Yt(this.h,n)||(this.i++,this.g.push(n)),this.h[n]=e},S.forEach=function(n,e){for(var t=this.T(),r=0;r<t.length;r++){var s=t[r],i=this.get(s);n.call(e,i,s,this)}};var Lu=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Xt(n,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,n instanceof Xt){this.g=void 0!==e?e:n.g,Us(this,n.j),this.s=n.s,Vs(this,n.i),qs(this,n.m),this.l=n.l,e=n.h;var t=new Lr;t.i=e.i,e.g&&(t.g=new Nn(e.g),t.h=e.h),Fu(this,t),this.o=n.o}else n&&(t=String(n).match(Lu))?(this.g=!!e,Us(this,t[1]||"",!0),this.s=Rr(t[2]||""),Vs(this,t[3]||"",!0),qs(this,t[4]),this.l=Rr(t[5]||"",!0),Fu(this,t[6]||"",!0),this.o=Rr(t[7]||"")):(this.g=!!e,this.h=new Lr(null,this.g))}function pt(n){return new Xt(n)}function Us(n,e,t){n.j=t?Rr(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Vs(n,e,t){n.i=t?Rr(e,!0):e}function qs(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Fu(n,e,t){e instanceof Lr?(n.h=e,function(n,e){e&&!n.j&&(At(n),n.i=null,n.g.forEach(function(t,r){var s=r.toLowerCase();r!=s&&(Vu(this,r),Bu(this,s,t))},n)),n.j=e}(n.h,n.g)):(t||(e=Pr(e,gd)),n.h=new Lr(e,n.g))}function ee(n,e,t){n.h.set(e,t)}function Bs(n){return ee(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Rr(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Pr(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,dd),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function dd(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Xt.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Pr(e,Uu,!0),":");var t=this.i;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Pr(e,Uu,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.i&&"/"!=t.charAt(0)&&n.push("/"),n.push(Pr(t,"/"==t.charAt(0)?md:fd,!0))),(t=this.h.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Pr(t,pd)),n.join("")};var Uu=/[#\/\?@]/g,fd=/[#\?:]/g,md=/[#\?]/g,gd=/[#\?@]/g,pd=/#/g;function Lr(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function At(n){n.g||(n.g=new Nn,n.h=0,n.i&&function(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),s=null;if(0<=r){var i=n[t].substring(0,r);s=n[t].substring(r+1)}else i=n[t];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Vu(n,e){At(n),e=Dn(n,e),Yt(n.g.h,e)&&(n.i=null,n.h-=n.g.get(e).length,Yt((n=n.g).h,e)&&(delete n.h[e],n.i--,n.g.length>2*n.i&&no(n)))}function qu(n,e){return At(n),e=Dn(n,e),Yt(n.g.h,e)}function Bu(n,e,t){Vu(n,e),0<t.length&&(n.i=null,n.g.set(Dn(n,e),qt(t)),n.h+=t.length)}function Dn(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Ku(n){this.l=n||wd,n=R.PerformanceNavigationTiming?0<(n=R.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(R.g&&R.g.Ea&&R.g.Ea()&&R.g.Ea().Zb),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(S=Lr.prototype).add=function(n,e){At(this),this.i=null,n=Dn(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},S.forEach=function(n,e){At(this),this.g.forEach(function(t,r){hr(t,function(s){n.call(e,s,r,this)},this)},this)},S.T=function(){At(this);for(var n=this.g.R(),e=this.g.T(),t=[],r=0;r<e.length;r++)for(var s=n[r],i=0;i<s.length;i++)t.push(e[r]);return t},S.R=function(n){At(this);var e=[];if("string"==typeof n)qu(this,n)&&(e=xt(e,this.g.get(Dn(this,n))));else{n=this.g.R();for(var t=0;t<n.length;t++)e=xt(e,n[t])}return e},S.set=function(n,e){return At(this),this.i=null,qu(this,n=Dn(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},S.get=function(n,e){return n&&0<(n=this.R(n)).length?String(n[0]):e},S.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var n=[],e=this.g.T(),t=0;t<e.length;t++){var r=e[t],s=encodeURIComponent(String(r));r=this.R(r);for(var i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),n.push(o)}}return this.i=n.join("&")};var wd=10;function ju(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Gu(n){return n.h?1:n.g?n.g.size:0}function ro(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function so(n,e){n.g?n.g.add(e):n.h=e}function $u(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function zu(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return qt(n.i)}function io(){}function _d(){this.g=new io}function Id(n,e,t){const r=t||"";try{to(n,function(s,i){let o=s;tt(s)&&(o=bt(s)),e.push(r+i+"="+encodeURIComponent(o))})}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function Ks(n,e,t,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(i){}}function Fr(n){this.l=n.$b||null,this.j=n.ib||!1}function js(n,e){G.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=oo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ku.prototype.cancel=function(){if(this.i=zu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},io.prototype.stringify=function(n){return R.JSON.stringify(n,void 0)},io.prototype.parse=function(n){return R.JSON.parse(n,void 0)},H(Fr,Wi),Fr.prototype.g=function(){return new js(this.l,this.j)},Fr.prototype.i=function(n){return function(){return n}}({}),H(js,G);var oo=0;function Qu(n){n.j.read().then(n.Sa.bind(n)).catch(n.ha.bind(n))}function Ur(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Vr(n)}function Vr(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(S=js.prototype).open=function(n,e){if(this.readyState!=oo)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Vr(this)},S.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||R).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},S.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ur(this)),this.readyState=oo},S.Va=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Vr(this)),this.g&&(this.readyState=3,Vr(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==R.ReadableStream&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Qu(this)}else n.text().then(this.Ua.bind(this),this.ha.bind(this))},S.Sa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Ur(this):Vr(this),3==this.readyState&&Qu(this)}},S.Ua=function(n){this.g&&(this.response=this.responseText=n,Ur(this))},S.Ta=function(n){this.g&&(this.response=n,Ur(this))},S.ha=function(){this.g&&Ur(this)},S.setRequestHeader=function(n,e){this.v.append(n,e)},S.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},S.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(js.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var Td=R.JSON.parse;function he(n){G.call(this),this.headers=new Nn,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Wu,this.K=this.L=!1}H(he,G);var Wu="",xd=/^https?$/i,Sd=["POST","PUT"];function Ad(n){return"content-type"==n.toLowerCase()}function Hu(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Zu(n),Gs(n)}function Zu(n){n.D||(n.D=!0,X(n,"complete"),X(n,"error"))}function Yu(n){if(n.h&&void 0!==ce&&(!n.C[1]||4!=yt(n)||2!=n.ba()))if(n.v&&4==yt(n))br(n.Fa,0,n);else if(X(n,"readystatechange"),4==yt(n)){n.h=!1;try{const a=n.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===a){var s=String(n.H).match(Lu)[1]||null;if(!s&&R.self&&R.self.location){var i=R.self.location.protocol;s=i.substr(0,i.length-1)}r=!xd.test(s?s.toLowerCase():"")}t=r}if(t)X(n,"complete"),X(n,"success");else{n.m=6;try{var o=2<yt(n)?n.g.statusText:""}catch(u){o=""}n.j=o+" ["+n.ba()+"]",Zu(n)}}finally{Gs(n)}}}function Gs(n,e){if(n.g){Xu(n);const t=n.g,r=n.C[0]?He:null;n.g=null,n.C=null,e||X(n,"ready");try{t.onreadystatechange=r}catch(s){}}}function Xu(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(R.clearTimeout(n.A),n.A=null)}function yt(n){return n.g?n.g.readyState:0}function Ju(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case Wu:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function ao(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=function(n){let e="";return rt(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):ee(n,e,t))}function qr(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function ec(n){this.za=0,this.l=[],this.h=new Os,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=qr("failFast",!1,n),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=qr("baseRetryDelayMs",5e3,n),this.$a=qr("retryDelaySeedMs",1e4,n),this.Ya=qr("forwardChannelMaxRetries",2,n),this.ra=qr("forwardChannelRequestTimeoutMs",2e4,n),this.qa=n&&n.xmlHttpFactory||void 0,this.Ba=n&&n.Yb||!1,this.K=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.J="",this.i=new Ku(n&&n.concurrentRequestLimit),this.Ca=new _d,this.ja=n&&n.fastHandshake||!1,this.Ra=n&&n.Wb||!1,n&&n.Aa&&this.h.Aa(),n&&n.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&n&&n.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!n||!1!==n.Xb}function uo(n){if(tc(n),3==n.G){var e=n.V++,t=pt(n.F);ee(t,"SID",n.J),ee(t,"RID",e),ee(t,"TYPE","terminate"),Br(n,t),(e=new kr(n,n.h,e,void 0)).K=2,e.v=Bs(pt(t)),t=!1,R.navigator&&R.navigator.sendBeacon&&(t=R.navigator.sendBeacon(e.v.toString(),"")),!t&&R.Image&&((new Image).src=e.v,t=!0),t||(e.g=lc(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Or(e)}uc(n)}function $s(n){n.g&&(ho(n),n.g.cancel(),n.g=null)}function tc(n){$s(n),n.u&&(R.clearTimeout(n.u),n.u=null),Qs(n),n.i.cancel(),n.m&&("number"==typeof n.m&&R.clearTimeout(n.m),n.m=null)}function co(n,e){n.l.push(new class{constructor(n,e){this.h=n,this.g=e}}(n.Za++,e)),3==n.G&&zs(n)}function zs(n){ju(n.i)||n.m||(n.m=!0,Er(n.Ha,n),n.C=0)}function nc(n,e){var t;t=e?e.m:n.V++;const r=pt(n.F);ee(r,"SID",n.J),ee(r,"RID",t),ee(r,"AID",n.U),Br(n,r),n.o&&n.s&&ao(r,n.o,n.s),t=new kr(n,n.h,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.l=e.D.concat(n.l)),e=rc(n,t,1e3),t.setTimeout(Math.round(.5*n.ra)+Math.round(.5*n.ra*Math.random())),so(n.i,t),Ji(t,r,e)}function Br(n,e){n.j&&to({},function(t,r){ee(e,r,t)})}function rc(n,e,t){t=Math.min(n.l.length,t);var r=n.j?M(n.j.Oa,n.j,n):null;e:{var s=n.l;let i=-1;for(;;){const o=["count="+t];-1==i?0<t?(i=s[0].h,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let u=0;u<t;u++){let c=s[u].h;const h=s[u].g;if(c-=i,0>c)i=Math.max(0,s[u].h-100),a=!1;else try{Id(h,o,"req"+c+"_")}catch(f){r&&r(h)}}if(a){r=o.join("&");break e}}}return n=n.l.splice(0,t),e.D=n,r}function sc(n){n.g||n.u||(n.Y=1,Er(n.Ga,n),n.A=0)}function lo(n){return!(n.g||n.u||3<=n.A||(n.Y++,n.u=Nr(M(n.Ga,n),ac(n,n.A)),n.A++,0))}function ho(n){null!=n.B&&(R.clearTimeout(n.B),n.B=null)}function ic(n){n.g=new kr(n,n.h,"rpc",n.Y),null===n.o&&(n.g.H=n.s),n.g.O=0;var e=pt(n.oa);ee(e,"RID","rpc"),ee(e,"SID",n.J),ee(e,"CI",n.N?"0":"1"),ee(e,"AID",n.U),Br(n,e),ee(e,"TYPE","xmlhttp"),n.o&&n.s&&ao(e,n.o,n.s),n.K&&n.g.setTimeout(n.K);var t=n.g;n=n.la,t.K=1,t.v=Bs(pt(e)),t.s=null,t.U=!0,Ou(t,n)}function Qs(n){null!=n.v&&(R.clearTimeout(n.v),n.v=null)}function oc(n,e){var t=null;if(n.g==e){Qs(n),ho(n),n.g=null;var r=2}else{if(!ro(n.i,e))return;t=e.D,$u(n.i,e),r=1}if(n.I=e.N,0!=n.G)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.F;var s=n.C;X(r=Ms(),new Au(r,t,e,s)),zs(n)}else sc(n);else if(3==(s=e.o)||0==s&&0<n.I||!(1==r&&function(n,e){return!(Gu(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.l=e.D.concat(n.l),0):1==n.G||2==n.G||n.C>=(n.Xa?0:n.Ya)||(n.m=Nr(M(n.Ha,n,e),ac(n,n.C)),n.C++,0)))}(n,e)||2==r&&lo(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),s){case 1:Jt(n,5);break;case 4:Jt(n,10);break;case 3:Jt(n,6);break;default:Jt(n,2)}}function ac(n,e){let t=n.Pa+Math.floor(Math.random()*n.$a);return n.j||(t*=2),t*e}function Jt(n,e){if(n.h.info("Error code "+e),2==e){var t=null;n.j&&(t=null);var r=M(n.jb,n);t||(t=new Xt("//www.google.com/images/cleardot.gif"),R.location&&"http"==R.location.protocol||Us(t,"https"),Bs(t)),function(n,e){const t=new Os;if(R.Image){const r=new Image;r.onload=_(Ks,t,r,"TestLoadImage: loaded",!0,e),r.onerror=_(Ks,t,r,"TestLoadImage: error",!1,e),r.onabort=_(Ks,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=_(Ks,t,r,"TestLoadImage: timeout",!1,e),R.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else Ue(2);n.G=0,n.j&&n.j.va(e),uc(n),tc(n)}function uc(n){n.G=0,n.I=-1,n.j&&((0!=zu(n.i).length||0!=n.l.length)&&(n.i.i.length=0,qt(n.l),n.l.length=0),n.j.ua())}function cc(n,e,t){let r=function(n){return n instanceof Xt?pt(n):new Xt(n,void 0)}(t);if(""!=r.i)e&&Vs(r,e+"."+r.i),qs(r,r.m);else{const s=R.location;r=function(n,e,t,r){var s=new Xt(null,void 0);return n&&Us(s,n),e&&Vs(s,e),t&&qs(s,t),r&&(s.l=r),s}(s.protocol,e?e+"."+s.hostname:s.hostname,+s.port,t)}return n.aa&&rt(n.aa,function(s,i){ee(r,i,s)}),t=n.sa,(e=n.D)&&t&&ee(r,e,t),ee(r,"VER",n.ma),Br(n,r),r}function lc(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new he(t&&n.Ba&&!n.qa?new Fr({ib:!0}):n.qa)).L=n.H,e}function hc(){}function Ws(){if(se&&!(10<=Number(xs)))throw Error("Environmental error: no available transport.")}function Ge(n,e){G.call(this),this.g=new ec(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.P=n,(n=e&&e.httpHeadersOverwriteParam)&&!xn(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!xn(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new kn(this)}function dc(n){Hi.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function fc(){Zi.call(this),this.status=1}function kn(n){this.g=n}(S=he.prototype).ea=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Yi.g(),this.C=function(n){return n.h||(n.h=n.i())}(this.u?this.u:Yi),this.g.onreadystatechange=M(this.Fa,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(i){return void Hu(this,i)}n=t||"";const s=new Nn(this.headers);r&&to(r,function(i,o){s.set(o,i)}),r=function(n){e:{var e=Ad;const t=n.length,r="string"==typeof n?n.split(""):n;for(let s=0;s<t;s++)if(s in r&&e.call(void 0,r[s],s,n)){e=s;break e}e=-1}return 0>e?null:"string"==typeof n?n.charAt(e):n[e]}(s.T()),t=R.FormData&&n instanceof R.FormData,!(0<=Tn(Sd,e))||r||t||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(i,o){this.g.setRequestHeader(o,i)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Xu(this),0<this.B&&((this.K=function(n){return se&&qi()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=M(this.pa,this)):this.A=br(this.pa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(i){Hu(this,i)}},S.pa=function(){void 0!==ce&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,X(this,"timeout"),this.abort(8))},S.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,X(this,"complete"),X(this,"abort"),Gs(this))},S.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Gs(this,!0)),he.Z.M.call(this)},S.Fa=function(){this.s||(this.F||this.v||this.l?Yu(this):this.cb())},S.cb=function(){Yu(this)},S.ba=function(){try{return 2<yt(this)?this.g.status:-1}catch(n){return-1}},S.ga=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},S.Qa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),Td(e)}},S.Da=function(){return this.m},S.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(S=ec.prototype).ma=8,S.G=1,S.hb=function(n){try{this.h.info("Origin Trials invoked: "+n)}catch(e){}},S.Ha=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.V=Math.floor(1e5*Math.random()),n=this.V++;const s=new kr(this,this.h,n,void 0);let i=this.s;if(this.P&&(i?(i=Fe(i),mr(i,this.P)):i=this.P),null===this.o&&(s.H=i),this.ja)e:{for(var e=0,t=0;t<this.l.length;t++){var r=this.l[t];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.l.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=rc(this,s,e),ee(t=pt(this.F),"RID",n),ee(t,"CVER",22),this.D&&ee(t,"X-HTTP-Session-Id",this.D),Br(this,t),this.o&&i&&ao(t,this.o,i),so(this.i,s),this.Ra&&ee(t,"TYPE","init"),this.ja?(ee(t,"$req",e),ee(t,"SID","null"),s.$=!0,Ji(s,t,null)):Ji(s,t,e),this.G=2}}else 3==this.G&&(n?nc(this,n):0==this.l.length||ju(this.i)||nc(this))},S.Ga=function(){if(this.u=null,ic(this),this.$&&!(this.L||null==this.g||0>=this.O)){var n=2*this.O;this.h.info("BP detection timer enabled: "+n),this.B=Nr(M(this.bb,this),n)}},S.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Ue(10),$s(this),ic(this))},S.ab=function(){null!=this.v&&(this.v=null,$s(this),lo(this),Ue(19))},S.jb=function(n){n?(this.h.info("Successfully pinged google.com"),Ue(2)):(this.h.info("Failed to ping google.com"),Ue(1))},(S=hc.prototype).xa=function(){},S.wa=function(){},S.va=function(){},S.ua=function(){},S.Oa=function(){},Ws.prototype.g=function(n,e){return new Ge(n,e)},H(Ge,G),Ge.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;n.Wa&&(n.h.info("Origin Trials enabled."),Er(M(n.hb,n,e))),Ue(0),n.W=e,n.aa=t||{},n.N=n.X,n.F=cc(n,null,n.W),zs(n)},Ge.prototype.close=function(){uo(this.g)},Ge.prototype.u=function(n){if("string"==typeof n){var e={};e.__data__=n,co(this.g,e)}else this.v?((e={}).__data__=bt(n),co(this.g,e)):co(this.g,n)},Ge.prototype.M=function(){this.g.j=null,delete this.j,uo(this.g),delete this.g,Ge.Z.M.call(this)},H(dc,Hi),H(fc,Zi),H(kn,hc),kn.prototype.xa=function(){X(this.g,"a")},kn.prototype.wa=function(n){X(this.g,new dc(n))},kn.prototype.va=function(n){X(this.g,new fc(n))},kn.prototype.ua=function(){X(this.g,"b")},Ws.prototype.createWebChannel=Ws.prototype.g,Ge.prototype.send=Ge.prototype.u,Ge.prototype.open=Ge.prototype.m,Ge.prototype.close=Ge.prototype.close,Rs.NO_ERROR=0,Rs.TIMEOUT=8,Rs.HTTP_ERROR=6,Cu.COMPLETE="complete",Du.EventType=Dr,Dr.OPEN="a",Dr.CLOSE="b",Dr.ERROR="c",Dr.MESSAGE="d",G.prototype.listen=G.prototype.N,he.prototype.listenOnce=he.prototype.O,he.prototype.getLastError=he.prototype.La,he.prototype.getLastErrorCode=he.prototype.Da,he.prototype.getStatus=he.prototype.ba,he.prototype.getResponseJson=he.prototype.Qa,he.prototype.getResponseText=he.prototype.ga,he.prototype.send=he.prototype.ea;var Dd=W.createWebChannelTransport=function(){return new Ws},kd=W.getStatEventTarget=function(){return Ms()},fo=W.ErrorCode=Rs,Od=W.EventType=Cu,Md=W.Event=Ht,mc=W.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Rd=W.FetchXmlHttpFactory=Fr,Hs=W.WebChannel=Du,Pd=W.XhrIo=he;const gc="@firebase/firestore";class ke{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ke.UNAUTHENTICATED=new ke(null),ke.GOOGLE_CREDENTIALS=new ke("google-credentials-uid"),ke.FIRST_PARTY=new ke("first-party-uid"),ke.MOCK_USER=new ke("mock-user");let On="9.6.7";const Ct=new j.Yd("@firebase/firestore");function mo(){return Ct.logLevel}function Ld(n){Ct.setLogLevel(n)}function b(n,...e){if(Ct.logLevel<=j.in.DEBUG){const t=e.map(go);Ct.debug(`Firestore (${On}): ${n}`,...t)}}function de(n,...e){if(Ct.logLevel<=j.in.ERROR){const t=e.map(go);Ct.error(`Firestore (${On}): ${n}`,...t)}}function Kr(n,...e){if(Ct.logLevel<=j.in.WARN){const t=e.map(go);Ct.warn(`Firestore (${On}): ${n}`,...t)}}function go(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function k(n="Unexpected state"){const e=`FIRESTORE (${On}) INTERNAL ASSERTION FAILED: `+n;throw de(e),new Error(e)}function U(n,e){n||k()}function Fd(n,e){n||k()}function A(n,e){return n}const p={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class T extends P.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ie{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class pc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ud{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ke.UNAUTHENTICATED))}shutdown(){}}class Vd{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class qd{constructor(e){this.t=e,this.currentUser=ke.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let s=this.i;const i=c=>this.i!==s?(s=this.i,t(c)):Promise.resolve();let o=new Ie;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Ie,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,m.Z)(function*(){yield c.promise,yield i(r.currentUser)}))},u=c=>{b("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(b("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Ie)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(b("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(U("string"==typeof r.accessToken),new pc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return U(null===e||"string"==typeof e),new ke(e)}}class Bd{constructor(e,t,r){this.type="FirstParty",this.user=ke.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const s=e.auth.getAuthHeaderValueForFirstParty([]);s&&this.headers.set("Authorization",s),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)}}class Kd{constructor(e,t,r){this.h=e,this.l=t,this.m=r}getToken(){return Promise.resolve(new Bd(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(ke.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class yc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class jd{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(e,t){const r=i=>{null!=i.error&&b("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.p;return this.p=i.token,b("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{b("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.g.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.g.getImmediate({optional:!0});i?s(i):b("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(U("string"==typeof t.token),this.p=t.token,new yc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class $e{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.I(r),this.T=r=>t.writeSequenceNumber(r))}I(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function Gd(n){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}$e.A=-1;class vc{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=Gd(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function q(n,e){return n<e?-1:n>e?1:0}function Mn(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function wc(n){return n+"\0"}class Ee{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new T(p.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new T(p.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new T(p.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new T(p.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ee.fromMillis(Date.now())}static fromDate(e){return Ee.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Ee(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?q(this.nanoseconds,e.nanoseconds):q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class F{constructor(e){this.timestamp=e}static fromTimestamp(e){return new F(e)}static min(){return new F(new Ee(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function _c(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function en(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Ic(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class jr{constructor(e,t,r){void 0===t?t=0:t>e.length&&k(),void 0===r?r=e.length-t:r>e.length-t&&k(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===jr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof jr?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class $ extends jr{construct(e,t,r){return new $(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new T(p.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new $(t)}static emptyPath(){return new $([])}}const $d=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Te extends jr{construct(e,t,r){return new Te(e,t,r)}static isValidIdentifier(e){return $d.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Te.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Te(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(0===r.length)throw new T(p.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if("\\"===a){if(s+1===e.length)throw new T(p.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new T(p.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else"`"===a?(o=!o,s++):"."!==a||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new T(p.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Te(t)}static emptyPath(){return new Te([])}}class Rn{constructor(e){this.fields=e,e.sort(Te.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Mn(this.fields,e.fields,(t,r)=>t.isEqual(r))}}function zd(){return"undefined"!=typeof atob}class ye{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new ye(t)}static fromUint8Array(e){const t=function(r){let s="";for(let i=0;i<r.length;++i)s+=String.fromCharCode(r[i]);return s}(e);return new ye(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ye.EMPTY_BYTE_STRING=new ye("");const Qd=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Nt(n){if(U(!!n),"string"==typeof n){let e=0;const t=Qd.exec(n);if(U(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ie(n.seconds),nanos:ie(n.nanos)}}function ie(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function tn(n){return"string"==typeof n?ye.fromBase64String(n):ye.fromUint8Array(n)}function po(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ec(n){const e=n.mapValue.fields.__previous_value__;return po(e)?Ec(e):e}function Gr(n){const e=Nt(n.mapValue.fields.__local_write_time__.timestampValue);return new Ee(e.seconds,e.nanos)}class Wd{constructor(e,t,r,s,i,o,a,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=u}}class nn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new nn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof nn&&e.projectId===this.projectId&&e.database===this.database}}function rn(n){return null==n}function $r(n){return 0===n&&1/n==-1/0}function Tc(n){return"number"==typeof n&&Number.isInteger(n)&&!$r(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}class N{constructor(e){this.path=e}static fromPath(e){return new N($.fromString(e))}static fromName(e){return new N($.fromString(e).popFirst(5))}static empty(){return new N($.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===$.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return $.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new N(new $(e.slice()))}}const Hd={mapValue:{fields:{__type__:{stringValue:"__max___"}}}};function sn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?po(n)?4:10:k()}function st(n,e){if(n===e)return!0;const t=sn(n);if(t!==sn(e))return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Gr(n).isEqual(Gr(e));case 3:return function(r,s){if("string"==typeof r.timestampValue&&"string"==typeof s.timestampValue&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const i=Nt(r.timestampValue),o=Nt(s.timestampValue);return i.seconds===o.seconds&&i.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,tn(n.bytesValue).isEqual(tn(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return ie(r.geoPointValue.latitude)===ie(s.geoPointValue.latitude)&&ie(r.geoPointValue.longitude)===ie(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return ie(r.integerValue)===ie(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const i=ie(r.doubleValue),o=ie(s.doubleValue);return i===o?$r(i)===$r(o):isNaN(i)&&isNaN(o)}return!1}(n,e);case 9:return Mn(n.arrayValue.values||[],e.arrayValue.values||[],st);case 10:return function(r,s){const i=r.mapValue.fields||{},o=s.mapValue.fields||{};if(_c(i)!==_c(o))return!1;for(const a in i)if(i.hasOwnProperty(a)&&(void 0===o[a]||!st(i[a],o[a])))return!1;return!0}(n,e);default:return k()}var s}function zr(n,e){return void 0!==(n.values||[]).find(t=>st(t,e))}function Pn(n,e){if(n===e)return 0;const t=sn(n),r=sn(e);if(t!==r)return q(t,r);switch(t){case 0:return 0;case 1:return q(n.booleanValue,e.booleanValue);case 2:return function(s,i){const o=ie(s.integerValue||s.doubleValue),a=ie(i.integerValue||i.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return xc(n.timestampValue,e.timestampValue);case 4:return xc(Gr(n),Gr(e));case 5:return q(n.stringValue,e.stringValue);case 6:return function(s,i){const o=tn(s),a=tn(i);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(s,i){const o=s.split("/"),a=i.split("/");for(let u=0;u<o.length&&u<a.length;u++){const c=q(o[u],a[u]);if(0!==c)return c}return q(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,i){const o=q(ie(s.latitude),ie(i.latitude));return 0!==o?o:q(ie(s.longitude),ie(i.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,i){const o=s.values||[],a=i.values||[];for(let u=0;u<o.length&&u<a.length;++u){const c=Pn(o[u],a[u]);if(c)return c}return q(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,i){const o=s.fields||{},a=Object.keys(o),u=i.fields||{},c=Object.keys(u);a.sort(),c.sort();for(let h=0;h<a.length&&h<c.length;++h){const f=q(a[h],c[h]);if(0!==f)return f;const g=Pn(o[a[h]],u[c[h]]);if(0!==g)return g}return q(a.length,c.length)}(n.mapValue,e.mapValue);default:throw k()}}function xc(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return q(n,e);const t=Nt(n),r=Nt(e),s=q(t.seconds,r.seconds);return 0!==s?s:q(t.nanos,r.nanos)}function Ln(n){return yo(n)}function yo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const s=Nt(r);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?tn(n.bytesValue).toBase64():"referenceValue"in n?N.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let s="[",i=!0;for(const o of r.values||[])i?i=!1:s+=",",s+=yo(o);return s+"]"}(n.arrayValue):"mapValue"in n?function(r){const s=Object.keys(r.fields||{}).sort();let i="{",o=!0;for(const a of s)o?o=!1:i+=",",i+=`${a}:${yo(r.fields[a])}`;return i+"}"}(n.mapValue):k();var e}function Zs(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function vo(n){return!!n&&"integerValue"in n}function Ys(n){return!!n&&"arrayValue"in n}function Sc(n){return!!n&&"nullValue"in n}function bc(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Xs(n){return!!n&&"mapValue"in n}function Qr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return en(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Qr(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Qr(n.arrayValue.values[t]);return e}return Object.assign({},n)}class Re{constructor(e){this.value=e}static empty(){return new Re({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Xs(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qr(t)}setAll(e){let t=Te.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Qr(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Xs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return st(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Xs(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){en(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Re(Qr(this.value))}}function Ac(n){const e=[];return en(n.fields,(t,r)=>{const s=new Te([t]);if(Xs(r)){const i=Ac(r.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Rn(e)}class re{constructor(e,t,r,s,i,o){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.data=i,this.documentState=o}static newInvalidDocument(e){return new re(e,0,F.min(),F.min(),Re.empty(),0)}static newFoundDocument(e,t,r){return new re(e,1,t,F.min(),r,0)}static newNoDocument(e,t){return new re(e,2,t,F.min(),Re.empty(),0)}static newUnknownDocument(e,t){return new re(e,3,t,F.min(),Re.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Re.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Re.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof re&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new re(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}let wo=(()=>{class n{constructor(t,r,s,i){this.indexId=t,this.collectionGroup=r,this.fields=s,this.indexState=i}}return n.UNKNOWN_ID=-1,n})();class Js{constructor(e,t){this.fieldPath=e,this.kind=t}}class Wr{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Wr(0,ei.min())}}class ei{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new ei(F.min(),N.empty(),-1)}}class Zd{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.P=null}}function Cc(n,e=null,t=[],r=[],s=null,i=null,o=null){return new Zd(n,e,t,r,s,i,o)}function Hr(n){const e=A(n);if(null===e.P){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>{return(s=r).field.canonicalString()+s.op.toString()+Ln(s.value);var s}).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),rn(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ln(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ln(r)).join(",")),e.P=t}return e.P}function ti(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<n.orderBy.length;s++)if(!of(n.orderBy[s],e.orderBy[s]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let s=0;s<n.filters.length;s++)if((t=n.filters[s]).op!==(r=e.filters[s]).op||!t.field.isEqual(r.field)||!st(t.value,r.value))return!1;var t,r;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!kc(n.startAt,e.startAt)&&kc(n.endAt,e.endAt)}function ni(n){return N.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}class Ve extends class{}{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.v(e,t,r):new Xd(e,t,r):"array-contains"===t?new tf(e,r):"in"===t?new nf(e,r):"not-in"===t?new rf(e,r):"array-contains-any"===t?new sf(e,r):new Ve(e,t,r)}static v(e,t,r){return"in"===t?new Jd(e,r):new ef(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.V(Pn(t,this.value)):null!==t&&sn(this.value)===sn(t)&&this.V(Pn(t,this.value))}V(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return k()}}S(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Xd extends Ve{constructor(e,t,r){super(e,t,r),this.key=N.fromName(r.referenceValue)}matches(e){const t=N.comparator(e.key,this.key);return this.V(t)}}class Jd extends Ve{constructor(e,t){super(e,"in",t),this.keys=Nc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class ef extends Ve{constructor(e,t){super(e,"not-in",t),this.keys=Nc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Nc(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>N.fromName(r.referenceValue))}class tf extends Ve{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ys(t)&&zr(t.arrayValue,this.value)}}class nf extends Ve{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&zr(this.value.arrayValue,t)}}class rf extends Ve{constructor(e,t){super(e,"not-in",t)}matches(e){if(zr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!zr(this.value.arrayValue,t)}}class sf extends Ve{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ys(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>zr(this.value.arrayValue,r))}}class Fn{constructor(e,t){this.position=e,this.inclusive=t}}class Un{constructor(e,t="asc"){this.field=e,this.dir=t}}function of(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}function Dc(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(r=i.field.isKeyField()?N.comparator(N.fromName(o.referenceValue),t.key):Pn(o,t.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function kc(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!st(n.position[t],e.position[t]))return!1;return!0}class vt{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=u,this.D=null,this.C=null}}function Oc(n,e,t,r,s,i,o,a){return new vt(n,e,t,r,s,i,o,a)}function Vn(n){return new vt(n)}function ri(n){return!rn(n.limit)&&"F"===n.limitType}function si(n){return!rn(n.limit)&&"L"===n.limitType}function _o(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Io(n){for(const e of n.filters)if(e.S())return e.field;return null}function Eo(n){return null!==n.collectionGroup}function qn(n){const e=A(n);if(null===e.D){e.D=[];const t=Io(e),r=_o(e);if(null!==t&&null===r)t.isKeyField()||e.D.push(new Un(t)),e.D.push(new Un(Te.keyField(),"asc"));else{let s=!1;for(const i of e.explicitOrderBy)e.D.push(i),i.field.isKeyField()&&(s=!0);if(!s){const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.D.push(new Un(Te.keyField(),i))}}}return e.D}function Ye(n){const e=A(n);if(!e.C)if("F"===e.limitType)e.C=Cc(e.path,e.collectionGroup,qn(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const i of qn(e))t.push(new Un(i.field,"desc"===i.dir?"asc":"desc"));const r=e.endAt?new Fn(e.endAt.position,!e.endAt.inclusive):null,s=e.startAt?new Fn(e.startAt.position,!e.startAt.inclusive):null;e.C=Cc(e.path,e.collectionGroup,t,e.filters,e.limit,r,s)}return e.C}function Mc(n,e,t){return new vt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Zr(n,e){return ti(Ye(n),Ye(e))&&n.limitType===e.limitType}function Rc(n){return`${Hr(Ye(n))}|lt:${n.limitType}`}function To(n){return`Query(target=${function(n){let e=n.path.canonicalString();return null!==n.collectionGroup&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>{return`${(r=t).field.canonicalString()} ${r.op} ${Ln(r.value)}`;var r}).join(", ")}]`),rn(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>{return`${(r=t).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Ln(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Ln(t)).join(",")),`Target(${e})`}(Ye(n))}; limitType=${n.limitType})`}function xo(n,e){return e.isFoundDocument()&&function(t,r){const s=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(s):N.isDocumentKey(t.path)?t.path.isEqual(s):t.path.isImmediateParentOf(s)}(n,e)&&function(t,r){for(const s of t.explicitOrderBy)if(!s.field.isKeyField()&&null===r.data.field(s.field))return!1;return!0}(n,e)&&function(t,r){for(const s of t.filters)if(!s.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!function(s,i,o){const a=Dc(s,i,o);return s.inclusive?a<=0:a<0}(t.startAt,qn(t),r)||t.endAt&&!function(s,i,o){const a=Dc(s,i,o);return s.inclusive?a>=0:a>0}(t.endAt,qn(t),r)));var t,r}function Pc(n){return(e,t)=>{let r=!1;for(const s of qn(n)){const i=af(s,e,t);if(0!==i)return i;r=r||s.field.isKeyField()}return 0}}function af(n,e,t){const r=n.field.isKeyField()?N.comparator(e.key,t.key):function(s,i,o){const a=i.data.field(s),u=o.data.field(s);return null!==a&&null!==u?Pn(a,u):k()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return k()}}function Lc(n,e){if(n.N){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$r(e)?"-0":e}}function Fc(n){return{integerValue:""+n}}function Uc(n,e){return Tc(e)?Fc(e):Lc(n,e)}class ii{constructor(){this._=void 0}}function uf(n,e,t){return n instanceof Bn?function(r,s){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&(i.fields.__previous_value__=s),{mapValue:i}}(t,e):n instanceof on?qc(n,e):n instanceof an?Bc(n,e):function(r,s){const i=Vc(r,s),o=Kc(i)+Kc(r.k);return vo(i)&&vo(r.k)?Fc(o):Lc(r.O,o)}(n,e)}function cf(n,e,t){return n instanceof on?qc(n,e):n instanceof an?Bc(n,e):t}function Vc(n,e){return n instanceof Kn?vo(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class Bn extends ii{}class on extends ii{constructor(e){super(),this.elements=e}}function qc(n,e){const t=jc(e);for(const r of n.elements)t.some(s=>st(s,r))||t.push(r);return{arrayValue:{values:t}}}class an extends ii{constructor(e){super(),this.elements=e}}function Bc(n,e){let t=jc(e);for(const r of n.elements)t=t.filter(s=>!st(s,r));return{arrayValue:{values:t}}}class Kn extends ii{constructor(e,t){super(),this.O=e,this.k=t}}function Kc(n){return ie(n.integerValue||n.doubleValue)}function jc(n){return Ys(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Yr{constructor(e,t){this.field=e,this.transform=t}}class hf{constructor(e,t){this.version=e,this.transformResults=t}}class fe{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new fe}static exists(e){return new fe(void 0,e)}static updateTime(e){return new fe(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function oi(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class ai{}function df(n,e,t){n instanceof Xr?function(r,s,i){const o=r.value.clone(),a=Qc(r.fieldTransforms,s,i.transformResults);o.setAll(a),s.convertToFoundDocument(i.version,o).setHasCommittedMutations()}(n,e,t):n instanceof un?function(r,s,i){if(!oi(r.precondition,s))return void s.convertToUnknownDocument(i.version);const o=Qc(r.fieldTransforms,s,i.transformResults),a=s.data;a.setAll(zc(r)),a.setAll(o),s.convertToFoundDocument(i.version,a).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function So(n,e,t){var s;n instanceof Xr?function(r,s,i){if(!oi(r.precondition,s))return;const o=r.value.clone(),a=Wc(r.fieldTransforms,i,s);o.setAll(a),s.convertToFoundDocument($c(s),o).setHasLocalMutations()}(n,e,t):n instanceof un?function(r,s,i){if(!oi(r.precondition,s))return;const o=Wc(r.fieldTransforms,i,s),a=s.data;a.setAll(zc(r)),a.setAll(o),s.convertToFoundDocument($c(s),a).setHasLocalMutations()}(n,e,t):oi(n.precondition,s=e)&&s.convertToNoDocument(F.min())}function ff(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Vc(r.transform,s||null);null!=i&&(null==t&&(t=Re.empty()),t.set(r.field,i))}return t||null}function Gc(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&Mn(t,r,(s,i)=>function(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof on&&r instanceof on||t instanceof an&&r instanceof an?Mn(t.elements,r.elements,st):t instanceof Kn&&r instanceof Kn?st(t.k,r.k):t instanceof Bn&&r instanceof Bn);var t,r}(s,i))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}function $c(n){return n.isFoundDocument()?n.version:F.min()}class Xr extends ai{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}}class un extends ai{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}}function zc(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Qc(n,e,t){const r=new Map;U(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,cf(o,a,t[s]))}return r}function Wc(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,uf(i,o,e))}return r}class Jr extends ai{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class bo extends ai{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class mf{constructor(e){this.count=e}}var me,K;function Hc(n){switch(n){default:return k();case p.CANCELLED:case p.UNKNOWN:case p.DEADLINE_EXCEEDED:case p.RESOURCE_EXHAUSTED:case p.INTERNAL:case p.UNAVAILABLE:case p.UNAUTHENTICATED:return!1;case p.INVALID_ARGUMENT:case p.NOT_FOUND:case p.ALREADY_EXISTS:case p.PERMISSION_DENIED:case p.FAILED_PRECONDITION:case p.ABORTED:case p.OUT_OF_RANGE:case p.UNIMPLEMENTED:case p.DATA_LOSS:return!0}}function Zc(n){if(void 0===n)return de("GRPC error has no .code"),p.UNKNOWN;switch(n){case me.OK:return p.OK;case me.CANCELLED:return p.CANCELLED;case me.UNKNOWN:return p.UNKNOWN;case me.DEADLINE_EXCEEDED:return p.DEADLINE_EXCEEDED;case me.RESOURCE_EXHAUSTED:return p.RESOURCE_EXHAUSTED;case me.INTERNAL:return p.INTERNAL;case me.UNAVAILABLE:return p.UNAVAILABLE;case me.UNAUTHENTICATED:return p.UNAUTHENTICATED;case me.INVALID_ARGUMENT:return p.INVALID_ARGUMENT;case me.NOT_FOUND:return p.NOT_FOUND;case me.ALREADY_EXISTS:return p.ALREADY_EXISTS;case me.PERMISSION_DENIED:return p.PERMISSION_DENIED;case me.FAILED_PRECONDITION:return p.FAILED_PRECONDITION;case me.ABORTED:return p.ABORTED;case me.OUT_OF_RANGE:return p.OUT_OF_RANGE;case me.UNIMPLEMENTED:return p.UNIMPLEMENTED;case me.DATA_LOSS:return p.DATA_LOSS;default:return k()}}(K=me||(me={}))[K.OK=0]="OK",K[K.CANCELLED=1]="CANCELLED",K[K.UNKNOWN=2]="UNKNOWN",K[K.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",K[K.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",K[K.NOT_FOUND=5]="NOT_FOUND",K[K.ALREADY_EXISTS=6]="ALREADY_EXISTS",K[K.PERMISSION_DENIED=7]="PERMISSION_DENIED",K[K.UNAUTHENTICATED=16]="UNAUTHENTICATED",K[K.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",K[K.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",K[K.ABORTED=10]="ABORTED",K[K.OUT_OF_RANGE=11]="OUT_OF_RANGE",K[K.UNIMPLEMENTED=12]="UNIMPLEMENTED",K[K.INTERNAL=13]="INTERNAL",K[K.UNAVAILABLE=14]="UNAVAILABLE",K[K.DATA_LOSS=15]="DATA_LOSS";class ue{constructor(e,t){this.comparator=e,this.root=t||Oe.EMPTY}insert(e,t){return new ue(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Oe.BLACK,null,null))}remove(e){return new ue(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Oe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(0===s)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ui(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ui(this.root,e,this.comparator,!1)}getReverseIterator(){return new ui(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ui(this.root,e,this.comparator,!0)}}class ui{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Oe{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=null!=r?r:Oe.RED,this.left=null!=s?s:Oe.EMPTY,this.right=null!=i?i:Oe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Oe(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Oe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return Oe.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Oe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Oe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw k();const e=this.left.check();if(e!==this.right.check())throw k();return e+(this.isRed()?0:1)}}Oe.EMPTY=null,Oe.RED=!0,Oe.BLACK=!1,Oe.EMPTY=new class{constructor(){this.size=0}get key(){throw k()}get value(){throw k()}get color(){throw k()}get left(){throw k()}get right(){throw k()}copy(n,e,t,r,s){return this}insert(n,e,t){return new Oe(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class te{constructor(e){this.comparator=e,this.data=new ue(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Yc(this.data.getIterator())}getIteratorFrom(e){return new Yc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof te)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new te(this.comparator);return t.data=e,t}}class Yc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function jn(n){return n.hasNext()?n.getNext():void 0}const gf=new ue(N.comparator);function Xe(){return gf}const pf=new ue(N.comparator);function Ao(){return pf}const yf=new ue(N.comparator),vf=new te(N.comparator);function Q(...n){let e=vf;for(const t of n)e=e.add(t);return e}const wf=new te(q);function ci(){return wf}class es{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const r=new Map;return r.set(e,ts.createSynthesizedTargetChangeForCurrentChange(e,t)),new es(F.min(),r,ci(),Xe(),Q())}}class ts{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new ts(ye.EMPTY_BYTE_STRING,t,Q(),Q(),Q())}}class li{constructor(e,t,r,s){this.M=e,this.removedTargetIds=t,this.key=r,this.$=s}}class Xc{constructor(e,t){this.targetId=e,this.F=t}}class Jc{constructor(e,t,r=ye.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class el{constructor(){this.B=0,this.L=nl(),this.U=ye.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return 0!==this.B}get j(){return this.K}W(e){e.approximateByteSize()>0&&(this.K=!0,this.U=e)}H(){let e=Q(),t=Q(),r=Q();return this.L.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:k()}}),new ts(this.U,this.q,e,t,r)}J(){this.K=!1,this.L=nl()}Y(e,t){this.K=!0,this.L=this.L.insert(e,t)}X(e){this.K=!0,this.L=this.L.remove(e)}Z(){this.B+=1}tt(){this.B-=1}et(){this.K=!0,this.q=!0}}class _f{constructor(e){this.nt=e,this.st=new Map,this.it=Xe(),this.rt=tl(),this.ot=new te(q)}ct(e){for(const t of e.M)e.$&&e.$.isFoundDocument()?this.ut(t,e.$):this.at(t,e.key,e.$);for(const t of e.removedTargetIds)this.at(t,e.key,e.$)}ht(e){this.forEachTarget(e,t=>{const r=this.lt(t);switch(e.state){case 0:this.ft(t)&&r.W(e.resumeToken);break;case 1:r.tt(),r.G||r.J(),r.W(e.resumeToken);break;case 2:r.tt(),r.G||this.removeTarget(t);break;case 3:this.ft(t)&&(r.et(),r.W(e.resumeToken));break;case 4:this.ft(t)&&(this.dt(t),r.W(e.resumeToken));break;default:k()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.st.forEach((r,s)=>{this.ft(s)&&t(s)})}_t(e){const t=e.targetId,r=e.F.count,s=this.wt(t);if(s){const i=s.target;if(ni(i))if(0===r){const o=new N(i.path);this.at(t,o,re.newNoDocument(o,F.min()))}else U(1===r);else this.gt(t)!==r&&(this.dt(t),this.ot=this.ot.add(t))}}yt(e){const t=new Map;this.st.forEach((i,o)=>{const a=this.wt(o);if(a){if(i.current&&ni(a.target)){const u=new N(a.target.path);null!==this.it.get(u)||this.It(o,u)||this.at(o,u,re.newNoDocument(u,e))}i.j&&(t.set(o,i.H()),i.J())}});let r=Q();this.rt.forEach((i,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.wt(u);return!c||2===c.purpose||(a=!1,!1)}),a&&(r=r.add(i))}),this.it.forEach((i,o)=>o.setReadTime(e));const s=new es(e,t,this.ot,this.it,r);return this.it=Xe(),this.rt=tl(),this.ot=new te(q),s}ut(e,t){if(!this.ft(e))return;const r=this.It(e,t.key)?2:0;this.lt(e).Y(t.key,r),this.it=this.it.insert(t.key,t),this.rt=this.rt.insert(t.key,this.Et(t.key).add(e))}at(e,t,r){if(!this.ft(e))return;const s=this.lt(e);this.It(e,t)?s.Y(t,1):s.X(t),this.rt=this.rt.insert(t,this.Et(t).delete(e)),r&&(this.it=this.it.insert(t,r))}removeTarget(e){this.st.delete(e)}gt(e){const t=this.lt(e).H();return this.nt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Z(e){this.lt(e).Z()}lt(e){let t=this.st.get(e);return t||(t=new el,this.st.set(e,t)),t}Et(e){let t=this.rt.get(e);return t||(t=new te(q),this.rt=this.rt.insert(e,t)),t}ft(e){const t=null!==this.wt(e);return t||b("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.st.get(e);return t&&t.G?null:this.nt.Tt(e)}dt(e){this.st.set(e,new el),this.nt.getRemoteKeysForTarget(e).forEach(t=>{this.at(e,t,null)})}It(e,t){return this.nt.getRemoteKeysForTarget(e).has(t)}}function tl(){return new ue(N.comparator)}function nl(){return new ue(N.comparator)}const If={asc:"ASCENDING",desc:"DESCENDING"},Ef={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Tf{constructor(e,t){this.databaseId=e,this.N=t}}function ns(n,e){return n.N?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function rl(n,e){return n.N?e.toBase64():e.toUint8Array()}function xf(n,e){return ns(n,e.toTimestamp())}function xe(n){return U(!!n),F.fromTimestamp(function(e){const t=Nt(e);return new Ee(t.seconds,t.nanos)}(n))}function Co(n,e){return(t=n,new $(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function sl(n){const e=$.fromString(n);return U(fl(e)),e}function rs(n,e){return Co(n.databaseId,e.path)}function lt(n,e){const t=sl(e);if(t.get(1)!==n.databaseId.projectId)throw new T(p.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new T(p.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new N(ol(t))}function No(n,e){return Co(n.databaseId,e)}function il(n){const e=sl(n);return 4===e.length?$.emptyPath():ol(e)}function ss(n){return new $(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function ol(n){return U(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function al(n,e,t){return{name:rs(n,e),fields:t.value.mapValue.fields}}function ul(n,e,t){const r=lt(n,e.name),s=xe(e.updateTime),i=new Re({mapValue:{fields:e.fields}}),o=re.newFoundDocument(r,s,i);return t&&o.setHasCommittedMutations(),t?o.setHasCommittedMutations():o}function is(n,e){let t;if(e instanceof Xr)t={update:al(n,e.key,e.value)};else if(e instanceof Jr)t={delete:rs(n,e.key)};else if(e instanceof un)t={update:al(n,e.key,e.data),updateMask:Mf(e.fieldMask)};else{if(!(e instanceof bo))return k();t={verify:rs(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,i){const o=i.transform;if(o instanceof Bn)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof on)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof an)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof Kn)return{fieldPath:i.field.canonicalString(),increment:o.k};throw k()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:xf(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:k()),t;var s}function Do(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?fe.updateTime(xe(s.updateTime)):void 0!==s.exists?fe.exists(s.exists):fe.none():fe.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(i,o){let a=null;"setToServerValue"in o?(U("REQUEST_TIME"===o.setToServerValue),a=new Bn):"appendMissingElements"in o?a=new on(o.appendMissingElements.values||[]):"removeAllFromArray"in o?a=new an(o.removeAllFromArray.values||[]):"increment"in o?a=new Kn(i,o.increment):k();const u=Te.fromServerFormat(o.fieldPath);return new Yr(u,a)}(n,s)):[];var s;if(e.update){const s=lt(n,e.update.name),i=new Re({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new Rn((e.updateMask.fieldPaths||[]).map(c=>Te.fromServerFormat(c)));return new un(s,i,o,t,r)}return new Xr(s,i,t,r)}if(e.delete){const s=lt(n,e.delete);return new Jr(s,t)}if(e.verify){const s=lt(n,e.verify);return new bo(s,t)}return k()}function cl(n,e){return{documents:[No(n,e.path)]}}function ll(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=No(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=No(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(u){if(0===u.length)return;const c=u.map(h=>function(f){if("=="===f.op){if(bc(f.value))return{unaryFilter:{field:Gn(f.field),op:"IS_NAN"}};if(Sc(f.value))return{unaryFilter:{field:Gn(f.field),op:"IS_NULL"}}}else if("!="===f.op){if(bc(f.value))return{unaryFilter:{field:Gn(f.field),op:"IS_NOT_NAN"}};if(Sc(f.value))return{unaryFilter:{field:Gn(f.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Gn(f.field),op:Df(f.op),value:f.value}}}(h));return 1===c.length?c[0]:{compositeFilter:{op:"AND",filters:c}}}(e.filters);s&&(t.structuredQuery.where=s);const i=function(u){if(0!==u.length)return u.map(c=>{return{field:Gn((h=c).field),direction:Nf(h.dir)};var h})}(e.orderBy);i&&(t.structuredQuery.orderBy=i);const o=(c=e.limit,n.N||rn(c)?c:{value:c});var c,a,u;return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(t.structuredQuery.endAt={before:!(u=e.endAt).inclusive,values:u.position}),t}function hl(n){let e=il(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){U(1===r);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=dl(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(h=>{return new Un($n((f=h).field),function(g){switch(g){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(f.direction));var f}));let a=null;t.limit&&(a=function(h){let f;return f="object"==typeof h?h.value:h,rn(f)?null:f}(t.limit));let u=null;var h;t.startAt&&(u=new Fn((h=t.startAt).values||[],!!h.before));let c=null;return t.endAt&&(c=function(h){return new Fn(h.values||[],!h.before)}(t.endAt)),Oc(e,s,o,i,a,"F",u,c)}function dl(n){return n?void 0!==n.unaryFilter?[Of(n)]:void 0!==n.fieldFilter?[kf(n)]:void 0!==n.compositeFilter?n.compositeFilter.filters.map(e=>dl(e)).reduce((e,t)=>e.concat(t)):k():[]}function Nf(n){return If[n]}function Df(n){return Ef[n]}function Gn(n){return{fieldPath:n.canonicalString()}}function $n(n){return Te.fromServerFormat(n.fieldPath)}function kf(n){return Ve.create($n(n.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return k()}}(n.fieldFilter.op),n.fieldFilter.value)}function Of(n){switch(n.unaryFilter.op){case"IS_NAN":const e=$n(n.unaryFilter.field);return Ve.create(e,"==",{doubleValue:NaN});case"IS_NULL":const t=$n(n.unaryFilter.field);return Ve.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=$n(n.unaryFilter.field);return Ve.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=$n(n.unaryFilter.field);return Ve.create(s,"!=",{nullValue:"NULL_VALUE"});default:return k()}}function Mf(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function fl(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function Se(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=ml(e)),e=Rf(n.get(t),e);return ml(e)}function Rf(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=i}}return t}function ml(n){return n+"\x01\x01"}function ht(n){const e=n.length;if(U(e>=2),2===e)return U("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),$.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("\x01",i);switch((o<0||o>t)&&k(),n.charAt(o+1)){case"\x01":const a=n.substring(i,o);let u;0===s.length?u=a:(s+=a,u=s,s=""),r.push(u);break;case"\x10":s+=n.substring(i,o),s+="\0";break;case"\x11":s+=n.substring(i,o+1);break;default:k()}i=o+2}return new $(r)}class Pf{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class ze{constructor(e,t,r){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=r}}ze.store="owner",ze.key="owner";class Dt{constructor(e,t,r){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=r}}Dt.store="mutationQueues",Dt.keyPath="userId";class J{constructor(e,t,r,s,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=r,this.baseMutations=s,this.mutations=i}}J.store="mutations",J.keyPath="batchId",J.userMutationsIndex="userMutationsIndex",J.userMutationsKeyPath=["userId","batchId"];class Pe{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,Se(t)]}static key(e,t,r){return[e,Se(t),r]}}Pe.store="documentMutations",Pe.PLACEHOLDER=new Pe;class Lf{constructor(e,t){this.path=e,this.readTime=t}}class Ff{constructor(e,t){this.path=e,this.version=t}}class oe{constructor(e,t,r,s,i,o){this.unknownDocument=e,this.noDocument=t,this.document=r,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=o}}oe.store="remoteDocuments",oe.readTimeIndex="readTimeIndex",oe.readTimeIndexPath="readTime",oe.collectionReadTimeIndex="collectionReadTimeIndex",oe.collectionReadTimeIndexPath=["parentPath","readTime"];class dt{constructor(e){this.byteSize=e}}dt.store="remoteDocumentGlobal",dt.key="remoteDocumentGlobalKey";class Be{constructor(e,t,r,s,i,o,a){this.targetId=e,this.canonicalId=t,this.readTime=r,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}}Be.store="targets",Be.keyPath="targetId",Be.queryTargetsIndexName="queryTargetsIndex",Be.queryTargetsKeyPath=["canonicalId","targetId"];class Me{constructor(e,t,r){this.targetId=e,this.path=t,this.sequenceNumber=r}}Me.store="targetDocuments",Me.keyPath=["targetId","path"],Me.documentTargetsIndex="documentTargetsIndex",Me.documentTargetsKeyPath=["path","targetId"];class Qe{constructor(e,t,r,s){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=r,this.targetCount=s}}Qe.key="targetGlobalKey",Qe.store="targetGlobal";class cn{constructor(e,t){this.collectionId=e,this.parent=t}}cn.store="collectionParents",cn.keyPath=["collectionId","parent"];class wt{constructor(e,t,r,s){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=r,this.inForeground=s}}wt.store="clientMetadata",wt.keyPath="clientId";class zn{constructor(e,t,r){this.bundleId=e,this.createTime=t,this.version=r}}zn.store="bundles",zn.keyPath="bundleId";class Qn{constructor(e,t,r){this.name=e,this.readTime=t,this.bundledQuery=r}}Qn.store="namedQueries",Qn.keyPath="name";class We{constructor(e,t,r){this.indexId=e,this.collectionGroup=t,this.fields=r}}We.store="indexConfiguration",We.keyPath="indexId",We.collectionGroupIndex="collectionGroupIndex",We.collectionGroupIndexPath="collectionGroup";class Je{constructor(e,t,r,s,i,o){this.indexId=e,this.uid=t,this.sequenceNumber=r,this.readTime=s,this.documentKey=i,this.largestBatchId=o}}Je.store="indexState",Je.keyPath=["indexId","uid"],Je.sequenceNumberIndex="sequenceNumberIndex",Je.sequenceNumberIndexPath=["uid","sequenceNumber"];class et{constructor(e,t,r,s,i){this.indexId=e,this.uid=t,this.arrayValue=r,this.directionalValue=s,this.documentKey=i}}et.store="indexEntries",et.keyPath=["indexId","uid","arrayValue","directionalValue","documentKey"],et.documentKeyIndex="documentKeyIndex",et.documentKeyIndexPath=["indexId","uid","documentKey"];class be{constructor(e,t,r,s,i,o){this.userId=e,this.collectionPath=t,this.documentId=r,this.collectionGroup=s,this.largestBatchId=i,this.overlayMutation=o}}be.store="documentOverlays",be.keyPath=["userId","collectionPath","documentId"],be.collectionPathOverlayIndex="collectionPathOverlayIndex",be.collectionPathOverlayIndexPath=["userId","collectionPath","largestBatchId"],be.collectionGroupOverlayIndex="collectionGroupOverlayIndex",be.collectionGroupOverlayIndexPath=["userId","collectionGroup","largestBatchId"];const gl=[Dt.store,J.store,Pe.store,oe.store,Be.store,ze.store,Qe.store,Me.store,wt.store,dt.store,cn.store,zn.store,Qn.store],pl=[...gl,be.store],Uf=[...pl,We.store,Je.store,et.store],yl="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class vl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class y{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&k(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new y((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof y?t:y.resolve(t)}catch(t){return y.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):y.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):y.reject(t)}static resolve(e){return new y((t,r)=>{t(e)})}static reject(e){return new y((t,r)=>{r(e)})}static waitFor(e){return new y((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},u=>r(u))}),o=!0,i===s&&t()})}static or(e){let t=y.resolve(!1);for(const r of e)t=t.next(s=>s?y.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}}class hi{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.At=new Ie,this.transaction.oncomplete=()=>{this.At.resolve()},this.transaction.onabort=()=>{t.error?this.At.reject(new os(e,t.error)):this.At.resolve()},this.transaction.onerror=r=>{const s=ko(r.target.error);this.At.reject(new os(e,s))}}static open(e,t,r,s){try{return new hi(t,e.transaction(s,r))}catch(i){throw new os(t,i)}}get Rt(){return this.At.promise}abort(e){e&&this.At.reject(e),this.aborted||(b("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}Pt(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new qf(t)}}class it{constructor(e,t,r){this.name=e,this.version=t,this.bt=r,12.2===it.vt((0,P.z$)())&&de("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return b("SimpleDb","Removing database:",e),hn(window.indexedDB.deleteDatabase(e)).toPromise()}static Vt(){if(!(0,P.hl)())return!1;if(it.St())return!0;const e=(0,P.z$)(),t=it.vt(e),r=0<t&&t<10,s=it.Dt(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static St(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Ct)}static Nt(e,t){return e.store(t)}static vt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static Dt(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}xt(e){var t=this;return(0,m.Z)(function*(){return t.db||(b("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,s)=>{const i=indexedDB.open(t.name,t.version);i.onsuccess=o=>{r(o.target.result)},i.onblocked=()=>{s(new os(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=o=>{const a=o.target.error;s("VersionError"===a.name?new T(p.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new T(p.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new os(e,a))},i.onupgradeneeded=o=>{b("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.bt.kt(o.target.result,i.transaction,o.oldVersion,t.version).next(()=>{b("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.Ot&&(t.db.onversionchange=r=>t.Ot(r)),t.db})()}Mt(e){this.Ot=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,s){var i=this;return(0,m.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{i.db=yield i.xt(e);const u=hi.open(i.db,e,o?"readonly":"readwrite",r),c=s(u).next(h=>(u.Pt(),h)).catch(h=>(u.abort(h),y.reject(h))).toPromise();return c.catch(()=>{}),yield u.Rt,c}catch(u){const c="FirebaseError"!==u.name&&a<3;if(b("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),i.close(),!c)return Promise.reject(u)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Vf{constructor(e){this.$t=e,this.Ft=!1,this.Bt=null}get isDone(){return this.Ft}get Lt(){return this.Bt}set cursor(e){this.$t=e}done(){this.Ft=!0}Ut(e){this.Bt=e}delete(){return hn(this.$t.delete())}}class os extends T{constructor(e,t){super(p.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ln(n){return"IndexedDbTransactionError"===n.name}class qf{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(b("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(b("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),hn(r)}add(e){return b("SimpleDb","ADD",this.store.name,e,e),hn(this.store.add(e))}get(e){return hn(this.store.get(e)).next(t=>(void 0===t&&(t=null),b("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return b("SimpleDb","DELETE",this.store.name,e),hn(this.store.delete(e))}count(){return b("SimpleDb","COUNT",this.store.name),hn(this.store.count())}qt(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const s=this.cursor(r),i=[];return this.Kt(s,(o,a)=>{i.push(a)}).next(()=>i)}{const s=this.store.getAll(r.range);return new y((i,o)=>{s.onerror=a=>{o(a.target.error)},s.onsuccess=a=>{i(a.target.result)}})}}Gt(e,t){b("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.jt=!1;const s=this.cursor(r);return this.Kt(s,(i,o,a)=>a.delete())}Qt(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.Kt(s,t)}Wt(e){const t=this.cursor({});return new y((r,s)=>{t.onerror=i=>{const o=ko(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}Kt(e,t){const r=[];return new y((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const u=new Vf(a),c=t(a.primaryKey,a.value,u);if(c instanceof y){const h=c.catch(f=>(u.done(),y.reject(f)));r.push(h)}u.isDone?s():null===u.Lt?a.continue():a.continue(u.Lt)}}).next(()=>y.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.jt?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function hn(n){return new y((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const s=ko(r.target.error);t(s)}})}let wl=!1;function ko(n){const e=it.vt((0,P.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new T("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return wl||(wl=!0,setTimeout(()=>{throw r},0)),r}}return n}class _l extends vl{constructor(e,t){super(),this.zt=e,this.currentSequenceNumber=t}}function Ae(n,e){const t=A(n);return it.Nt(t.zt,e)}class Oo{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&df(i,e,r[s])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&So(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&So(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(t=>{const r=e.get(t.key),s=r;this.applyToLocalView(s),r.isValidDocument()||s.convertToNoDocument(F.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Q())}isEqual(e){return this.batchId===e.batchId&&Mn(this.mutations,e.mutations,(t,r)=>Gc(t,r))&&Mn(this.baseMutations,e.baseMutations,(t,r)=>Gc(t,r))}}class Mo{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){U(e.mutations.length===r.length);let s=yf;const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Mo(e,t,r,s)}}class Ro{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class kt{constructor(e,t,r,s,i=F.min(),o=F.min(),a=ye.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new kt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new kt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new kt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Il{constructor(e){this.Ht=e}}function El(n,e){let t;if(e.document)t=ul(n.Ht,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=N.fromSegments(e.noDocument.path),s=fn(e.noDocument.readTime);t=re.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return k();{const r=N.fromSegments(e.unknownDocument.path),s=fn(e.unknownDocument.version);t=re.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(Lo(e.readTime)),t}function Tl(n,e){const t=Po(e.readTime),r=e.key.path.popLast().toArray();if(e.isFoundDocument()){const s={name:rs(o=n.Ht,(a=e).key),fields:a.data.value.mapValue.fields,updateTime:ns(o,a.version.toTimestamp())};return new oe(null,null,s,e.hasCommittedMutations,t,r)}var o,a;if(e.isNoDocument()){const s=e.key.path.toArray(),i=dn(e.version),o=e.hasCommittedMutations;return new oe(null,new Lf(s,i),null,o,t,r)}if(e.isUnknownDocument()){const s=e.key.path.toArray(),i=dn(e.version);return new oe(new Ff(s,i),null,null,!0,t,r)}return k()}function Po(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Lo(n){const e=new Ee(n[0],n[1]);return F.fromTimestamp(e)}function dn(n){const e=n.toTimestamp();return new Pf(e.seconds,e.nanoseconds)}function fn(n){const e=new Ee(n.seconds,n.nanoseconds);return F.fromTimestamp(e)}function Wn(n,e){const t=(e.baseMutations||[]).map(i=>Do(n.Ht,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];i+1<e.mutations.length&&void 0!==e.mutations[i+1].transform&&(o.updateTransforms=e.mutations[i+1].transform.fieldTransforms,e.mutations.splice(i+1,1),++i)}const r=e.mutations.map(i=>Do(n.Ht,i)),s=Ee.fromMillis(e.localWriteTimeMs);return new Oo(e.batchId,s,t,r)}function as(n){const e=fn(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?fn(n.lastLimboFreeSnapshotVersion):F.min();let r;var s;return void 0!==n.query.documents?(U(1===(s=n.query).documents.length),r=Ye(Vn(il(s.documents[0])))):r=Ye(hl(n.query)),new kt(r,n.targetId,0,n.lastListenSequenceNumber,e,t,ye.fromBase64String(n.resumeToken))}function xl(n,e){const t=dn(e.snapshotVersion),r=dn(e.lastLimboFreeSnapshotVersion);let s;s=ni(e.target)?cl(n.Ht,e.target):ll(n.Ht,e.target);const i=e.resumeToken.toBase64();return new Be(e.targetId,Hr(e.target),t,i,e.sequenceNumber,r,s)}function Fo(n){const e=hl({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?Mc(e,e.limit,"L"):e}function Uo(n,e){return new Ro(e.largestBatchId,Do(n.Ht,e.overlayMutation))}function Sl(n,e){const t=e.path.lastSegment();return[n,Se(e.path.popLast()),t]}class Bf{getBundleMetadata(e,t){return bl(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:fn(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return bl(e).put({bundleId:(r=t).id,createTime:dn(xe(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return Al(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:Fo(s.bundledQuery),readTime:fn(s.readTime)};var s})}saveNamedQuery(e,t){return Al(e).put({name:(r=t).name,readTime:dn(xe(r.readTime)),bundledQuery:r.bundledQuery});var r}}function bl(n){return Ae(n,zn.store)}function Al(n){return Ae(n,Qn.store)}class Vo{constructor(e,t){this.O=e,this.userId=t}static Jt(e,t){return new Vo(e,t.uid||"")}getOverlay(e,t){return us(e).get(Sl(this.userId,t)).next(r=>r?Uo(this.O,r):null)}saveOverlays(e,t,r){const s=[];return r.forEach(i=>{const o=new Ro(t,i);s.push(this.Yt(e,o))}),y.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Se(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(us(e).Gt(be.collectionPathOverlayIndex,a))}),y.waitFor(i)}getOverlaysForCollection(e,t,r){const s=new Map,i=Se(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return us(e).qt(be.collectionPathOverlayIndex,o).next(a=>{for(const u of a){const c=Uo(this.O,u);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=new Map;let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return us(e).Qt({index:be.collectionGroupOverlayIndex,range:a},(u,c,h)=>{const f=Uo(this.O,c);i.size<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}Yt(e,t){return us(e).put(function(r,s,i){const[o,a,u]=Sl(s,i.mutation.key);return new be(s,a,u,i.mutation.key.getCollectionGroup(),i.largestBatchId,is(r.Ht,i.mutation))}(this.O,this.userId,t))}}function us(n){return Ae(n,be.store)}class di{constructor(){}Xt(e,t){this.Zt(e,t),t.te()}Zt(e,t){if("nullValue"in e)this.ee(t,5);else if("booleanValue"in e)this.ee(t,10),t.ne(e.booleanValue?1:0);else if("integerValue"in e)this.ee(t,15),t.ne(ie(e.integerValue));else if("doubleValue"in e){const r=ie(e.doubleValue);isNaN(r)?this.ee(t,13):(this.ee(t,15),$r(r)?t.ne(0):t.ne(r))}else if("timestampValue"in e){const r=e.timestampValue;this.ee(t,20),"string"==typeof r?t.se(r):(t.se(`${r.seconds||""}`),t.ne(r.nanos||0))}else if("stringValue"in e)this.ie(e.stringValue,t),this.re(t);else if("bytesValue"in e)this.ee(t,30),t.oe(tn(e.bytesValue)),this.re(t);else if("referenceValue"in e)this.ce(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.ee(t,45),t.ne(r.latitude||0),t.ne(r.longitude||0)}else"mapValue"in e?st(e,Hd)?this.ee(t,Number.MAX_SAFE_INTEGER):(this.ue(e.mapValue,t),this.re(t)):"arrayValue"in e?(this.ae(e.arrayValue,t),this.re(t)):k()}ie(e,t){this.ee(t,25),this.he(e,t)}he(e,t){t.se(e)}ue(e,t){const r=e.fields||{};this.ee(t,55);for(const s of Object.keys(r))this.ie(s,t),this.Zt(r[s],t)}ae(e,t){const r=e.values||[];this.ee(t,50);for(const s of r)this.Zt(s,t)}ce(e,t){this.ee(t,37),N.fromName(e).path.forEach(r=>{this.ee(t,60),this.he(r,t)})}ee(e,t){e.ne(t)}re(e){e.ne(2)}}function Kf(n){if(0===n)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function Cl(n){const e=64-function(t){let r=0;for(let s=0;s<8;++s){const i=Kf(255&t[s]);if(r+=i,8!==i)break}return r}(n);return Math.ceil(e/8)}di.le=new di;class jf{constructor(){this.buffer=new Uint8Array(1024),this.position=0}fe(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.de(r.value),r=t.next();this._e()}we(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.me(r.value),r=t.next();this.ge()}ye(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.de(r);else if(r<2048)this.de(960|r>>>6),this.de(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.de(480|r>>>12),this.de(128|63&r>>>6),this.de(128|63&r);else{const s=t.codePointAt(0);this.de(240|s>>>18),this.de(128|63&s>>>12),this.de(128|63&s>>>6),this.de(128|63&s)}}this._e()}pe(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.me(r);else if(r<2048)this.me(960|r>>>6),this.me(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.me(480|r>>>12),this.me(128|63&r>>>6),this.me(128|63&r);else{const s=t.codePointAt(0);this.me(240|s>>>18),this.me(128|63&s>>>12),this.me(128|63&s>>>6),this.me(128|63&s)}}this.ge()}Ie(e){const t=this.Ee(e),r=Cl(t);this.Te(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Ae(e){const t=this.Ee(e),r=Cl(t);this.Te(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}Re(){this.Pe(255),this.Pe(255)}be(){this.ve(255),this.ve(255)}reset(){this.position=0}seed(e){this.Te(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ve(){return this.buffer.slice(0,this.position)}Ee(e){const t=function(s){const i=new DataView(new ArrayBuffer(8));return i.setFloat64(0,s,!1),new Uint8Array(i.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}de(e){const t=255&e;0===t?(this.Pe(0),this.Pe(255)):255===t?(this.Pe(255),this.Pe(0)):this.Pe(t)}me(e){const t=255&e;0===t?(this.ve(0),this.ve(255)):255===t?(this.ve(255),this.ve(0)):this.ve(e)}_e(){this.Pe(0),this.Pe(1)}ge(){this.ve(0),this.ve(1)}Pe(e){this.Te(1),this.buffer[this.position++]=e}ve(e){this.Te(1),this.buffer[this.position++]=~e}Te(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class Gf{constructor(e){this.Se=e}oe(e){this.Se.fe(e)}se(e){this.Se.ye(e)}ne(e){this.Se.Ie(e)}te(){this.Se.Re()}}class $f{constructor(e){this.Se=e}oe(e){this.Se.we(e)}se(e){this.Se.pe(e)}ne(e){this.Se.Ae(e)}te(){this.Se.be()}}class Nl{constructor(){this.Se=new jf,this.De=new Gf(this.Se),this.Ce=new $f(this.Se)}seed(e){this.Se.seed(e)}Ne(e){return 0===e?this.De:this.Ce}Ve(){return this.Se.Ve()}reset(){this.Se.reset()}}class qo{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}}function Bo(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=N.comparator(n.documentKey,e.documentKey),0!==t?t:(t=Dl(n.arrayValue,e.arrayValue),0!==t?t:Dl(n.directionalValue,e.directionalValue)))}function Dl(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class zf{constructor(){this.xe=new Ko}addToCollectionParentIndex(e,t){return this.xe.add(t),y.resolve()}getCollectionParents(e,t){return y.resolve(this.xe.getEntries(t))}addFieldIndex(e,t){return y.resolve()}deleteFieldIndex(e,t){return y.resolve()}getDocumentsMatchingTarget(e,t,r){return y.resolve(Q())}getFieldIndex(e,t){return y.resolve(null)}getFieldIndexes(e,t){return y.resolve([])}getNextCollectionGroupToUpdate(e){return y.resolve(null)}updateCollectionGroup(e,t,r){return y.resolve()}updateIndexEntries(e,t){return y.resolve()}}class Ko{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new te($.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new te($.comparator)).toArray()}}class Qf{constructor(e){this.user=e,this.ke=new Ko,this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.ke.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.ke.add(t)});const i={collectionId:r,parent:Se(s)};return kl(e).put(i)}return y.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[wc(t),""],!1,!0);return kl(e).qt(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(ht(o.parent))}return r})}addFieldIndex(e,t){const r=mi(e),s=new We((i=t).indexId,i.collectionGroup,i.fields.map(o=>[o.fieldPath.canonicalString(),o.kind]));var i;return delete s.indexId,r.add(s).next()}deleteFieldIndex(e,t){const r=mi(e),s=gi(e),i=fi(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t,r){return y.resolve(Q())}getFieldIndex(e,t){return y.resolve(null)}Oe(e,t){const r=new Nl;for(const s of e.fields.filter(o=>2!==o.kind)){const i=t.data.field(s.fieldPath);if(null==i)return null;const o=r.Ne(s.kind);di.le.Xt(i,o)}return r.Ve()}Me(e){const t=new Nl;return di.le.Xt(e,t.Ne(0)),t.Ve()}getFieldIndexes(e,t){const r=mi(e),s=gi(e);return(t?r.qt(We.collectionGroupIndex,IDBKeyRange.bound(t,t)):r.qt()).next(i=>{const o=[];return y.forEach(i,a=>s.get([a.indexId,this.uid]).next(u=>{o.push(function(c,h){const f=h?new Wr(h.sequenceNumber,new ei(fn(h.readTime),new N(ht(h.documentKey)),h.largestBatchId)):Wr.empty(),g=c.fields.map(([I,x])=>new Js(Te.fromServerFormat(I),x));return new wo(c.indexId,c.collectionGroup,g,f)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,s)=>r.indexState.sequenceNumber-s.indexState.sequenceNumber),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=mi(e),i=gi(e);return this.$e(e).next(o=>s.qt(We.collectionGroupIndex,IDBKeyRange.bound(t,t)).next(a=>y.forEach(a,u=>{return i.put(new Je(u.indexId,this.user.uid||"",o,dn((g=r).readTime),Se(g.documentKey.path),g.largestBatchId));var g})))}updateIndexEntries(e,t){const r=new Map;return y.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?y.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),y.forEach(a,u=>this.Fe(e,s,u).next(c=>{const h=this.Be(i,u);return c.isEqual(h)?y.resolve():this.Le(e,i,c,h)}))))})}Ue(e,t,r){return fi(e).put(new et(r.indexId,this.uid,r.arrayValue,r.directionalValue,Se(t.key.path)))}qe(e,t,r){return fi(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,Se(t.key.path)])}Fe(e,t,r){const s=fi(e);let i=new te(Bo);return s.Qt({index:et.documentKeyIndex,range:IDBKeyRange.only([r.indexId,this.uid,Se(t.path)])},(o,a)=>{i=i.add(new qo(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Be(e,t){let r=new te(Bo);const s=this.Oe(t,e);if(null==s)return r;const i=t.fields.find(a=>2===a.kind);if(null!=i){const o=e.data.field(i.fieldPath);if(Ys(o))for(const a of o.arrayValue.values||[])r=r.add(new qo(t.indexId,e.key,this.Me(a),s))}else r=r.add(new qo(t.indexId,e.key,new Uint8Array,s));return r}Le(e,t,r,s){b("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const i=[];return function(o,a,u,c,h){const f=o.getIterator(),g=a.getIterator();let I=jn(f),x=jn(g);for(;I||x;){let O=!1,V=!1;if(I&&x){const pe=u(I,x);pe<0?V=!0:pe>0&&(O=!0)}else null!=I?V=!0:O=!0;O?(c(x),x=jn(g)):V?(h(I),I=jn(f)):(I=jn(f),x=jn(g))}}(r,s,Bo,o=>{i.push(this.Ue(e,t,o))},o=>{i.push(this.qe(e,t,o))}),y.waitFor(i)}$e(e){let t=1;return gi(e).Qt({index:Je.sequenceNumberIndex,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}}function kl(n){return Ae(n,cn.store)}function fi(n){return Ae(n,et.store)}function mi(n){return Ae(n,We.store)}function gi(n){return Ae(n,Je.store)}const Ol={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ke{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Ke(e,Ke.DEFAULT_COLLECTION_PERCENTILE,Ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Ml(n,e,t){const r=n.store(J.store),s=n.store(Pe.store),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.Qt({range:o},(h,f,g)=>(a++,g.delete()));i.push(u.next(()=>{U(1===a)}));const c=[];for(const h of t.mutations){const f=Pe.key(e,h.key.path,t.batchId);i.push(s.delete(f)),c.push(h.key)}return y.waitFor(i).next(()=>c)}function pi(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw k();e=n.noDocument}return JSON.stringify(e).length}Ke.DEFAULT_COLLECTION_PERCENTILE=10,Ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ke.DEFAULT=new Ke(41943040,Ke.DEFAULT_COLLECTION_PERCENTILE,Ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ke.DISABLED=new Ke(-1,0,0);class jo{constructor(e,t,r,s){this.userId=e,this.O=t,this.indexManager=r,this.referenceDelegate=s,this.Ke={}}static Jt(e,t,r,s){U(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new jo(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ot(e).Qt({index:J.userMutationsIndex,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Hn(e),o=Ot(e);return o.add({}).next(a=>{U("number"==typeof a);const u=new Oo(a,t,r,s),c=function(g,I,x){const O=x.baseMutations.map(pe=>is(g.Ht,pe)),V=x.mutations.map(pe=>is(g.Ht,pe));return new J(I,x.batchId,x.localWriteTime.toMillis(),O,V)}(this.O,this.userId,u),h=[];let f=new te((g,I)=>q(g.canonicalString(),I.canonicalString()));for(const g of s){const I=Pe.key(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),h.push(o.put(c)),h.push(i.put(I,Pe.PLACEHOLDER))}return f.forEach(g=>{h.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Ke[a]=u.keys()}),y.waitFor(h).next(()=>u)})}lookupMutationBatch(e,t){return Ot(e).get(t).next(r=>r?(U(r.userId===this.userId),Wn(this.O,r)):null)}Ge(e,t){return this.Ke[t]?y.resolve(this.Ke[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Ke[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Ot(e).Qt({index:J.userMutationsIndex,range:s},(o,a,u)=>{a.userId===this.userId&&(U(a.batchId>=r),i=Wn(this.O,a)),u.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Ot(e).Qt({index:J.userMutationsIndex,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ot(e).qt(J.userMutationsIndex,t).next(r=>r.map(s=>Wn(this.O,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Pe.prefixForPath(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Hn(e).Qt({range:s},(o,a,u)=>{const[c,h,f]=o,g=ht(h);if(c===this.userId&&t.path.isEqual(g))return Ot(e).get(f).next(I=>{if(!I)throw k();U(I.userId===this.userId),i.push(Wn(this.O,I))});u.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new te(q);const s=[];return t.forEach(i=>{const o=Pe.prefixForPath(this.userId,i.path),a=IDBKeyRange.lowerBound(o),u=Hn(e).Qt({range:a},(c,h,f)=>{const[g,I,x]=c,O=ht(I);g===this.userId&&i.path.isEqual(O)?r=r.add(x):f.done()});s.push(u)}),y.waitFor(s).next(()=>this.je(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Pe.prefixForPath(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new te(q);return Hn(e).Qt({range:o},(u,c,h)=>{const[f,g,I]=u,x=ht(g);f===this.userId&&r.isPrefixOf(x)?x.length===s&&(a=a.add(I)):h.done()}).next(()=>this.je(e,a))}je(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Ot(e).get(i).next(o=>{if(null===o)throw k();U(o.userId===this.userId),r.push(Wn(this.O,o))}))}),y.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Ml(e.zt,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Qe(t.batchId)}),y.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}Qe(e){delete this.Ke[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return y.resolve();const r=IDBKeyRange.lowerBound(Pe.prefixForUser(this.userId)),s=[];return Hn(e).Qt({range:r},(i,o,a)=>{if(i[0]===this.userId){const u=ht(i[1]);s.push(u)}else a.done()}).next(()=>{U(0===s.length)})})}containsKey(e,t){return Rl(e,this.userId,t)}We(e){return Pl(e).get(this.userId).next(t=>t||new Dt(this.userId,-1,""))}}function Rl(n,e,t){const r=Pe.prefixForPath(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Hn(n).Qt({range:i,jt:!0},(a,u,c)=>{const[h,f,g]=a;h===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function Ot(n){return Ae(n,J.store)}function Hn(n){return Ae(n,Pe.store)}function Pl(n){return Ae(n,Dt.store)}class mn{constructor(e){this.ze=e}next(){return this.ze+=2,this.ze}static He(){return new mn(0)}static Je(){return new mn(-1)}}class Wf{constructor(e,t){this.referenceDelegate=e,this.O=t}allocateTargetId(e){return this.Ye(e).next(t=>{const r=new mn(t.highestTargetId);return t.highestTargetId=r.next(),this.Xe(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Ye(e).next(t=>F.fromTimestamp(new Ee(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Ye(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Ye(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Xe(e,s)))}addTargetData(e,t){return this.Ze(e,t).next(()=>this.Ye(e).next(r=>(r.targetCount+=1,this.tn(t,r),this.Xe(e,r))))}updateTargetData(e,t){return this.Ze(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Zn(e).delete(t.targetId)).next(()=>this.Ye(e)).next(r=>(U(r.targetCount>0),r.targetCount-=1,this.Xe(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Zn(e).Qt((o,a)=>{const u=as(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(s++,i.push(this.removeTargetData(e,u)))}).next(()=>y.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Zn(e).Qt((r,s)=>{const i=as(s);t(i)})}Ye(e){return Ll(e).get(Qe.key).next(t=>(U(null!==t),t))}Xe(e,t){return Ll(e).put(Qe.key,t)}Ze(e,t){return Zn(e).put(xl(this.O,t))}tn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Ye(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Hr(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Zn(e).Qt({range:s,index:Be.queryTargetsIndexName},(o,a,u)=>{const c=as(a);ti(t,c.target)&&(i=c,u.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Mt(e);return t.forEach(o=>{const a=Se(o.path);s.push(i.put(new Me(r,a))),s.push(this.referenceDelegate.addReference(e,r,o))}),y.waitFor(s)}removeMatchingKeys(e,t,r){const s=Mt(e);return y.forEach(t,i=>{const o=Se(i.path);return y.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Mt(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Mt(e);let i=Q();return s.Qt({range:r,jt:!0},(o,a,u)=>{const c=ht(o[1]),h=new N(c);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=Se(t.path),s=IDBKeyRange.bound([r],[wc(r)],!1,!0);let i=0;return Mt(e).Qt({index:Me.documentTargetsIndex,jt:!0,range:s},([o,a],u,c)=>{0!==o&&(i++,c.done())}).next(()=>i>0)}Tt(e,t){return Zn(e).get(t).next(r=>r?as(r):null)}}function Zn(n){return Ae(n,Be.store)}function Ll(n){return Ae(n,Qe.store)}function Mt(n){return Ae(n,Me.store)}function gn(n){return Go.apply(this,arguments)}function Go(){return(Go=(0,m.Z)(function*(n){if(n.code!==p.FAILED_PRECONDITION||n.message!==yl)throw n;b("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}function Fl([n,e],[t,r]){const s=q(n,t);return 0===s?q(e,r):s}class Hf{constructor(e){this.en=e,this.buffer=new te(Fl),this.nn=0}sn(){return++this.nn}rn(e){const t=[e,this.sn()];if(this.buffer.size<this.en)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Fl(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Zf{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.on=!1,this.cn=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.un(e)}stop(){this.cn&&(this.cn.cancel(),this.cn=null)}get started(){return null!==this.cn}un(e){var t=this;const r=this.on?3e5:6e4;b("LruGarbageCollector",`Garbage collection scheduled in ${r}ms`),this.cn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",r,(0,m.Z)(function*(){t.cn=null,t.on=!0;try{yield e.collectGarbage(t.garbageCollector)}catch(s){ln(s)?b("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",s):yield gn(s)}yield t.un(e)}))}}class Yf{constructor(e,t){this.an=e,this.params=t}calculateTargetCount(e,t){return this.an.hn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return y.resolve($e.A);const r=new Hf(t);return this.an.forEachTarget(e,s=>r.rn(s.sequenceNumber)).next(()=>this.an.ln(e,s=>r.rn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.an.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.an.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(b("LruGarbageCollector","Garbage collection skipped; disabled"),y.resolve(Ol)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(b("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ol):this.fn(e,t))}getCacheSize(e){return this.an.getCacheSize(e)}fn(e,t){let r,s,i,o,a,u,c;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(b("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),mo()<=j.in.DEBUG&&b("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-h}ms\n\tDetermined least recently used ${s} in `+(a-o)+`ms\n\tRemoved ${i} targets in `+(u-a)+`ms\n\tRemoved ${f} documents in `+(c-u)+`ms\nTotal Duration: ${c-h}ms`),y.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}class Xf{constructor(e,t){this.db=e,this.garbageCollector=new Yf(this,t)}hn(e){const t=this.dn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}dn(e){let t=0;return this.ln(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}ln(e,t){return this._n(e,(r,s)=>t(s))}addReference(e,t,r){return yi(e,r)}removeReference(e,t,r){return yi(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return yi(e,t)}wn(e,t){return function(r,s){let i=!1;return Pl(r).Wt(o=>Rl(r,o,s).next(a=>(a&&(i=!0),y.resolve(!a)))).next(()=>i)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this._n(e,(o,a)=>{if(a<=t){const u=this.wn(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,F.min()),Mt(e).delete([0,Se(o.path)])))});s.push(u)}}).next(()=>y.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return yi(e,t)}_n(e,t){const r=Mt(e);let s,i=$e.A;return r.Qt({index:Me.documentTargetsIndex},([o,a],{path:u,sequenceNumber:c})=>{0===o?(i!==$e.A&&t(new N(ht(s)),i),i=c,s=u):i=$e.A}).next(()=>{i!==$e.A&&t(new N(ht(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function yi(n,e){return Mt(n).put((r=n.currentSequenceNumber,new Me(0,Se(e.path),r)));var r}class Yn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[s,i]of r)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(void 0!==s){for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t])}else this.inner[r]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return 1===r.length?delete this.inner[t]:r.splice(s,1),!0;return!1}forEach(e){en(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Ic(this.inner)}}class Ul{constructor(){this.changes=new Yn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,re.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?y.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Jf{constructor(e){this.O=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Rt(e).put(vi(t),r)}removeEntry(e,t){const r=Rt(e),s=vi(t);return r.delete(s)}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.mn(e,r)))}getEntry(e,t){return Rt(e).get(vi(t)).next(r=>this.gn(t,r))}yn(e,t){return Rt(e).get(vi(t)).next(r=>({document:this.gn(t,r),size:pi(r)}))}getEntries(e,t){let r=Xe();return this.pn(e,t,(s,i)=>{const o=this.gn(s,i);r=r.insert(s,o)}).next(()=>r)}In(e,t){let r=Xe(),s=new ue(N.comparator);return this.pn(e,t,(i,o)=>{const a=this.gn(i,o);r=r.insert(i,a),s=s.insert(i,pi(o))}).next(()=>({documents:r,En:s}))}pn(e,t,r){if(t.isEmpty())return y.resolve();const s=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator();let o=i.getNext();return Rt(e).Qt({range:s},(a,u,c)=>{const h=N.fromSegments(a);for(;o&&N.comparator(o,h)<0;)r(o,null),o=i.getNext();o&&o.isEqual(h)&&(r(o,u),o=i.hasNext()?i.getNext():null),o?c.Ut(o.path.toArray()):c.done()}).next(()=>{for(;o;)r(o,null),o=i.hasNext()?i.getNext():null})}getAll(e,t,r){let s=Xe();const i=t.length+1,o={};if(r.isEqual(F.min())){const a=t.toArray();o.range=IDBKeyRange.lowerBound(a)}else{const a=t.toArray(),u=Po(r);o.range=IDBKeyRange.lowerBound([a,u],!0),o.index=oe.collectionReadTimeIndex}return Rt(e).Qt(o,(a,u,c)=>{if(a.length!==i)return;const h=this.gn(N.fromSegments(a),u);t.isPrefixOf(h.key.path)?s=s.insert(h.key,h):c.done()}).next(()=>s)}newChangeBuffer(e){return new em(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Vl(e).get(dt.key).next(t=>(U(!!t),t))}mn(e,t){return Vl(e).put(dt.key,t)}gn(e,t){if(t){const r=El(this.O,t);if(!r.isNoDocument()||!r.version.isEqual(F.min()))return r}return re.newInvalidDocument(e)}}class em extends Ul{constructor(e,t){super(),this.Tn=e,this.trackRemovals=t,this.An=new Yn(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new te((i,o)=>q(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.An.get(i);if(o.isValidDocument()){const u=Tl(this.Tn.O,o);s=s.add(i.path.popLast()),r+=pi(u)-a,t.push(this.Tn.addEntry(e,i,u))}else if(r-=a,this.trackRemovals){const u=Tl(this.Tn.O,o.convertToNoDocument(F.min()));t.push(this.Tn.addEntry(e,i,u))}else t.push(this.Tn.removeEntry(e,i))}),s.forEach(i=>{t.push(this.Tn.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Tn.updateMetadata(e,r)),y.waitFor(t)}getFromCache(e,t){return this.Tn.yn(e,t).next(r=>(this.An.set(t,r.size),r.document))}getAllFromCache(e,t){return this.Tn.In(e,t).next(({documents:r,En:s})=>(s.forEach((i,o)=>{this.An.set(i,o)}),r))}}function Vl(n){return Ae(n,dt.store)}function Rt(n){return Ae(n,oe.store)}function vi(n){return n.path.toArray()}class tm{constructor(e){this.O=e}kt(e,t,r,s){const i=new hi("createOrUpgrade",t);var a;r<1&&s>=1&&(e.createObjectStore(ze.store),(a=e).createObjectStore(Dt.store,{keyPath:Dt.keyPath}),a.createObjectStore(J.store,{keyPath:J.keyPath,autoIncrement:!0}).createIndex(J.userMutationsIndex,J.userMutationsKeyPath,{unique:!0}),a.createObjectStore(Pe.store),ql(e),function(a){a.createObjectStore(oe.store)}(e));let o=y.resolve();return r<3&&s>=3&&(0!==r&&(function(a){a.deleteObjectStore(Me.store),a.deleteObjectStore(Be.store),a.deleteObjectStore(Qe.store)}(e),ql(e)),o=o.next(()=>function(a){const u=a.store(Qe.store),c=new Qe(0,0,F.min().toTimestamp(),0);return u.put(Qe.key,c)}(i))),r<4&&s>=4&&(0!==r&&(o=o.next(()=>function(a,u){return u.store(J.store).qt().next(c=>{a.deleteObjectStore(J.store),a.createObjectStore(J.store,{keyPath:J.keyPath,autoIncrement:!0}).createIndex(J.userMutationsIndex,J.userMutationsKeyPath,{unique:!0});const h=u.store(J.store),f=c.map(g=>h.put(g));return y.waitFor(f)})}(e,i))),o=o.next(()=>{!function(a){a.createObjectStore(wt.store,{keyPath:wt.keyPath})}(e)})),r<5&&s>=5&&(o=o.next(()=>this.Rn(i))),r<6&&s>=6&&(o=o.next(()=>(function(a){a.createObjectStore(dt.store)}(e),this.Pn(i)))),r<7&&s>=7&&(o=o.next(()=>this.bn(i))),r<8&&s>=8&&(o=o.next(()=>this.vn(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")})(e),function(a){const u=a.objectStore(oe.store);u.createIndex(oe.readTimeIndex,oe.readTimeIndexPath,{unique:!1}),u.createIndex(oe.collectionReadTimeIndex,oe.collectionReadTimeIndexPath,{unique:!1})}(t)})),r<10&&s>=10&&(o=o.next(()=>this.Vn(i))),r<11&&s>=11&&(o=o.next(()=>{(function(a){a.createObjectStore(zn.store,{keyPath:zn.keyPath})})(e),function(a){a.createObjectStore(Qn.store,{keyPath:Qn.keyPath})}(e)})),r<12&&s>=12&&(o=o.next(()=>{!function(a){const u=a.createObjectStore(be.store,{keyPath:be.keyPath});u.createIndex(be.collectionPathOverlayIndex,be.collectionPathOverlayIndexPath,{unique:!1}),u.createIndex(be.collectionGroupOverlayIndex,be.collectionGroupOverlayIndexPath,{unique:!1})}(e)})),r<13&&s>=13&&(o=o.next(()=>{!function(a){a.createObjectStore(We.store,{keyPath:We.keyPath,autoIncrement:!0}).createIndex(We.collectionGroupIndex,We.collectionGroupIndexPath,{unique:!1}),a.createObjectStore(Je.store,{keyPath:Je.keyPath}).createIndex(Je.sequenceNumberIndex,Je.sequenceNumberIndexPath,{unique:!1}),a.createObjectStore(et.store,{keyPath:et.keyPath}).createIndex(et.documentKeyIndex,et.documentKeyIndexPath,{unique:!1})}(e)})),o}Pn(e){let t=0;return e.store(oe.store).Qt((r,s)=>{t+=pi(s)}).next(()=>{const r=new dt(t);return e.store(dt.store).put(dt.key,r)})}Rn(e){const t=e.store(Dt.store),r=e.store(J.store);return t.qt().next(s=>y.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.qt(J.userMutationsIndex,o).next(a=>y.forEach(a,u=>{U(u.userId===i.userId);const c=Wn(this.O,u);return Ml(e,i.userId,c).next(()=>{})}))}))}bn(e){const t=e.store(Me.store),r=e.store(oe.store);return e.store(Qe.store).get(Qe.key).next(s=>{const i=[];return r.Qt((o,a)=>{const u=new $(o),c=[0,Se(u)];i.push(t.get(c).next(h=>h?y.resolve():t.put(new Me(0,Se(u),s.highestListenSequenceNumber))))}).next(()=>y.waitFor(i))})}vn(e,t){e.createObjectStore(cn.store,{keyPath:cn.keyPath});const r=t.store(cn.store),s=new Ko,i=o=>{if(s.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Se(u)})}};return t.store(oe.store).Qt({jt:!0},(o,a)=>{const u=new $(o);return i(u.popLast())}).next(()=>t.store(Pe.store).Qt({jt:!0},([o,a,u],c)=>{const h=ht(a);return i(h.popLast())}))}Vn(e){const t=e.store(Be.store);return t.Qt((r,s)=>{const i=as(s),o=xl(this.O,i);return t.put(o)})}}function ql(n){n.createObjectStore(Me.store,{keyPath:Me.keyPath}).createIndex(Me.documentTargetsIndex,Me.documentTargetsKeyPath,{unique:!0}),n.createObjectStore(Be.store,{keyPath:Be.keyPath}).createIndex(Be.queryTargetsIndexName,Be.queryTargetsKeyPath,{unique:!0}),n.createObjectStore(Qe.store)}const $o="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class zo{constructor(e,t,r,s,i,o,a,u,c,h,f=12){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Sn=i,this.window=o,this.document=a,this.Dn=c,this.Cn=h,this.schemaVersion=f,this.Nn=null,this.xn=!1,this.isPrimary=!1,this.networkEnabled=!0,this.kn=null,this.inForeground=!1,this.On=null,this.Mn=null,this.$n=Number.NEGATIVE_INFINITY,this.Fn=g=>Promise.resolve(),!zo.Vt())throw new T(p.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Xf(this,s),this.Bn=t+"main",this.O=new Il(u),this.Ln=new it(this.Bn,this.schemaVersion,new tm(this.O)),this.Un=new Wf(this.referenceDelegate,this.O),this.qn=new Jf(this.O),this.Kn=new Bf,this.window&&this.window.localStorage?this.Gn=this.window.localStorage:(this.Gn=null,!1===h&&de("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.jn().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new T(p.FAILED_PRECONDITION,$o);return this.Qn(),this.Wn(),this.zn(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Un.getHighestSequenceNumber(e))}).then(e=>{this.Nn=new $e(e,this.Dn)}).then(()=>{this.xn=!0}).catch(e=>(this.Ln&&this.Ln.close(),Promise.reject(e)))}Hn(e){var t=this;return this.Fn=function(){var r=(0,m.Z)(function*(s){if(t.started)return e(s)});return function(s){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ln.Mt(function(){var t=(0,m.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Sn.enqueueAndForget((0,m.Z)(function*(){t.started&&(yield t.jn())})))}jn(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>wi(e).put(new wt(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.Jn(e).next(t=>{t||(this.isPrimary=!1,this.Sn.enqueueRetryable(()=>this.Fn(!1)))})}).next(()=>this.Yn(e)).next(t=>this.isPrimary&&!t?this.Xn(e).next(()=>!1):!!t&&this.Zn(e).next(()=>!0))).catch(e=>{if(ln(e))return b("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return b("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Sn.enqueueRetryable(()=>this.Fn(e)),this.isPrimary=e})}Jn(e){return cs(e).get(ze.key).next(t=>y.resolve(this.ts(t)))}es(e){return wi(e).delete(this.clientId)}ns(){var e=this;return(0,m.Z)(function*(){if(e.isPrimary&&!e.ss(e.$n,18e5)){e.$n=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const s=Ae(r,wt.store);return s.qt().next(i=>{const o=e.rs(i,18e5),a=i.filter(u=>-1===o.indexOf(u));return y.forEach(a,u=>s.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e.Gn)for(const r of t)e.Gn.removeItem(e.os(r.clientId))}})()}zn(){this.Mn=this.Sn.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.jn().then(()=>this.ns()).then(()=>this.zn()))}ts(e){return!!e&&e.ownerId===this.clientId}Yn(e){return this.Cn?y.resolve(!0):cs(e).get(ze.key).next(t=>{if(null!==t&&this.ss(t.leaseTimestampMs,5e3)&&!this.cs(t.ownerId)){if(this.ts(t)&&this.networkEnabled)return!0;if(!this.ts(t)){if(!t.allowTabSynchronization)throw new T(p.FAILED_PRECONDITION,$o);return!1}}return!(!this.networkEnabled||!this.inForeground)||wi(e).qt().next(r=>void 0===this.rs(r,5e3).find(s=>{if(this.clientId!==s.clientId){const o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(!this.networkEnabled&&s.networkEnabled||o&&a)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&b("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,m.Z)(function*(){e.xn=!1,e.us(),e.Mn&&(e.Mn.cancel(),e.Mn=null),e.hs(),e.ls(),yield e.Ln.runTransaction("shutdown","readwrite",[ze.store,wt.store],t=>{const r=new _l(t,$e.A);return e.Xn(r).next(()=>e.es(r))}),e.Ln.close(),e.fs()})()}rs(e,t){return e.filter(r=>this.ss(r.updateTimeMs,t)&&!this.cs(r.clientId))}ds(){return this.runTransaction("getActiveClients","readonly",e=>wi(e).qt().next(t=>this.rs(t,18e5).map(r=>r.clientId)))}get started(){return this.xn}getMutationQueue(e,t){return jo.Jt(e,this.O,t,this.referenceDelegate)}getTargetCache(){return this.Un}getRemoteDocumentCache(){return this.qn}getIndexManager(e){return new Qf(e)}getDocumentOverlayCache(e){return Vo.Jt(this.O,e)}getBundleCache(){return this.Kn}runTransaction(e,t,r){b("IndexedDbPersistence","Starting transaction:",e);const s="readonly"===t?"readonly":"readwrite",i=13===(o=this.schemaVersion)?Uf:12===o?pl:11===o?gl:void k();var o;let a;return this.Ln.runTransaction(e,s,i,u=>(a=new _l(u,this.Nn?this.Nn.next():$e.A),"readwrite-primary"===t?this.Jn(a).next(c=>!!c||this.Yn(a)).next(c=>{if(!c)throw de(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Sn.enqueueRetryable(()=>this.Fn(!1)),new T(p.FAILED_PRECONDITION,yl);return r(a)}).next(c=>this.Zn(a).next(()=>c)):this._s(a).next(()=>r(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}_s(e){return cs(e).get(ze.key).next(t=>{if(null!==t&&this.ss(t.leaseTimestampMs,5e3)&&!this.cs(t.ownerId)&&!this.ts(t)&&!(this.Cn||this.allowTabSynchronization&&t.allowTabSynchronization))throw new T(p.FAILED_PRECONDITION,$o)})}Zn(e){const t=new ze(this.clientId,this.allowTabSynchronization,Date.now());return cs(e).put(ze.key,t)}static Vt(){return it.Vt()}Xn(e){const t=cs(e);return t.get(ze.key).next(r=>this.ts(r)?(b("IndexedDbPersistence","Releasing primary lease."),t.delete(ze.key)):y.resolve())}ss(e,t){const r=Date.now();return!(e<r-t||e>r&&(de(`Detected an update time that is in the future: ${e} > ${r}`),1))}Qn(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.On=()=>{this.Sn.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.jn()))},this.document.addEventListener("visibilitychange",this.On),this.inForeground="visible"===this.document.visibilityState)}hs(){this.On&&(this.document.removeEventListener("visibilitychange",this.On),this.On=null)}Wn(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.kn=()=>{this.us(),(0,P.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Sn.enterRestrictedMode(!0),this.Sn.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.kn))}ls(){this.kn&&(this.window.removeEventListener("pagehide",this.kn),this.kn=null)}cs(e){var t;try{const r=null!==(null===(t=this.Gn)||void 0===t?void 0:t.getItem(this.os(e)));return b("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return de("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}us(){if(this.Gn)try{this.Gn.setItem(this.os(this.clientId),String(Date.now()))}catch(e){de("Failed to set zombie client id.",e)}}fs(){if(this.Gn)try{this.Gn.removeItem(this.os(this.clientId))}catch(e){}}os(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function cs(n){return Ae(n,ze.store)}function wi(n){return Ae(n,wt.store)}function Qo(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class nm{constructor(e,t){this.progress=e,this.ws=t}}class rm{constructor(e,t,r){this.qn=e,this.gs=t,this.indexManager=r}ys(e,t){return this.gs.getAllMutationBatchesAffectingDocumentKey(e,t).next(r=>this.ps(e,t,r))}ps(e,t,r){return this.qn.getEntry(e,t).next(s=>{for(const i of r)i.applyToLocalView(s);return s})}Is(e,t){e.forEach((r,s)=>{for(const i of t)i.applyToLocalView(s)})}Es(e,t){return this.qn.getEntries(e,t).next(r=>this.Ts(e,r).next(()=>r))}Ts(e,t){return this.gs.getAllMutationBatchesAffectingDocumentKeys(e,t).next(r=>this.Is(t,r))}As(e,t,r){return N.isDocumentKey((s=t).path)&&null===s.collectionGroup&&0===s.filters.length?this.Rs(e,t.path):Eo(t)?this.Ps(e,t,r):this.bs(e,t,r);var s}Rs(e,t){return this.ys(e,new N(t)).next(r=>{let s=Ao();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}Ps(e,t,r){const s=t.collectionGroup;let i=Ao();return this.indexManager.getCollectionParents(e,s).next(o=>y.forEach(o,a=>{const u=(c=t,h=a.child(s),new vt(h,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,h;return this.bs(e,u,r).next(c=>{c.forEach((h,f)=>{i=i.insert(h,f)})})}).next(()=>i))}bs(e,t,r){let s;return this.qn.getAll(e,t.path,r).next(i=>(s=i,this.gs.getAllMutationBatchesAffectingQuery(e,t))).next(i=>{for(const o of i)for(const a of o.mutations){const u=a.key;let c=s.get(u);null==c&&(c=re.newInvalidDocument(u),s=s.insert(u,c)),So(a,c,o.localWriteTime),c.isFoundDocument()||(s=s.remove(u))}}).next(()=>(s.forEach((i,o)=>{xo(t,o)||(s=s.remove(i))}),s))}}class Wo{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.vs=r,this.Vs=s}static Ss(e,t){let r=Q(),s=Q();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Wo(e,t.fromCache,r,s)}}class Bl{Ds(e){this.Cs=e}As(e,t,r,s){return 0===(i=t).filters.length&&null===i.limit&&null==i.startAt&&null==i.endAt&&(0===i.explicitOrderBy.length||1===i.explicitOrderBy.length&&i.explicitOrderBy[0].field.isKeyField())||r.isEqual(F.min())?this.Ns(e,t):this.Cs.Es(e,s).next(i=>{const o=this.xs(t,i);return(ri(t)||si(t))&&this.ks(t.limitType,o,s,r)?this.Ns(e,t):(mo()<=j.in.DEBUG&&b("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),To(t)),this.Cs.As(e,t,r).next(a=>(o.forEach(u=>{a=a.insert(u.key,u)}),a)))});var i}xs(e,t){let r=new te(Pc(e));return t.forEach((s,i)=>{xo(e,i)&&(r=r.add(i))}),r}ks(e,t,r,s){if(r.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ns(e,t){return mo()<=j.in.DEBUG&&b("QueryEngine","Using full collection scan to execute query:",To(t)),this.Cs.As(e,t,F.min())}}class sm{constructor(e,t,r,s){this.persistence=e,this.Os=t,this.O=s,this.Ms=new ue(q),this.$s=new Yn(i=>Hr(i),ti),this.Fs=F.min(),this.Bs=e.getRemoteDocumentCache(),this.Un=e.getTargetCache(),this.Kn=e.getBundleCache(),this.Ls(r)}Ls(e){this.indexManager=this.persistence.getIndexManager(e),this.gs=this.persistence.getMutationQueue(e,this.indexManager),this.Us=new rm(this.Bs,this.gs,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Os.Ds(this.Us)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function Kl(n,e,t,r){return new sm(n,e,t,r)}function jl(n,e){return Ho.apply(this,arguments)}function Ho(){return(Ho=(0,m.Z)(function*(n,e){const t=A(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.gs.getAllMutationBatches(r).next(i=>(s=i,t.Ls(e),t.gs.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let u=Q();for(const c of s){o.push(c.batchId);for(const h of c.mutations)u=u.add(h.key)}for(const c of i){a.push(c.batchId);for(const h of c.mutations)u=u.add(h.key)}return t.Us.Es(r,u).next(c=>({qs:c,removedBatchIds:o,addedBatchIds:a}))})})})).apply(this,arguments)}function im(n,e){const t=A(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Bs.newChangeBuffer({trackRemovals:!0});return function(o,a,u,c){const h=u.batch,f=h.keys();let g=y.resolve();return f.forEach(I=>{g=g.next(()=>c.getEntry(a,I)).next(x=>{const O=u.docVersions.get(I);U(null!==O),x.version.compareTo(O)<0&&(h.applyToRemoteDocument(x,u),x.isValidDocument()&&(x.setReadTime(u.commitVersion),c.addEntry(x)))})}),g.next(()=>o.gs.removeMutationBatch(a,h))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.gs.performConsistencyCheck(r)).next(()=>t.Us.Es(r,s))})}function Gl(n){const e=A(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Un.getLastRemoteSnapshotVersion(t))}function om(n,e){const t=A(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Bs.newChangeBuffer({trackRemovals:!0});s=t.Ms;const a=[];e.targetChanges.forEach((c,h)=>{const f=s.get(h);if(!f)return;a.push(t.Un.removeMatchingKeys(i,c.removedDocuments,h).next(()=>t.Un.addMatchingKeys(i,c.addedDocuments,h)));let g=f.withSequenceNumber(i.currentSequenceNumber);var I,x,O;e.targetMismatches.has(h)?g=g.withResumeToken(ye.EMPTY_BYTE_STRING,F.min()).withLastLimboFreeSnapshotVersion(F.min()):c.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(c.resumeToken,r)),s=s.insert(h,g),x=g,O=c,(0===(I=f).resumeToken.approximateByteSize()||x.snapshotVersion.toMicroseconds()-I.snapshotVersion.toMicroseconds()>=3e8||O.addedDocuments.size+O.modifiedDocuments.size+O.removedDocuments.size>0)&&a.push(t.Un.updateTargetData(i,g))});let u=Xe();if(e.documentUpdates.forEach(c=>{e.resolvedLimboDocuments.has(c)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,c))}),a.push($l(i,o,e.documentUpdates).next(c=>{u=c})),!r.isEqual(F.min())){const c=t.Un.getLastRemoteSnapshotVersion(i).next(h=>t.Un.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(c)}return y.waitFor(a).next(()=>o.apply(i)).next(()=>t.Us.Ts(i,u)).next(()=>u)}).then(i=>(t.Ms=s,i))}function $l(n,e,t){let r=Q();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let i=Xe();return t.forEach((o,a)=>{const u=s.get(o);a.isNoDocument()&&a.version.isEqual(F.min())?(e.removeEntry(o,a.readTime),i=i.insert(o,a)):!u.isValidDocument()||a.version.compareTo(u.version)>0||0===a.version.compareTo(u.version)&&u.hasPendingWrites?(e.addEntry(a),i=i.insert(o,a)):b("LocalStore","Ignoring outdated watch update for ",o,". Current version:",u.version," Watch version:",a.version)}),i})}function am(n,e){const t=A(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.gs.getNextMutationBatchAfterBatchId(r,e)))}function Xn(n,e){const t=A(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Un.getTargetData(r,e).next(i=>i?(s=i,y.resolve(s)):t.Un.allocateTargetId(r).next(o=>(s=new kt(e,o,0,r.currentSequenceNumber),t.Un.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ms.get(r.targetId);return(null===s||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.$s.set(e,r.targetId)),r})}function Jn(n,e,t){return Zo.apply(this,arguments)}function Zo(){return(Zo=(0,m.Z)(function*(n,e,t){const r=A(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!ln(o))throw o;b("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.$s.delete(s.target)})).apply(this,arguments)}function _i(n,e,t){const r=A(n);let s=F.min(),i=Q();return r.persistence.runTransaction("Execute query","readonly",o=>function(a,u,c){const h=A(a),f=h.$s.get(c);return void 0!==f?y.resolve(h.Ms.get(f)):h.Un.getTargetData(u,c)}(r,o,Ye(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Un.getMatchingKeysForTargetId(o,a.targetId).next(u=>{i=u})}).next(()=>r.Os.As(o,e,t?s:F.min(),t?i:Q())).next(a=>({documents:a,Ks:i})))}function zl(n,e){const t=A(n),r=A(t.Un),s=t.Ms.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.Tt(i,e).next(o=>o?o.target:null))}function Ql(n){const e=A(n);return e.persistence.runTransaction("Get new document changes","readonly",t=>function(r,s,i){const o=A(r);let a=Xe(),u=Po(i);const c=Rt(s),h=IDBKeyRange.lowerBound(u,!0);return c.Qt({index:oe.readTimeIndex,range:h},(f,g)=>{const I=El(o.O,g);a=a.insert(I.key,I),u=g.readTime}).next(()=>({ws:a,readTime:Lo(u)}))}(e.Bs,t,e.Fs)).then(({ws:t,readTime:r})=>(e.Fs=r,t))}function Yo(){return(Yo=(0,m.Z)(function*(n){const e=A(n);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>function(r){const s=Rt(r);let i=F.min();return s.Qt({index:oe.readTimeIndex,reverse:!0},(o,a,u)=>{a.readTime&&(i=Lo(a.readTime)),u.done()}).next(()=>i)}(t)).then(t=>{e.Fs=t})})).apply(this,arguments)}function Xo(){return(Xo=(0,m.Z)(function*(n,e,t,r){const s=A(n);let i=Q(),o=Xe();for(const c of t){const h=e.Gs(c.metadata.name);c.document&&(i=i.add(h));const f=e.js(c);f.setReadTime(e.Qs(c.metadata.readTime)),o=o.insert(h,f)}const a=s.Bs.newChangeBuffer({trackRemovals:!0}),u=yield Xn(s,(c=r,Ye(Vn($.fromString(`__bundle__/docs/${c}`)))));var c;return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>$l(c,a,o).next(h=>(a.apply(c),h)).next(h=>s.Un.removeMatchingKeysForTargetId(c,u.targetId).next(()=>s.Un.addMatchingKeys(c,i,u.targetId)).next(()=>s.Us.Ts(c,h)).next(()=>h)))})).apply(this,arguments)}function lm(n,e){return Jo.apply(this,arguments)}function Jo(){return(Jo=(0,m.Z)(function*(n,e,t=Q()){const r=yield Xn(n,Ye(Fo(e.bundledQuery))),s=A(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=xe(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Kn.saveNamedQuery(i,e);const a=r.withResumeToken(ye.EMPTY_BYTE_STRING,o);return s.Ms=s.Ms.insert(a.targetId,a),s.Un.updateTargetData(i,a).next(()=>s.Un.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Un.addMatchingKeys(i,t,r.targetId)).next(()=>s.Kn.saveNamedQuery(i,e))})})).apply(this,arguments)}class hm{constructor(e){this.O=e,this.Ws=new Map,this.zs=new Map}getBundleMetadata(e,t){return y.resolve(this.Ws.get(t))}saveBundleMetadata(e,t){var r;return this.Ws.set(t.id,{id:(r=t).id,version:r.version,createTime:xe(r.createTime)}),y.resolve()}getNamedQuery(e,t){return y.resolve(this.zs.get(t))}saveNamedQuery(e,t){return this.zs.set(t.name,{name:(r=t).name,query:Fo(r.bundledQuery),readTime:xe(r.readTime)}),y.resolve();var r}}class dm{constructor(){this.overlays=new ue(N.comparator),this.Hs=new Map}getOverlay(e,t){return y.resolve(this.overlays.get(t))}saveOverlays(e,t,r){return r.forEach(s=>{this.Yt(e,t,s)}),y.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Hs.get(r);return void 0!==s&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Hs.delete(r)),y.resolve()}getOverlaysForCollection(e,t,r){const s=new Map,i=t.length+1,o=new N(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return y.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new ue((c,h)=>c-h);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let h=i.get(c.largestBatchId);null===h&&(h=new Map,i=i.insert(c.largestBatchId,h)),h.set(c.getKey(),c)}}const a=new Map,u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,h)=>a.set(h,c)),!(a.size>=s)););return y.resolve(a)}Yt(e,t,r){if(null===r)return;const s=this.overlays.get(r.key);null!==s&&this.Hs.get(s.largestBatchId).delete(r.key),this.overlays=this.overlays.insert(r.key,new Ro(t,r));let i=this.Hs.get(t);void 0===i&&(i=new Set,this.Hs.set(t,i)),i.add(r.key)}}class ea{constructor(){this.Js=new te(Ce.Ys),this.Xs=new te(Ce.Zs)}isEmpty(){return this.Js.isEmpty()}addReference(e,t){const r=new Ce(e,t);this.Js=this.Js.add(r),this.Xs=this.Xs.add(r)}ti(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.ei(new Ce(e,t))}ni(e,t){e.forEach(r=>this.removeReference(r,t))}si(e){const t=new N(new $([])),r=new Ce(t,e),s=new Ce(t,e+1),i=[];return this.Xs.forEachInRange([r,s],o=>{this.ei(o),i.push(o.key)}),i}ii(){this.Js.forEach(e=>this.ei(e))}ei(e){this.Js=this.Js.delete(e),this.Xs=this.Xs.delete(e)}ri(e){const t=new N(new $([])),r=new Ce(t,e),s=new Ce(t,e+1);let i=Q();return this.Xs.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Ce(e,0),r=this.Js.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class Ce{constructor(e,t){this.key=e,this.oi=t}static Ys(e,t){return N.comparator(e.key,t.key)||q(e.oi,t.oi)}static Zs(e,t){return q(e.oi,t.oi)||N.comparator(e.key,t.key)}}class fm{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.gs=[],this.ci=1,this.ui=new te(Ce.Ys)}checkEmpty(e){return y.resolve(0===this.gs.length)}addMutationBatch(e,t,r,s){const i=this.ci;this.ci++;const o=new Oo(i,t,r,s);this.gs.push(o);for(const a of s)this.ui=this.ui.add(new Ce(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return y.resolve(o)}lookupMutationBatch(e,t){return y.resolve(this.ai(t))}getNextMutationBatchAfterBatchId(e,t){const s=this.hi(t+1),i=s<0?0:s;return y.resolve(this.gs.length>i?this.gs[i]:null)}getHighestUnacknowledgedBatchId(){return y.resolve(0===this.gs.length?-1:this.ci-1)}getAllMutationBatches(e){return y.resolve(this.gs.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Ce(t,0),s=new Ce(t,Number.POSITIVE_INFINITY),i=[];return this.ui.forEachInRange([r,s],o=>{const a=this.ai(o.oi);i.push(a)}),y.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new te(q);return t.forEach(s=>{const i=new Ce(s,0),o=new Ce(s,Number.POSITIVE_INFINITY);this.ui.forEachInRange([i,o],a=>{r=r.add(a.oi)})}),y.resolve(this.li(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;N.isDocumentKey(i)||(i=i.child(""));const o=new Ce(new N(i),0);let a=new te(q);return this.ui.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(u.oi)),!0)},o),y.resolve(this.li(a))}li(e){const t=[];return e.forEach(r=>{const s=this.ai(r);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){U(0===this.fi(t.batchId,"removed")),this.gs.shift();let r=this.ui;return y.forEach(t.mutations,s=>{const i=new Ce(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.ui=r})}Qe(e){}containsKey(e,t){const r=new Ce(t,0),s=this.ui.firstAfterOrEqual(r);return y.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return y.resolve()}fi(e,t){return this.hi(e)}hi(e){return 0===this.gs.length?0:e-this.gs[0].batchId}ai(e){const t=this.hi(e);return t<0||t>=this.gs.length?null:this.gs[t]}}class mm{constructor(e){this.di=e,this.docs=new ue(N.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.di(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return y.resolve(r?r.document.mutableCopy():re.newInvalidDocument(t))}getEntries(e,t){let r=Xe();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():re.newInvalidDocument(s))}),y.resolve(r)}getAll(e,t,r){let s=Xe();const i=new N(t.child("")),o=this.docs.getIteratorFrom(i);for(;o.hasNext();){const{key:a,value:{document:u}}=o.getNext();if(!t.isPrefixOf(a.path))break;a.path.length>t.length+1||u.readTime.compareTo(r)<=0||(s=s.insert(u.key,u.mutableCopy()))}return y.resolve(s)}_i(e,t){return y.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new gm(this)}getSize(e){return y.resolve(this.size)}}class gm extends Ul{constructor(e){super(),this.Tn=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Tn.addEntry(e,s)):this.Tn.removeEntry(r)}),y.waitFor(t)}getFromCache(e,t){return this.Tn.getEntry(e,t)}getAllFromCache(e,t){return this.Tn.getEntries(e,t)}}class pm{constructor(e){this.persistence=e,this.wi=new Yn(t=>Hr(t),ti),this.lastRemoteSnapshotVersion=F.min(),this.highestTargetId=0,this.mi=0,this.gi=new ea,this.targetCount=0,this.yi=mn.He()}forEachTarget(e,t){return this.wi.forEach((r,s)=>t(s)),y.resolve()}getLastRemoteSnapshotVersion(e){return y.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return y.resolve(this.mi)}allocateTargetId(e){return this.highestTargetId=this.yi.next(),y.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.mi&&(this.mi=t),y.resolve()}Ze(e){this.wi.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.yi=new mn(t),this.highestTargetId=t),e.sequenceNumber>this.mi&&(this.mi=e.sequenceNumber)}addTargetData(e,t){return this.Ze(t),this.targetCount+=1,y.resolve()}updateTargetData(e,t){return this.Ze(t),y.resolve()}removeTargetData(e,t){return this.wi.delete(t.target),this.gi.si(t.targetId),this.targetCount-=1,y.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.wi.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.wi.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),y.waitFor(i).next(()=>s)}getTargetCount(e){return y.resolve(this.targetCount)}getTargetData(e,t){const r=this.wi.get(t)||null;return y.resolve(r)}addMatchingKeys(e,t,r){return this.gi.ti(t,r),y.resolve()}removeMatchingKeys(e,t,r){this.gi.ni(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),y.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.gi.si(t),y.resolve()}getMatchingKeysForTargetId(e,t){const r=this.gi.ri(t);return y.resolve(r)}containsKey(e,t){return y.resolve(this.gi.containsKey(t))}}class ym{constructor(e,t){this.pi={},this.overlays={},this.Nn=new $e(0),this.xn=!1,this.xn=!0,this.referenceDelegate=e(this),this.Un=new pm(this),this.indexManager=new zf,this.qn=new mm(r=>this.referenceDelegate.Ii(r)),this.O=new Il(t),this.Kn=new hm(this.O)}start(){return Promise.resolve()}shutdown(){return this.xn=!1,Promise.resolve()}get started(){return this.xn}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new dm,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.pi[e.toKey()];return r||(r=new fm(t,this.referenceDelegate),this.pi[e.toKey()]=r),r}getTargetCache(){return this.Un}getRemoteDocumentCache(){return this.qn}getBundleCache(){return this.Kn}runTransaction(e,t,r){b("MemoryPersistence","Starting transaction:",e);const s=new vm(this.Nn.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.Ti(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,t){return y.or(Object.values(this.pi).map(r=>()=>r.containsKey(e,t)))}}class vm extends vl{constructor(e){super(),this.currentSequenceNumber=e}}class ta{constructor(e){this.persistence=e,this.Ri=new ea,this.Pi=null}static bi(e){return new ta(e)}get vi(){if(this.Pi)return this.Pi;throw k()}addReference(e,t,r){return this.Ri.addReference(r,t),this.vi.delete(r.toString()),y.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.vi.add(r.toString()),y.resolve()}markPotentiallyOrphaned(e,t){return this.vi.add(t.toString()),y.resolve()}removeTarget(e,t){this.Ri.si(t.targetId).forEach(s=>this.vi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.vi.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Pi=new Set}Ti(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return y.forEach(this.vi,r=>{const s=N.fromPath(r);return this.Vi(e,s).next(i=>{i||t.removeEntry(s,F.min())})}).next(()=>(this.Pi=null,t.apply(e)))}updateLimboDocument(e,t){return this.Vi(e,t).next(r=>{r?this.vi.delete(t.toString()):this.vi.add(t.toString())})}Ii(e){return 0}Vi(e,t){return y.or([()=>y.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}function Wl(n,e){return`firestore_clients_${n}_${e}`}function Hl(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function na(n,e){return`firestore_targets_${n}_${e}`}class Ii{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Si(e,t,r){const s=JSON.parse(r);let i,o="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return o&&s.error&&(o="string"==typeof s.error.message&&"string"==typeof s.error.code,o&&(i=new T(s.error.code,s.error.message))),o?new Ii(e,t,s.state,i):(de("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Di(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ls{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Si(e,t){const r=JSON.parse(t);let s,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new T(r.error.code,r.error.message))),i?new ls(e,r.state,s):(de("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Di(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ei{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Si(e,t){const r=JSON.parse(t);let s="object"==typeof r&&r.activeTargetIds instanceof Array,i=ci();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=Tc(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Ei(e,i):(de("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class ra{constructor(e,t){this.clientId=e,this.onlineState=t}static Si(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new ra(t.clientId,t.onlineState):(de("SharedClientState",`Failed to parse online state: ${e}`),null)}}class sa{constructor(){this.activeTargetIds=ci()}Ci(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ni(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Di(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ia{constructor(e,t,r,s,i){this.window=e,this.Sn=t,this.persistenceKey=r,this.xi=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ki=this.Oi.bind(this),this.Mi=new ue(q),this.started=!1,this.$i=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Fi=Wl(this.persistenceKey,this.xi),this.Bi=`firestore_sequence_number_${this.persistenceKey}`,this.Mi=this.Mi.insert(this.xi,new sa),this.Li=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ui=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.qi=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Ki=`firestore_online_state_${this.persistenceKey}`,this.Gi=function(a){return`firestore_bundle_loaded_${a}`}(this.persistenceKey),this.window.addEventListener("storage",this.ki)}static Vt(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,m.Z)(function*(){const t=yield e.syncEngine.ds();for(const s of t){if(s===e.xi)continue;const i=e.getItem(Wl(e.persistenceKey,s));if(i){const o=Ei.Si(s,i);o&&(e.Mi=e.Mi.insert(o.clientId,o))}}e.ji();const r=e.storage.getItem(e.Ki);if(r){const s=e.Qi(r);s&&e.Wi(s)}for(const s of e.$i)e.Oi(s);e.$i=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Bi,JSON.stringify(e))}getAllActiveQueryTargets(){return this.zi(this.Mi)}isActiveQueryTarget(e){let t=!1;return this.Mi.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Hi(e,"pending")}updateMutationState(e,t,r){this.Hi(e,t,r),this.Ji(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(na(this.persistenceKey,e));if(r){const s=ls.Si(e,r);s&&(t=s.state)}}return this.Yi.Ci(e),this.ji(),t}removeLocalQueryTarget(e){this.Yi.Ni(e),this.ji()}isLocalQueryTarget(e){return this.Yi.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(na(this.persistenceKey,e))}updateQueryState(e,t,r){this.Xi(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Ji(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Zi(e)}notifyBundleLoaded(){this.tr()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ki),this.removeItem(this.Fi),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return b("SharedClientState","READ",e,t),t}setItem(e,t){b("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){b("SharedClientState","REMOVE",e),this.storage.removeItem(e)}Oi(e){var t=this;const r=e;if(r.storageArea===this.storage){if(b("SharedClientState","EVENT",r.key,r.newValue),r.key===this.Fi)return void de("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Sn.enqueueRetryable((0,m.Z)(function*(){if(t.started){if(null!==r.key)if(t.Li.test(r.key)){if(null==r.newValue){const s=t.er(r.key);return t.nr(s,null)}{const s=t.sr(r.key,r.newValue);if(s)return t.nr(s.clientId,s)}}else if(t.Ui.test(r.key)){if(null!==r.newValue){const s=t.ir(r.key,r.newValue);if(s)return t.rr(s)}}else if(t.qi.test(r.key)){if(null!==r.newValue){const s=t.cr(r.key,r.newValue);if(s)return t.ur(s)}}else if(r.key===t.Ki){if(null!==r.newValue){const s=t.Qi(r.newValue);if(s)return t.Wi(s)}}else if(r.key===t.Bi){const s=function(i){let o=$e.A;if(null!=i)try{const a=JSON.parse(i);U("number"==typeof a),o=a}catch(a){de("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(r.newValue);s!==$e.A&&t.sequenceNumberHandler(s)}else if(r.key===t.Gi)return t.syncEngine.ar()}else t.$i.push(r)}))}}get Yi(){return this.Mi.get(this.xi)}ji(){this.setItem(this.Fi,this.Yi.Di())}Hi(e,t,r){const s=new Ii(this.currentUser,e,t,r),i=Hl(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Di())}Ji(e){const t=Hl(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Zi(e){this.storage.setItem(this.Ki,JSON.stringify({clientId:this.xi,onlineState:e}))}Xi(e,t,r){const s=na(this.persistenceKey,e),i=new ls(e,t,r);this.setItem(s,i.Di())}tr(){this.setItem(this.Gi,"value-not-used")}er(e){const t=this.Li.exec(e);return t?t[1]:null}sr(e,t){const r=this.er(e);return Ei.Si(r,t)}ir(e,t){const r=this.Ui.exec(e),s=Number(r[1]);return Ii.Si(new ke(void 0!==r[2]?r[2]:null),s,t)}cr(e,t){const r=this.qi.exec(e),s=Number(r[1]);return ls.Si(s,t)}Qi(e){return ra.Si(e)}rr(e){var t=this;return(0,m.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.hr(e.batchId,e.state,e.error);b("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}ur(e){return this.syncEngine.lr(e.targetId,e.state,e.error)}nr(e,t){const r=t?this.Mi.insert(e,t):this.Mi.remove(e),s=this.zi(this.Mi),i=this.zi(r),o=[],a=[];return i.forEach(u=>{s.has(u)||o.push(u)}),s.forEach(u=>{i.has(u)||a.push(u)}),this.syncEngine.dr(o,a).then(()=>{this.Mi=r})}Wi(e){this.Mi.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}zi(e){let t=ci();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Zl{constructor(){this._r=new sa,this.wr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this._r.Ci(e),this.wr[e]||"not-current"}updateQueryState(e,t,r){this.wr[e]=t}removeLocalQueryTarget(e){this._r.Ni(e)}isLocalQueryTarget(e){return this._r.activeTargetIds.has(e)}clearQueryState(e){delete this.wr[e]}getAllActiveQueryTargets(){return this._r.activeTargetIds}isActiveQueryTarget(e){return this._r.activeTargetIds.has(e)}start(){return this._r=new sa,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class wm{mr(e){}shutdown(){}}class Yl{constructor(){this.gr=()=>this.yr(),this.pr=()=>this.Ir(),this.Er=[],this.Tr()}mr(e){this.Er.push(e)}shutdown(){window.removeEventListener("online",this.gr),window.removeEventListener("offline",this.pr)}Tr(){window.addEventListener("online",this.gr),window.addEventListener("offline",this.pr)}yr(){b("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Er)e(0)}Ir(){b("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Er)e(1)}static Vt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const _m={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Im{constructor(e){this.Ar=e.Ar,this.Rr=e.Rr}Pr(e){this.br=e}vr(e){this.Vr=e}onMessage(e){this.Sr=e}close(){this.Rr()}send(e){this.Ar(e)}Dr(){this.br()}Cr(e){this.Vr(e)}Nr(e){this.Sr(e)}}class Em extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.kr=(e.ssl?"https":"http")+"://"+e.host,this.Or="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Mr(e,t,r,s,i){const o=this.$r(e,t);b("RestConnection","Sending: ",o,r);const a={};return this.Fr(a,s,i),this.Br(e,o,a,r).then(u=>(b("RestConnection","Received: ",u),u),u=>{throw Kr("RestConnection",`${e} failed with error: `,u,"url: ",o,"request:",r),u})}Lr(e,t,r,s,i){return this.Mr(e,t,r,s,i)}Fr(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+On,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}$r(e,t){return`${this.kr}/v1/${t}:${_m[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Br(e,t,r,s){return new Promise((i,o)=>{const a=new Pd;a.listenOnce(Od.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case fo.NO_ERROR:const c=a.getResponseJson();b("Connection","XHR received:",JSON.stringify(c)),i(c);break;case fo.TIMEOUT:b("Connection",'RPC "'+e+'" timed out'),o(new T(p.DEADLINE_EXCEEDED,"Request time out"));break;case fo.HTTP_ERROR:const h=a.getStatus();if(b("Connection",'RPC "'+e+'" failed with status:',h,"response text:",a.getResponseText()),h>0){const f=a.getResponseJson().error;if(f&&f.status&&f.message){const g=function(I){const x=I.toLowerCase().replace(/_/g,"-");return Object.values(p).indexOf(x)>=0?x:p.UNKNOWN}(f.status);o(new T(g,f.message))}else o(new T(p.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new T(p.UNAVAILABLE,"Connection failed."));break;default:k()}}finally{b("Connection",'RPC "'+e+'" completed.')}});const u=JSON.stringify(s);a.send(t,"POST",u,r,15)})}Ur(e,t,r){const s=[this.kr,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Dd(),o=kd(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new Rd({})),this.Fr(a.initMessageHeaders,t,r),(0,P.uI)()||(0,P.b$)()||(0,P.d)()||(0,P.w1)()||(0,P.Mn)()||(0,P.ru)()||(a.httpHeadersOverwriteParam="$httpHeaders");const u=s.join("");b("Connection","Creating WebChannel: "+u,a);const c=i.createWebChannel(u,a);let h=!1,f=!1;const g=new Im({Ar:x=>{f?b("Connection","Not sending because WebChannel is closed:",x):(h||(b("Connection","Opening WebChannel transport."),c.open(),h=!0),b("Connection","WebChannel sending:",x),c.send(x))},Rr:()=>c.close()}),I=(x,O,V)=>{x.listen(O,pe=>{try{V(pe)}catch(qe){setTimeout(()=>{throw qe},0)}})};return I(c,Hs.EventType.OPEN,()=>{f||b("Connection","WebChannel transport opened.")}),I(c,Hs.EventType.CLOSE,()=>{f||(f=!0,b("Connection","WebChannel transport closed"),g.Cr())}),I(c,Hs.EventType.ERROR,x=>{f||(f=!0,Kr("Connection","WebChannel transport errored:",x),g.Cr(new T(p.UNAVAILABLE,"The operation could not be completed")))}),I(c,Hs.EventType.MESSAGE,x=>{var O;if(!f){const V=x.data[0];U(!!V);const pe=V,qe=pe.error||(null===(O=pe[0])||void 0===O?void 0:O.error);if(qe){b("Connection","WebChannel received error:",qe);const Li=qe.status;let cr=function(Sp){const ed=me[Sp];if(void 0!==ed)return Zc(ed)}(Li),Fi=qe.message;void 0===cr&&(cr=p.INTERNAL,Fi="Unknown error status: "+Li+" with message "+qe.message),f=!0,g.Cr(new T(cr,Fi)),c.close()}else b("Connection","WebChannel received:",V),g.Nr(V)}}),I(o,Md.STAT_EVENT,x=>{x.stat===mc.PROXY?b("Connection","Detected buffering proxy"):x.stat===mc.NOPROXY&&b("Connection","Detected no buffering proxy")}),setTimeout(()=>{g.Dr()},0),g}}function Xl(){return"undefined"!=typeof window?window:null}function Ti(){return"undefined"!=typeof document?document:null}function hs(n){return new Tf(n,!0)}class oa{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Sn=e,this.timerId=t,this.qr=r,this.Kr=s,this.Gr=i,this.jr=0,this.Qr=null,this.Wr=Date.now(),this.reset()}reset(){this.jr=0}zr(){this.jr=this.Gr}Hr(e){this.cancel();const t=Math.floor(this.jr+this.Jr()),r=Math.max(0,Date.now()-this.Wr),s=Math.max(0,t-r);s>0&&b("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.jr} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Qr=this.Sn.enqueueAfterDelay(this.timerId,s,()=>(this.Wr=Date.now(),e())),this.jr*=this.Kr,this.jr<this.qr&&(this.jr=this.qr),this.jr>this.Gr&&(this.jr=this.Gr)}Yr(){null!==this.Qr&&(this.Qr.skipDelay(),this.Qr=null)}cancel(){null!==this.Qr&&(this.Qr.cancel(),this.Qr=null)}Jr(){return(Math.random()-.5)*this.jr}}class Jl{constructor(e,t,r,s,i,o,a,u){this.Sn=e,this.Xr=r,this.Zr=s,this.eo=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.no=0,this.so=null,this.io=null,this.stream=null,this.ro=new oa(e,t)}oo(){return 1===this.state||5===this.state||this.co()}co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.uo()}stop(){var e=this;return(0,m.Z)(function*(){e.oo()&&(yield e.close(0))})()}ao(){this.state=0,this.ro.reset()}ho(){this.co()&&null===this.so&&(this.so=this.Sn.enqueueAfterDelay(this.Xr,6e4,()=>this.lo()))}fo(e){this._o(),this.stream.send(e)}lo(){var e=this;return(0,m.Z)(function*(){if(e.co())return e.close(0)})()}_o(){this.so&&(this.so.cancel(),this.so=null)}wo(){this.io&&(this.io.cancel(),this.io=null)}close(e,t){var r=this;return(0,m.Z)(function*(){r._o(),r.wo(),r.ro.cancel(),r.no++,4!==e?r.ro.reset():t&&t.code===p.RESOURCE_EXHAUSTED?(de(t.toString()),de("Using maximum backoff delay to prevent overloading the backend."),r.ro.zr()):t&&t.code===p.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.mo(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.vr(t)})()}mo(){}auth(){this.state=1;const e=this.yo(this.no),t=this.no;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.no===t&&this.po(r,s)},r=>{e(()=>{const s=new T(p.UNKNOWN,"Fetching auth token failed: "+r.message);return this.Io(s)})})}po(e,t){const r=this.yo(this.no);this.stream=this.Eo(e,t),this.stream.Pr(()=>{r(()=>(this.state=2,this.io=this.Sn.enqueueAfterDelay(this.Zr,1e4,()=>(this.co()&&(this.state=3),Promise.resolve())),this.listener.Pr()))}),this.stream.vr(s=>{r(()=>this.Io(s))}),this.stream.onMessage(s=>{r(()=>this.onMessage(s))})}uo(){var e=this;this.state=5,this.ro.Hr((0,m.Z)(function*(){e.state=0,e.start()}))}Io(e){return b("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}yo(e){return t=>{this.Sn.enqueueAndForget(()=>this.no===e?t():(b("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Tm extends Jl{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.O=i}Eo(e,t){return this.eo.Ur("Listen",e,t)}onMessage(e){this.ro.reset();const t=function(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(u=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===u?1:"REMOVE"===u?2:"CURRENT"===u?3:"RESET"===u?4:k(),s=e.targetChange.targetIds||[],i=function(u,c){return u.N?(U(void 0===c||"string"==typeof c),ye.fromBase64String(c||"")):(U(void 0===c||c instanceof Uint8Array),ye.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const c=void 0===u.code?p.UNKNOWN:Zc(u.code);return new T(c,u.message||"")}(o);t=new Jc(r,s,i,a||null)}else if("documentChange"in e){const r=e.documentChange,s=lt(n,r.document.name),i=xe(r.document.updateTime),o=new Re({mapValue:{fields:r.document.fields}}),a=re.newFoundDocument(s,i,o);t=new li(r.targetIds||[],r.removedTargetIds||[],a.key,a)}else if("documentDelete"in e){const r=e.documentDelete,s=lt(n,r.document),i=r.readTime?xe(r.readTime):F.min(),o=re.newNoDocument(s,i);t=new li([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,s=lt(n,r.document);t=new li([],r.removedTargetIds||[],s,null)}else{if(!("filter"in e))return k();{const r=e.filter,i=new mf(r.count||0);t=new Xc(r.targetId,i)}}var u;return t}(this.O,e),r=function(s){if(!("targetChange"in s))return F.min();const i=s.targetChange;return i.targetIds&&i.targetIds.length?F.min():i.readTime?xe(i.readTime):F.min()}(e);return this.listener.To(t,r)}Ao(e){const t={};t.database=ss(this.O),t.addTarget=function(s,i){let o;const a=i.target;return o=ni(a)?{documents:cl(s,a)}:{query:ll(s,a)},o.targetId=i.targetId,i.resumeToken.approximateByteSize()>0?o.resumeToken=rl(s,i.resumeToken):i.snapshotVersion.compareTo(F.min())>0&&(o.readTime=ns(s,i.snapshotVersion.toTimestamp())),o}(this.O,e);const r=function(n,e){const t=function(r,s){switch(s){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return k()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.fo(t)}Ro(e){const t={};t.database=ss(this.O),t.removeTarget=e,this.fo(t)}}class xm extends Jl{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.O=i,this.Po=!1}get bo(){return this.Po}start(){this.Po=!1,this.lastStreamToken=void 0,super.start()}mo(){this.Po&&this.vo([])}Eo(e,t){return this.eo.Ur("Write",e,t)}onMessage(e){if(U(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Po){this.ro.reset();const t=function(n,e){return n&&n.length>0?(U(void 0!==e),n.map(t=>function(r,s){let i=xe(r.updateTime?r.updateTime:s);return i.isEqual(F.min())&&(i=xe(s)),new hf(i,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=xe(e.commitTime);return this.listener.Vo(r,t)}return U(!e.writeResults||0===e.writeResults.length),this.Po=!0,this.listener.So()}Do(){const e={};e.database=ss(this.O),this.fo(e)}vo(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>is(this.O,r))};this.fo(t)}}class Sm extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.eo=r,this.O=s,this.Co=!1}No(){if(this.Co)throw new T(p.FAILED_PRECONDITION,"The client has already been terminated.")}Mr(e,t,r){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.eo.Mr(e,t,r,s,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===p.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new T(p.UNKNOWN,s.toString())})}Lr(e,t,r){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.eo.Lr(e,t,r,s,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===p.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new T(p.UNKNOWN,s.toString())})}terminate(){this.Co=!0}}class bm{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.xo=0,this.ko=null,this.Oo=!0}Mo(){0===this.xo&&(this.$o("Unknown"),this.ko=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ko=null,this.Fo("Backend didn't respond within 10 seconds."),this.$o("Offline"),Promise.resolve())))}Bo(e){"Online"===this.state?this.$o("Unknown"):(this.xo++,this.xo>=1&&(this.Lo(),this.Fo(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.$o("Offline")))}set(e){this.Lo(),this.xo=0,"Online"===e&&(this.Oo=!1),this.$o(e)}$o(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Fo(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Oo?(de(t),this.Oo=!1):b("OnlineStateTracker",t)}Lo(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}}class Am{constructor(e,t,r,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Uo=[],this.qo=new Map,this.Ko=new Set,this.Go=[],this.jo=i,this.jo.mr(a=>{r.enqueueAndForget((0,m.Z)(function*(){var u;Pt(o)&&(b("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,m.Z)(function*(c){const h=A(c);h.Ko.add(4),yield er(h),h.Qo.set("Unknown"),h.Ko.delete(4),yield ds(h)}),function(c){return u.apply(this,arguments)})(o))}))}),this.Qo=new bm(r,s)}}function ds(n){return aa.apply(this,arguments)}function aa(){return(aa=(0,m.Z)(function*(n){if(Pt(n))for(const e of n.Go)yield e(!0)})).apply(this,arguments)}function er(n){return ua.apply(this,arguments)}function ua(){return(ua=(0,m.Z)(function*(n){for(const e of n.Go)yield e(!1)})).apply(this,arguments)}function xi(n,e){const t=A(n);t.qo.has(e.targetId)||(t.qo.set(e.targetId,e),ha(t)?la(t):nr(t).co()&&ca(t,e))}function fs(n,e){const t=A(n),r=nr(t);t.qo.delete(e),r.co()&&eh(t,e),0===t.qo.size&&(r.co()?r.ho():Pt(t)&&t.Qo.set("Unknown"))}function ca(n,e){n.Wo.Z(e.targetId),nr(n).Ao(e)}function eh(n,e){n.Wo.Z(e),nr(n).Ro(e)}function la(n){n.Wo=new _f({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Tt:e=>n.qo.get(e)||null}),nr(n).start(),n.Qo.Mo()}function ha(n){return Pt(n)&&!nr(n).oo()&&n.qo.size>0}function Pt(n){return 0===A(n).Ko.size}function th(n){n.Wo=void 0}function Cm(n){return da.apply(this,arguments)}function da(){return(da=(0,m.Z)(function*(n){n.qo.forEach((e,t)=>{ca(n,e)})})).apply(this,arguments)}function Nm(n,e){return fa.apply(this,arguments)}function fa(){return(fa=(0,m.Z)(function*(n,e){th(n),ha(n)?(n.Qo.Bo(e),la(n)):n.Qo.set("Unknown")})).apply(this,arguments)}function Dm(n,e,t){return ma.apply(this,arguments)}function ma(){return(ma=(0,m.Z)(function*(n,e,t){if(n.Qo.set("Online"),e instanceof Jc&&2===e.state&&e.cause)try{yield(r=(0,m.Z)(function*(s,i){const o=i.cause;for(const a of i.targetIds)s.qo.has(a)&&(yield s.remoteSyncer.rejectListen(a,o),s.qo.delete(a),s.Wo.removeTarget(a))}),function(s,i){return r.apply(this,arguments)})(n,e)}catch(r){b("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Si(n,r)}else if(e instanceof li?n.Wo.ct(e):e instanceof Xc?n.Wo._t(e):n.Wo.ht(e),!t.isEqual(F.min()))try{const r=yield Gl(n.localStore);t.compareTo(r)>=0&&(yield function(s,i){const o=s.Wo.yt(i);return o.targetChanges.forEach((a,u)=>{if(a.resumeToken.approximateByteSize()>0){const c=s.qo.get(u);c&&s.qo.set(u,c.withResumeToken(a.resumeToken,i))}}),o.targetMismatches.forEach(a=>{const u=s.qo.get(a);if(!u)return;s.qo.set(a,u.withResumeToken(ye.EMPTY_BYTE_STRING,u.snapshotVersion)),eh(s,a);const c=new kt(u.target,a,1,u.sequenceNumber);ca(s,c)}),s.remoteSyncer.applyRemoteEvent(o)}(n,t))}catch(r){b("RemoteStore","Failed to raise snapshot:",r),yield Si(n,r)}var r})).apply(this,arguments)}function Si(n,e,t){return ga.apply(this,arguments)}function ga(){return(ga=(0,m.Z)(function*(n,e,t){if(!ln(e))throw e;n.Ko.add(1),yield er(n),n.Qo.set("Offline"),t||(t=()=>Gl(n.localStore)),n.asyncQueue.enqueueRetryable((0,m.Z)(function*(){b("RemoteStore","Retrying IndexedDB access"),yield t(),n.Ko.delete(1),yield ds(n)}))})).apply(this,arguments)}function nh(n,e){return e().catch(t=>Si(n,t,e))}function tr(n){return pa.apply(this,arguments)}function pa(){return(pa=(0,m.Z)(function*(n){const e=A(n),t=Lt(e);let r=e.Uo.length>0?e.Uo[e.Uo.length-1].batchId:-1;for(;km(e);)try{const s=yield am(e.localStore,r);if(null===s){0===e.Uo.length&&t.ho();break}r=s.batchId,Om(e,s)}catch(s){yield Si(e,s)}rh(e)&&sh(e)})).apply(this,arguments)}function km(n){return Pt(n)&&n.Uo.length<10}function Om(n,e){n.Uo.push(e);const t=Lt(n);t.co()&&t.bo&&t.vo(e.mutations)}function rh(n){return Pt(n)&&!Lt(n).oo()&&n.Uo.length>0}function sh(n){Lt(n).start()}function Mm(n){return ya.apply(this,arguments)}function ya(){return(ya=(0,m.Z)(function*(n){Lt(n).Do()})).apply(this,arguments)}function Rm(n){return va.apply(this,arguments)}function va(){return(va=(0,m.Z)(function*(n){const e=Lt(n);for(const t of n.Uo)e.vo(t.mutations)})).apply(this,arguments)}function Pm(n,e,t){return wa.apply(this,arguments)}function wa(){return(wa=(0,m.Z)(function*(n,e,t){const r=n.Uo.shift(),s=Mo.from(r,e,t);yield nh(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield tr(n)})).apply(this,arguments)}function Lm(n,e){return _a.apply(this,arguments)}function _a(){return(_a=(0,m.Z)(function*(n,e){var t;e&&Lt(n).bo&&(yield(t=(0,m.Z)(function*(r,s){if(Hc(i=s.code)&&i!==p.ABORTED){const o=r.Uo.shift();Lt(r).ao(),yield nh(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield tr(r)}var i}),function(r,s){return t.apply(this,arguments)})(n,e)),rh(n)&&sh(n)})).apply(this,arguments)}function ih(n,e){return Ia.apply(this,arguments)}function Ia(){return(Ia=(0,m.Z)(function*(n,e){const t=A(n);t.asyncQueue.verifyOperationInProgress(),b("RemoteStore","RemoteStore received new credentials");const r=Pt(t);t.Ko.add(3),yield er(t),r&&t.Qo.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ko.delete(3),yield ds(t)})).apply(this,arguments)}function Ea(n,e){return Ta.apply(this,arguments)}function Ta(){return(Ta=(0,m.Z)(function*(n,e){const t=A(n);e?(t.Ko.delete(2),yield ds(t)):e||(t.Ko.add(2),yield er(t),t.Qo.set("Unknown"))})).apply(this,arguments)}function nr(n){return n.zo||(n.zo=function(e,t,r){const s=A(e);return s.No(),new Tm(t,s.eo,s.authCredentials,s.appCheckCredentials,s.O,r)}(n.datastore,n.asyncQueue,{Pr:Cm.bind(null,n),vr:Nm.bind(null,n),To:Dm.bind(null,n)}),n.Go.push(function(){var e=(0,m.Z)(function*(t){t?(n.zo.ao(),ha(n)?la(n):n.Qo.set("Unknown")):(yield n.zo.stop(),th(n))});return function(t){return e.apply(this,arguments)}}())),n.zo}function Lt(n){return n.Ho||(n.Ho=function(e,t,r){const s=A(e);return s.No(),new xm(t,s.eo,s.authCredentials,s.appCheckCredentials,s.O,r)}(n.datastore,n.asyncQueue,{Pr:Mm.bind(null,n),vr:Lm.bind(null,n),So:Rm.bind(null,n),Vo:Pm.bind(null,n)}),n.Go.push(function(){var e=(0,m.Z)(function*(t){t?(n.Ho.ao(),yield tr(n)):(yield n.Ho.stop(),n.Uo.length>0&&(b("RemoteStore",`Stopping write stream with ${n.Uo.length} pending writes`),n.Uo=[]))});return function(t){return e.apply(this,arguments)}}())),n.Ho}class xa{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Ie,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new xa(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new T(p.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function rr(n,e){if(de("AsyncQueue",`${e}: ${n}`),ln(n))return new T(p.UNAVAILABLE,`${e}: ${n}`);throw n}class sr{constructor(e){this.comparator=e?(t,r)=>e(t,r)||N.comparator(t.key,r.key):(t,r)=>N.comparator(t.key,r.key),this.keyedMap=Ao(),this.sortedSet=new ue(this.comparator)}static emptySet(e){return new sr(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof sr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new sr;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class oh{constructor(){this.Jo=new ue(N.comparator)}track(e){const t=e.doc.key,r=this.Jo.get(t);r?0!==e.type&&3===r.type?this.Jo=this.Jo.insert(t,e):3===e.type&&1!==r.type?this.Jo=this.Jo.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.Jo=this.Jo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.Jo=this.Jo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.Jo=this.Jo.remove(t):1===e.type&&2===r.type?this.Jo=this.Jo.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.Jo=this.Jo.insert(t,{type:2,doc:e.doc}):k():this.Jo=this.Jo.insert(t,e)}Yo(){const e=[];return this.Jo.inorderTraversal((t,r)=>{e.push(r)}),e}}class ir{constructor(e,t,r,s,i,o,a,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u}static fromInitialDocuments(e,t,r,s){const i=[];return t.forEach(o=>{i.push({type:0,doc:o})}),new ir(e,t,sr.emptySet(t),i,r,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Zr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class Fm{constructor(){this.Xo=void 0,this.listeners=[]}}class Um{constructor(){this.queries=new Yn(e=>Rc(e),Zr),this.onlineState="Unknown",this.Zo=new Set}}function Sa(n,e){return ba.apply(this,arguments)}function ba(){return(ba=(0,m.Z)(function*(n,e){const t=A(n),r=e.query;let s=!1,i=t.queries.get(r);if(i||(s=!0,i=new Fm),s)try{i.Xo=yield t.onListen(r)}catch(o){const a=rr(o,`Initialization of query '${To(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.listeners.push(e),e.tc(t.onlineState),i.Xo&&e.ec(i.Xo)&&Na(t)})).apply(this,arguments)}function Aa(n,e){return Ca.apply(this,arguments)}function Ca(){return(Ca=(0,m.Z)(function*(n,e){const t=A(n),r=e.query;let s=!1;const i=t.queries.get(r);if(i){const o=i.listeners.indexOf(e);o>=0&&(i.listeners.splice(o,1),s=0===i.listeners.length)}if(s)return t.queries.delete(r),t.onUnlisten(r)})).apply(this,arguments)}function Vm(n,e){const t=A(n);let r=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const a of o.listeners)a.ec(s)&&(r=!0);o.Xo=s}}r&&Na(t)}function qm(n,e,t){const r=A(n),s=r.queries.get(e);if(s)for(const i of s.listeners)i.onError(t);r.queries.delete(e)}function Na(n){n.Zo.forEach(e=>{e.next()})}class Da{constructor(e,t,r){this.query=e,this.nc=t,this.sc=!1,this.ic=null,this.onlineState="Unknown",this.options=r||{}}ec(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)3!==s.type&&r.push(s);e=new ir(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.sc?this.rc(e)&&(this.nc.next(e),t=!0):this.oc(e,this.onlineState)&&(this.cc(e),t=!0),this.ic=e,t}onError(e){this.nc.error(e)}tc(e){this.onlineState=e;let t=!1;return this.ic&&!this.sc&&this.oc(this.ic,e)&&(this.cc(this.ic),t=!0),t}oc(e,t){return!e.fromCache||!(this.options.uc&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}rc(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.ic&&this.ic.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}cc(e){e=ir.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.sc=!0,this.nc.next(e)}}class Bm{constructor(e,t){this.payload=e,this.byteLength=t}ac(){return"metadata"in this.payload}}class ah{constructor(e){this.O=e}Gs(e){return lt(this.O,e)}js(e){return e.metadata.exists?ul(this.O,e.document,!1):re.newNoDocument(this.Gs(e.metadata.name),this.Qs(e.metadata.readTime))}Qs(e){return xe(e)}}class Km{constructor(e,t,r){this.hc=e,this.localStore=t,this.O=r,this.queries=[],this.documents=[],this.progress=uh(e)}lc(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}fc(e){const t=new Map,r=new ah(this.O);for(const s of e)if(s.metadata.queries){const i=r.Gs(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Q()).add(i);t.set(o,a)}}return t}complete(){var e=this;return(0,m.Z)(function*(){const t=yield function(n,e,t,r){return Xo.apply(this,arguments)}(e.localStore,new ah(e.O),e.documents,e.hc.id),r=e.fc(e.documents);for(const s of e.queries)yield lm(e.localStore,s,r.get(s.name));return e.progress.taskState="Success",new nm(Object.assign({},e.progress),t)})()}}function uh(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class ch{constructor(e){this.key=e}}class lh{constructor(e){this.key=e}}class hh{constructor(e,t){this.query=e,this.dc=t,this._c=null,this.current=!1,this.wc=Q(),this.mutatedKeys=Q(),this.mc=Pc(e),this.gc=new sr(this.mc)}get yc(){return this.dc}Ic(e,t){const r=t?t.Ec:new oh,s=t?t.gc:this.gc;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const u=ri(this.query)&&s.size===this.query.limit?s.last():null,c=si(this.query)&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const g=s.get(h),I=xo(this.query,f)?f:null,x=!!g&&this.mutatedKeys.has(g.key),O=!!I&&(I.hasLocalMutations||this.mutatedKeys.has(I.key)&&I.hasCommittedMutations);let V=!1;g&&I?g.data.isEqual(I.data)?x!==O&&(r.track({type:3,doc:I}),V=!0):this.Tc(g,I)||(r.track({type:2,doc:I}),V=!0,(u&&this.mc(I,u)>0||c&&this.mc(I,c)<0)&&(a=!0)):!g&&I?(r.track({type:0,doc:I}),V=!0):g&&!I&&(r.track({type:1,doc:g}),V=!0,(u||c)&&(a=!0)),V&&(I?(o=o.add(I),i=O?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),ri(this.query)||si(this.query))for(;o.size>this.query.limit;){const h=ri(this.query)?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{gc:o,Ec:r,ks:a,mutatedKeys:i}}Tc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const s=this.gc;this.gc=e.gc,this.mutatedKeys=e.mutatedKeys;const i=e.Ec.Yo();i.sort((c,h)=>function(f,g){const I=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return k()}};return I(f)-I(g)}(c.type,h.type)||this.mc(c.doc,h.doc)),this.Ac(r);const o=t?this.Rc():[],a=0===this.wc.size&&this.current?1:0,u=a!==this._c;return this._c=a,0!==i.length||u?{snapshot:new ir(this.query,e.gc,s,i,e.mutatedKeys,0===a,u,!1),Pc:o}:{Pc:o}}tc(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({gc:this.gc,Ec:new oh,mutatedKeys:this.mutatedKeys,ks:!1},!1)):{Pc:[]}}bc(e){return!this.dc.has(e)&&!!this.gc.has(e)&&!this.gc.get(e).hasLocalMutations}Ac(e){e&&(e.addedDocuments.forEach(t=>this.dc=this.dc.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.dc=this.dc.delete(t)),this.current=e.current)}Rc(){if(!this.current)return[];const e=this.wc;this.wc=Q(),this.gc.forEach(r=>{this.bc(r.key)&&(this.wc=this.wc.add(r.key))});const t=[];return e.forEach(r=>{this.wc.has(r)||t.push(new lh(r))}),this.wc.forEach(r=>{e.has(r)||t.push(new ch(r))}),t}vc(e){this.dc=e.Ks,this.wc=Q();const t=this.Ic(e.documents);return this.applyChanges(t,!0)}Vc(){return ir.fromInitialDocuments(this.query,this.gc,this.mutatedKeys,0===this._c)}}class jm{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Gm{constructor(e){this.key=e,this.Sc=!1}}class $m{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Dc={},this.Cc=new Yn(a=>Rc(a),Zr),this.Nc=new Map,this.xc=new Set,this.kc=new ue(N.comparator),this.Oc=new Map,this.Mc=new ea,this.$c={},this.Fc=new Map,this.Bc=mn.Je(),this.onlineState="Unknown",this.Lc=void 0}get isPrimaryClient(){return!0===this.Lc}}function zm(n,e){return ka.apply(this,arguments)}function ka(){return(ka=(0,m.Z)(function*(n,e){const t=eu(n);let r,s;const i=t.Cc.get(e);if(i)r=i.targetId,t.sharedClientState.addLocalQueryTarget(r),s=i.view.Vc();else{const o=yield Xn(t.localStore,Ye(e));t.isPrimaryClient&&xi(t.remoteStore,o);const a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,s=yield Oa(t,e,r,"current"===a)}return s})).apply(this,arguments)}function Oa(n,e,t,r){return Ma.apply(this,arguments)}function Ma(){return(Ma=(0,m.Z)(function*(n,e,t,r){n.Uc=(h,f,g)=>{return(I=(0,m.Z)(function*(x,O,V,pe){let qe=O.view.Ic(V);qe.ks&&(qe=yield _i(x.localStore,O.query,!1).then(({documents:Fi})=>O.view.Ic(Fi,qe)));const Li=pe&&pe.targetChanges.get(O.targetId),cr=O.view.applyChanges(qe,x.isPrimaryClient,Li);return ja(x,O.targetId,cr.Pc),cr.snapshot}),function(x,O,V,pe){return I.apply(this,arguments)})(n,h,f,g);var I};const s=yield _i(n.localStore,e,!0),i=new hh(e,s.Ks),o=i.Ic(s.documents),a=ts.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),u=i.applyChanges(o,n.isPrimaryClient,a);ja(n,t,u.Pc);const c=new jm(e,t,i);return n.Cc.set(e,c),n.Nc.has(t)?n.Nc.get(t).push(e):n.Nc.set(t,[e]),u.snapshot})).apply(this,arguments)}function Qm(n,e){return Ra.apply(this,arguments)}function Ra(){return(Ra=(0,m.Z)(function*(n,e){const t=A(n),r=t.Cc.get(e),s=t.Nc.get(r.targetId);if(s.length>1)return t.Nc.set(r.targetId,s.filter(i=>!Zr(i,e))),void t.Cc.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield Jn(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),fs(t.remoteStore,r.targetId),or(t,r.targetId)}).catch(gn))):(or(t,r.targetId),yield Jn(t.localStore,r.targetId,!0))})).apply(this,arguments)}function Pa(){return(Pa=(0,m.Z)(function*(n,e,t){const r=tu(n);try{const s=yield function(i,o){const a=A(i),u=Ee.now(),c=o.reduce((f,g)=>f.add(g.key),Q());let h;return a.persistence.runTransaction("Locally write mutations","readwrite",f=>a.Us.Es(f,c).next(g=>{h=g;const I=[];for(const x of o){const O=ff(x,h.get(x.key));null!=O&&I.push(new un(x.key,O,Ac(O.value.mapValue),fe.exists(!0)))}return a.gs.addMutationBatch(f,u,I,o)})).then(f=>(f.applyToLocalDocumentSet(h),{batchId:f.batchId,changes:h}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(i,o,a){let u=i.$c[i.currentUser.toKey()];u||(u=new ue(q)),u=u.insert(o,a),i.$c[i.currentUser.toKey()]=u}(r,s.batchId,t),yield _t(r,s.changes),yield tr(r.remoteStore)}catch(s){const i=rr(s,"Failed to persist write");t.reject(i)}})).apply(this,arguments)}function dh(n,e){return La.apply(this,arguments)}function La(){return(La=(0,m.Z)(function*(n,e){const t=A(n);try{const r=yield om(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Oc.get(i);o&&(U(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.Sc=!0:s.modifiedDocuments.size>0?U(o.Sc):s.removedDocuments.size>0&&(U(o.Sc),o.Sc=!1))}),yield _t(t,r,e)}catch(r){yield gn(r)}})).apply(this,arguments)}function fh(n,e,t){const r=A(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const s=[];r.Cc.forEach((i,o)=>{const a=o.view.tc(e);a.snapshot&&s.push(a.snapshot)}),function(i,o){const a=A(i);a.onlineState=o;let u=!1;a.queries.forEach((c,h)=>{for(const f of h.listeners)f.tc(o)&&(u=!0)}),u&&Na(a)}(r.eventManager,e),s.length&&r.Dc.To(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Hm(n,e,t){return Fa.apply(this,arguments)}function Fa(){return(Fa=(0,m.Z)(function*(n,e,t){const r=A(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Oc.get(e),i=s&&s.key;if(i){let o=new ue(N.comparator);o=o.insert(i,re.newNoDocument(i,F.min()));const a=Q().add(i),u=new es(F.min(),new Map,new te(q),o,a);yield dh(r,u),r.kc=r.kc.remove(i),r.Oc.delete(e),Ga(r)}else yield Jn(r.localStore,e,!1).then(()=>or(r,e,t)).catch(gn)})).apply(this,arguments)}function Zm(n,e){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,m.Z)(function*(n,e){const t=A(n),r=e.batch.batchId;try{const s=yield im(t.localStore,e);Ka(t,r,null),Ba(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield _t(t,s)}catch(s){yield gn(s)}})).apply(this,arguments)}function Ym(n,e,t){return Va.apply(this,arguments)}function Va(){return(Va=(0,m.Z)(function*(n,e,t){const r=A(n);try{const s=yield function(i,o){const a=A(i);return a.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let c;return a.gs.lookupMutationBatch(u,o).next(h=>(U(null!==h),c=h.keys(),a.gs.removeMutationBatch(u,h))).next(()=>a.gs.performConsistencyCheck(u)).next(()=>a.Us.Es(u,c))})}(r.localStore,e);Ka(r,e,t),Ba(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield _t(r,s)}catch(s){yield gn(s)}})).apply(this,arguments)}function qa(){return(qa=(0,m.Z)(function*(n,e){const t=A(n);Pt(t.remoteStore)||b("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(i){const o=A(i);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>o.gs.getHighestUnacknowledgedBatchId(a))}(t.localStore);if(-1===r)return void e.resolve();const s=t.Fc.get(r)||[];s.push(e),t.Fc.set(r,s)}catch(r){const s=rr(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}})).apply(this,arguments)}function Ba(n,e){(n.Fc.get(e)||[]).forEach(t=>{t.resolve()}),n.Fc.delete(e)}function Ka(n,e,t){const r=A(n);let s=r.$c[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.$c[r.currentUser.toKey()]=s}}function or(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Nc.get(e))n.Cc.delete(r),t&&n.Dc.qc(r,t);n.Nc.delete(e),n.isPrimaryClient&&n.Mc.si(e).forEach(r=>{n.Mc.containsKey(r)||mh(n,r)})}function mh(n,e){n.xc.delete(e.path.canonicalString());const t=n.kc.get(e);null!==t&&(fs(n.remoteStore,t),n.kc=n.kc.remove(e),n.Oc.delete(t),Ga(n))}function ja(n,e,t){for(const r of t)r instanceof ch?(n.Mc.addReference(r.key,e),Jm(n,r)):r instanceof lh?(b("SyncEngine","Document no longer in limbo: "+r.key),n.Mc.removeReference(r.key,e),n.Mc.containsKey(r.key)||mh(n,r.key)):k()}function Jm(n,e){const t=e.key,r=t.path.canonicalString();n.kc.get(t)||n.xc.has(r)||(b("SyncEngine","New document in limbo: "+t),n.xc.add(r),Ga(n))}function Ga(n){for(;n.xc.size>0&&n.kc.size<n.maxConcurrentLimboResolutions;){const e=n.xc.values().next().value;n.xc.delete(e);const t=new N($.fromString(e)),r=n.Bc.next();n.Oc.set(r,new Gm(t)),n.kc=n.kc.insert(t,r),xi(n.remoteStore,new kt(Ye(Vn(t.path)),r,2,$e.A))}}function _t(n,e,t){return $a.apply(this,arguments)}function $a(){return($a=(0,m.Z)(function*(n,e,t){const r=A(n),s=[],i=[],o=[];var a;r.Cc.isEmpty()||(r.Cc.forEach((a,u)=>{o.push(r.Uc(u,e,t).then(c=>{if(c){r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c.fromCache?"not-current":"current"),s.push(c);const h=Wo.Ss(u.targetId,c);i.push(h)}}))}),yield Promise.all(o),r.Dc.To(s),yield(a=(0,m.Z)(function*(u,c){const h=A(u);try{yield h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>y.forEach(c,g=>y.forEach(g.vs,I=>h.persistence.referenceDelegate.addReference(f,g.targetId,I)).next(()=>y.forEach(g.Vs,I=>h.persistence.referenceDelegate.removeReference(f,g.targetId,I)))))}catch(f){if(!ln(f))throw f;b("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const g=f.targetId;if(!f.fromCache){const I=h.Ms.get(g),O=I.withLastLimboFreeSnapshotVersion(I.snapshotVersion);h.Ms=h.Ms.insert(g,O)}}}),function(u,c){return a.apply(this,arguments)})(r.localStore,i))})).apply(this,arguments)}function eg(n,e){return za.apply(this,arguments)}function za(){return(za=(0,m.Z)(function*(n,e){const t=A(n);if(!t.currentUser.isEqual(e)){b("SyncEngine","User change. New user:",e.toKey());const r=yield jl(t.localStore,e);t.currentUser=e,(s=t).Fc.forEach(o=>{o.forEach(a=>{a.reject(new T(p.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Fc.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield _t(t,r.qs)}var s})).apply(this,arguments)}function tg(n,e){const t=A(n),r=t.Oc.get(e);if(r&&r.Sc)return Q().add(r.key);{let s=Q();const i=t.Nc.get(e);if(!i)return s;for(const o of i){const a=t.Cc.get(o);s=s.unionWith(a.view.yc)}return s}}function ng(n,e){return Qa.apply(this,arguments)}function Qa(){return(Qa=(0,m.Z)(function*(n,e){const t=A(n),r=yield _i(t.localStore,e.query,!0),s=e.view.vc(r);return t.isPrimaryClient&&ja(t,e.targetId,s.Pc),s})).apply(this,arguments)}function rg(n){return Wa.apply(this,arguments)}function Wa(){return(Wa=(0,m.Z)(function*(n){const e=A(n);return Ql(e.localStore).then(t=>_t(e,t))})).apply(this,arguments)}function sg(n,e,t,r){return Ha.apply(this,arguments)}function Ha(){return(Ha=(0,m.Z)(function*(n,e,t,r){const s=A(n),i=yield function(o,a){const u=A(o),c=A(u.gs);return u.persistence.runTransaction("Lookup mutation documents","readonly",h=>c.Ge(h,a).next(f=>f?u.Us.Es(h,f):y.resolve(null)))}(s.localStore,e);var a;null!==i?("pending"===t?yield tr(s.remoteStore):"acknowledged"===t||"rejected"===t?(Ka(s,e,r||null),Ba(s,e),a=e,A(A(s.localStore).gs).Qe(a)):k(),yield _t(s,i)):b("SyncEngine","Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function Za(){return(Za=(0,m.Z)(function*(n,e){const t=A(n);if(eu(t),tu(t),!0===e&&!0!==t.Lc){const r=t.sharedClientState.getAllActiveQueryTargets(),s=yield gh(t,r.toArray());t.Lc=!0,yield Ea(t.remoteStore,!0);for(const i of s)xi(t.remoteStore,i)}else if(!1===e&&!1!==t.Lc){const r=[];let s=Promise.resolve();t.Nc.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(or(t,o),Jn(t.localStore,o,!0))),fs(t.remoteStore,o)}),yield s,yield gh(t,r),function(i){const o=A(i);o.Oc.forEach((a,u)=>{fs(o.remoteStore,u)}),o.Mc.ii(),o.Oc=new Map,o.kc=new ue(N.comparator)}(t),t.Lc=!1,yield Ea(t.remoteStore,!1)}})).apply(this,arguments)}function gh(n,e,t){return Ya.apply(this,arguments)}function Ya(){return(Ya=(0,m.Z)(function*(n,e,t){const r=A(n),s=[],i=[];for(const o of e){let a;const u=r.Nc.get(o);if(u&&0!==u.length){a=yield Xn(r.localStore,Ye(u[0]));for(const c of u){const h=r.Cc.get(c),f=yield ng(r,h);f.snapshot&&i.push(f.snapshot)}}else{const c=yield zl(r.localStore,o);a=yield Xn(r.localStore,c),yield Oa(r,ph(c),o,!1)}s.push(a)}return r.Dc.To(i),s})).apply(this,arguments)}function ph(n){return Oc(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function og(n){const e=A(n);return A(A(e.localStore).persistence).ds()}function ag(n,e,t,r){return Xa.apply(this,arguments)}function Xa(){return(Xa=(0,m.Z)(function*(n,e,t,r){const s=A(n);if(s.Lc)b("SyncEngine","Ignoring unexpected query state notification.");else if(s.Nc.has(e))switch(t){case"current":case"not-current":{const i=yield Ql(s.localStore),o=es.createSynthesizedRemoteEventForCurrentChange(e,"current"===t);yield _t(s,i,o);break}case"rejected":yield Jn(s.localStore,e,!0),or(s,e,r);break;default:k()}})).apply(this,arguments)}function ug(n,e,t){return Ja.apply(this,arguments)}function Ja(){return(Ja=(0,m.Z)(function*(n,e,t){const r=eu(n);if(r.Lc){for(const s of e){if(r.Nc.has(s)){b("SyncEngine","Adding an already active target "+s);continue}const i=yield zl(r.localStore,s),o=yield Xn(r.localStore,i);yield Oa(r,ph(i),o.targetId,!1),xi(r.remoteStore,o)}for(const s of t)r.Nc.has(s)&&(yield Jn(r.localStore,s,!1).then(()=>{fs(r.remoteStore,s),or(r,s)}).catch(gn))}})).apply(this,arguments)}function eu(n){const e=A(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=dh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=tg.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Hm.bind(null,e),e.Dc.To=Vm.bind(null,e.eventManager),e.Dc.qc=qm.bind(null,e.eventManager),e}function tu(n){const e=A(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Zm.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ym.bind(null,e),e}class yh{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,m.Z)(function*(){t.O=hs(e.databaseInfo.databaseId),t.sharedClientState=t.Gc(e),t.persistence=t.jc(e),yield t.persistence.start(),t.gcScheduler=t.Qc(e),t.localStore=t.Wc(e)})()}Qc(e){return null}Wc(e){return Kl(this.persistence,new Bl,e.initialUser,this.O)}jc(e){return new ym(ta.bi,this.O)}Gc(e){return new Zl}terminate(){var e=this;return(0,m.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class vh extends yh{constructor(e,t,r){super(),this.zc=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,m.Z)(function*(){yield t().call(r,e),yield function(n){return Yo.apply(this,arguments)}(r.localStore),yield r.zc.initialize(r,e),yield tu(r.zc.syncEngine),yield tr(r.zc.remoteStore),yield r.persistence.Hn(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(r.localStore),Promise.resolve()))})()}Wc(e){return Kl(this.persistence,new Bl,e.initialUser,this.O)}Qc(e){return new Zf(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue)}jc(e){const t=Qo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Ke.withCacheSize(this.cacheSizeBytes):Ke.DEFAULT;return new zo(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Xl(),Ti(),this.O,this.sharedClientState,!!this.forceOwnership)}Gc(e){return new Zl}}class lg extends vh{constructor(e,t){super(e,t,!1),this.zc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,m.Z)(function*(){yield t().call(r,e);const s=r.zc.syncEngine;r.sharedClientState instanceof ia&&(r.sharedClientState.syncEngine={hr:sg.bind(null,s),lr:ag.bind(null,s),dr:ug.bind(null,s),ds:og.bind(null,s),ar:rg.bind(null,s)},yield r.sharedClientState.start()),yield r.persistence.Hn(function(){var i=(0,m.Z)(function*(o){yield function(n,e){return Za.apply(this,arguments)}(r.zc.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start(r.localStore):o||r.gcScheduler.stop())});return function(o){return i.apply(this,arguments)}}())})()}Gc(e){const t=Xl();if(!ia.Vt(t))throw new T(p.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Qo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ia(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class nu{initialize(e,t){var r=this;return(0,m.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=s=>fh(r.syncEngine,s,1),r.remoteStore.remoteSyncer.handleCredentialChange=eg.bind(null,r.syncEngine),yield Ea(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Um}createDatastore(e){const t=hs(e.databaseInfo.databaseId),r=new Em(e.databaseInfo);return new Sm(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,s=e.asyncQueue,i=a=>fh(this.syncEngine,a,0),o=Yl.Vt()?new Yl:new wm,new Am(t,r,s,i,o);var t,r,s,i,o}createSyncEngine(e,t){return function(r,s,i,o,a,u,c){const h=new $m(r,s,i,o,a,u);return c&&(h.Lc=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,m.Z)(function*(t){const r=A(t);b("RemoteStore","RemoteStore shutting down."),r.Ko.add(5),yield er(r),r.jo.shutdown(),r.Qo.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function wh(n,e=10240){let t=0;return{read:()=>(0,m.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,m.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class bi{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Hc(this.observer.next,e)}error(e){this.observer.error?this.Hc(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Jc(){this.muted=!0}Hc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class hg{constructor(e,t){this.Yc=e,this.O=t,this.metadata=new Ie,this.buffer=new Uint8Array,this.Xc=new TextDecoder("utf-8"),this.Zc().then(r=>{r&&r.ac()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.payload)}`))},r=>this.metadata.reject(r))}close(){return this.Yc.cancel()}getMetadata(){var e=this;return(0,m.Z)(function*(){return e.metadata.promise})()}Kc(){var e=this;return(0,m.Z)(function*(){return yield e.getMetadata(),e.Zc()})()}Zc(){var e=this;return(0,m.Z)(function*(){const t=yield e.tu();if(null===t)return null;const r=e.Xc.decode(t),s=Number(r);isNaN(s)&&e.eu(`length string (${r}) is not valid number`);const i=yield e.nu(s);return new Bm(JSON.parse(i),t.length+s)})()}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}tu(){var e=this;return(0,m.Z)(function*(){for(;e.su()<0&&!(yield e.iu()););if(0===e.buffer.length)return null;const t=e.su();t<0&&e.eu("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}nu(e){var t=this;return(0,m.Z)(function*(){for(;t.buffer.length<e;)(yield t.iu())&&t.eu("Reached the end of bundle when more is expected.");const r=t.Xc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}eu(e){throw this.Yc.cancel(),new Error(`Invalid bundle format: ${e}`)}iu(){var e=this;return(0,m.Z)(function*(){const t=yield e.Yc.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class dg{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,m.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new T(p.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(s=(0,m.Z)(function*(i,o){const a=A(i),u=ss(a.O)+"/documents",c={documents:o.map(I=>rs(a.O,I))},h=yield a.Lr("BatchGetDocuments",u,c),f=new Map;h.forEach(I=>{const x=function(n,e){return"found"in e?function(t,r){U(!!r.found);const s=lt(t,r.found.name),i=xe(r.found.updateTime),o=new Re({mapValue:{fields:r.found.fields}});return re.newFoundDocument(s,i,o)}(n,e):"missing"in e?function(t,r){U(!!r.missing),U(!!r.readTime);const s=lt(t,r.missing),i=xe(r.readTime);return re.newNoDocument(s,i)}(n,e):k()}(a.O,I);f.set(x.key.toString(),x)});const g=[];return o.forEach(I=>{const x=f.get(I.toString());U(!!x),g.push(x)}),g}),function(i,o){return s.apply(this,arguments)})(t.datastore,e);var s;return r.forEach(s=>t.recordVersion(s)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Jr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,m.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,s)=>{const i=N.fromPath(s);e.mutations.push(new bo(i,e.precondition(i)))}),yield(r=(0,m.Z)(function*(s,i){const o=A(s),a=ss(o.O)+"/documents",u={writes:i.map(c=>is(o.O,c))};yield o.Mr("Commit",a,u)}),function(s,i){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw k();t=F.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new T(p.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?fe.updateTime(t):fe.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(F.min()))throw new T(p.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return fe.updateTime(t)}return fe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class fg{constructor(e,t,r,s){this.asyncQueue=e,this.datastore=t,this.updateFunction=r,this.deferred=s,this.ru=5,this.ro=new oa(this.asyncQueue,"transaction_retry")}run(){this.ru-=1,this.ou()}ou(){var e=this;this.ro.Hr((0,m.Z)(function*(){const t=new dg(e.datastore),r=e.cu(t);r&&r.then(s=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(s)}).catch(i=>{e.uu(i)}))}).catch(s=>{e.uu(s)})}))}cu(e){try{const t=this.updateFunction(e);return!rn(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}uu(e){this.ru>0&&this.au(e)?(this.ru-=1,this.asyncQueue.enqueueAndForget(()=>(this.ou(),Promise.resolve()))):this.deferred.reject(e)}au(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!Hc(t)}return!1}}class mg{constructor(e,t,r,s){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=ke.UNAUTHENTICATED,this.clientId=vc.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,m.Z)(function*(a){b("FirestoreClient","Received user=",a.uid),yield i.authCredentialListener(a),i.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(b("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return(0,m.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new T(p.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Ie;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,m.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const s=rr(r,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function _h(n,e){return ru.apply(this,arguments)}function ru(){return(ru=(0,m.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),b("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var s=(0,m.Z)(function*(i){r.isEqual(i)||(yield jl(e.localStore,i),r=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e})).apply(this,arguments)}function Ih(n,e){return su.apply(this,arguments)}function su(){return(su=(0,m.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield iu(n);b("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(s=>ih(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,i)=>ih(e.remoteStore,i)),n.onlineComponents=e})).apply(this,arguments)}function iu(n){return ou.apply(this,arguments)}function ou(){return(ou=(0,m.Z)(function*(n){return n.offlineComponents||(b("FirestoreClient","Using default OfflineComponentProvider"),yield _h(n,new yh)),n.offlineComponents})).apply(this,arguments)}function Ai(n){return au.apply(this,arguments)}function au(){return(au=(0,m.Z)(function*(n){return n.onlineComponents||(b("FirestoreClient","Using default OnlineComponentProvider"),yield Ih(n,new nu)),n.onlineComponents})).apply(this,arguments)}function Eh(n){return iu(n).then(e=>e.persistence)}function uu(n){return iu(n).then(e=>e.localStore)}function Th(n){return Ai(n).then(e=>e.remoteStore)}function cu(n){return Ai(n).then(e=>e.syncEngine)}function ar(n){return lu.apply(this,arguments)}function lu(){return(lu=(0,m.Z)(function*(n){const e=yield Ai(n),t=e.eventManager;return t.onListen=zm.bind(null,e.syncEngine),t.onUnlisten=Qm.bind(null,e.syncEngine),t})).apply(this,arguments)}function xh(n,e,t={}){const r=new Ie;return n.asyncQueue.enqueueAndForget((0,m.Z)(function*(){return function(s,i,o,a,u){const c=new bi({next:f=>{i.enqueueAndForget(()=>Aa(s,h));const g=f.docs.has(o);!g&&f.fromCache?u.reject(new T(p.UNAVAILABLE,"Failed to get document because the client is offline.")):g&&f.fromCache&&a&&"server"===a.source?u.reject(new T(p.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(f)},error:f=>u.reject(f)}),h=new Da(Vn(o.path),c,{includeMetadataChanges:!0,uc:!0});return Sa(s,h)}(yield ar(n),n.asyncQueue,e,t,r)})),r.promise}function Sh(n,e,t={}){const r=new Ie;return n.asyncQueue.enqueueAndForget((0,m.Z)(function*(){return function(s,i,o,a,u){const c=new bi({next:f=>{i.enqueueAndForget(()=>Aa(s,h)),f.fromCache&&"server"===a.source?u.reject(new T(p.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(f)},error:f=>u.reject(f)}),h=new Da(o,c,{includeMetadataChanges:!0,uc:!0});return Sa(s,h)}(yield ar(n),n.asyncQueue,e,t,r)})),r.promise}const bh=new Map;function hu(n,e,t){if(!t)throw new T(p.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Ah(n,e,t,r){if(!0===e&&!0===r)throw new T(p.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Ch(n){if(!N.isDocumentKey(n))throw new T(p.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Nh(n){if(N.isDocumentKey(n))throw new T(p.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ci(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":k()}function B(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new T(p.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ci(n);throw new T(p.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Dh(n,e){if(e<=0)throw new T(p.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class kh{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new T(p.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new T(p.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Ah("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ms{constructor(e,t,r){this._authCredentials=t,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new kh({}),this._settingsFrozen=!1,e instanceof nn?this._databaseId=e:(this._app=e,this._databaseId=function(s){if(!Object.prototype.hasOwnProperty.apply(s.options,["projectId"]))throw new T(p.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nn(s.options.projectId)}(e))}get app(){if(!this._app)throw new T(p.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new T(p.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new kh(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new Ud;switch(t.type){case"gapi":const r=t.client;return U(!("object"!=typeof r||null===r||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new Kd(r,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new T(p.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=bh.get(e);t&&(b("ComponentProvider","Removing Datastore"),bh.delete(e),t.terminate())}(this),Promise.resolve()}}function Tg(n,e,t,r={}){var s;const i=(n=B(n,ms))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Kr("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let o,a;if("string"==typeof r.mockUserToken)o=r.mockUserToken,a=ke.MOCK_USER;else{o=(0,P.Sg)(r.mockUserToken,null===(s=n._app)||void 0===s?void 0:s.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new T(p.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new ke(u)}n._authCredentials=new Vd(new pc(o,a))}}class ae{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ft(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ae(this.firestore,e,this._key)}}class Le{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Le(this.firestore,e,this._query)}}class ft extends Le{constructor(e,t,r){super(e,t,Vn(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ae(this.firestore,null,new N(e))}withConverter(e){return new ft(this.firestore,e,this._path)}}function xg(n,e,...t){if(n=(0,P.m9)(n),hu("collection","path",e),n instanceof ms){const r=$.fromString(e,...t);return Nh(r),new ft(n,null,r)}{if(!(n instanceof ae||n instanceof ft))throw new T(p.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child($.fromString(e,...t));return Nh(r),new ft(n.firestore,null,r)}}function Sg(n,e){if(n=B(n,ms),hu("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new T(p.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Le(n,null,(t=e,new vt($.emptyPath(),t)));var t}function Oh(n,e,...t){if(n=(0,P.m9)(n),1===arguments.length&&(e=vc.R()),hu("doc","path",e),n instanceof ms){const r=$.fromString(e,...t);return Ch(r),new ae(n,null,new N(r))}{if(!(n instanceof ae||n instanceof ft))throw new T(p.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child($.fromString(e,...t));return Ch(r),new ae(n.firestore,n instanceof ft?n.converter:null,new N(r))}}function bg(n,e){return n=(0,P.m9)(n),e=(0,P.m9)(e),(n instanceof ae||n instanceof ft)&&(e instanceof ae||e instanceof ft)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Mh(n,e){return n=(0,P.m9)(n),e=(0,P.m9)(e),n instanceof Le&&e instanceof Le&&n.firestore===e.firestore&&Zr(n._query,e._query)&&n.converter===e.converter}class Ag{constructor(){this.hu=Promise.resolve(),this.lu=[],this.fu=!1,this.du=[],this._u=null,this.wu=!1,this.mu=!1,this.gu=[],this.ro=new oa(this,"async_queue_retry"),this.yu=()=>{const t=Ti();t&&b("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ro.Yr()};const e=Ti();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.yu)}get isShuttingDown(){return this.fu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.fu){this.fu=!0,this.mu=e||!1;const t=Ti();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.yu)}}enqueue(e){if(this.pu(),this.fu)return new Promise(()=>{});const t=new Ie;return this.Iu(()=>this.fu&&this.mu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.lu.push(e),this.Eu()))}Eu(){var e=this;return(0,m.Z)(function*(){if(0!==e.lu.length){try{yield e.lu[0](),e.lu.shift(),e.ro.reset()}catch(t){if(!ln(t))throw t;b("AsyncQueue","Operation failed with retryable error: "+t)}e.lu.length>0&&e.ro.Hr(()=>e.Eu())}})()}Iu(e){const t=this.hu.then(()=>(this.wu=!0,e().catch(r=>{throw this._u=r,this.wu=!1,de("INTERNAL UNHANDLED ERROR: ",function(i){let o=i.message||"";return i.stack&&(o=i.stack.includes(i.message)?i.stack:i.message+"\n"+i.stack),o}(r)),r}).then(r=>(this.wu=!1,r))));return this.hu=t,t}enqueueAfterDelay(e,t,r){this.pu(),this.gu.indexOf(e)>-1&&(t=0);const s=xa.createAndSchedule(this,e,t,r,i=>this.Tu(i));return this.du.push(s),s}pu(){this._u&&k()}verifyOperationInProgress(){}Au(){var e=this;return(0,m.Z)(function*(){let t;do{t=e.hu,yield t}while(t!==e.hu)})()}Ru(e){for(const t of this.du)if(t.timerId===e)return!0;return!1}Pu(e){return this.Au().then(()=>{this.du.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.du)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Au()})}bu(e){this.gu.push(e)}Tu(e){const t=this.du.indexOf(e);this.du.splice(t,1)}}function du(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const s of["next","error","complete"])if(s in r&&"function"==typeof r[s])return!0;return!1}(n)}class Cg{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ie,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const Ng=-1;class ne extends ms{constructor(e,t,r){super(e,t,r),this.type="firestore",this._queue=new Ag,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Rh(this),this._firestoreClient.terminate()}}function ge(n){return n._firestoreClient||Rh(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Rh(n){var e;const t=n._freezeSettings(),r=(i=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Wd(n._databaseId,i,n._persistenceKey,(a=t).host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams));var i,a;n._firestoreClient=new mg(n._authCredentials,n._appCheckCredentials,n._queue,r)}function Dg(n,e){Lh(n=B(n,ne));const t=ge(n),r=n._freezeSettings(),s=new nu;return Ph(t,s,new vh(s,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}function kg(n){Lh(n=B(n,ne));const e=ge(n),t=n._freezeSettings(),r=new nu;return Ph(e,r,new lg(r,t.cacheSizeBytes))}function Ph(n,e,t){const r=new Ie;return n.asyncQueue.enqueue((0,m.Z)(function*(){try{yield _h(n,t),yield Ih(n,e),r.resolve()}catch(s){if(!("FirebaseError"===(i=s).name?i.code===p.FAILED_PRECONDITION||i.code===p.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&i instanceof DOMException)||22===i.code||20===i.code||11===i.code))throw s;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+s),r.reject(s)}var i})).then(()=>r.promise)}function Og(n){if(n._initialized&&!n._terminated)throw new T(p.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Ie;return n._queue.enqueueAndForgetEvenWhileRestricted((0,m.Z)(function*(){try{yield(t=(0,m.Z)(function*(r){if(!it.Vt())return Promise.resolve();const s=r+"main";yield it.delete(s)}),function(r){return t.apply(this,arguments)})(Qo(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}function Mg(n){return function(e){const t=new Ie;return e.asyncQueue.enqueueAndForget((0,m.Z)(function*(){return function(n,e){return qa.apply(this,arguments)}(yield cu(e),t)})),t.promise}(ge(n=B(n,ne)))}function Rg(n){return function(n){return n.asyncQueue.enqueue((0,m.Z)(function*(){const e=yield Eh(n),t=yield Th(n);return e.setNetworkEnabled(!0),function(r){const s=A(r);return s.Ko.delete(0),ds(s)}(t)}))}(ge(n=B(n,ne)))}function Pg(n){return function(n){return n.asyncQueue.enqueue((0,m.Z)(function*(){const e=yield Eh(n),t=yield Th(n);return e.setNetworkEnabled(!1),(r=(0,m.Z)(function*(s){const i=A(s);i.Ko.add(0),yield er(i),i.Qo.set("Offline")}),function(s){return r.apply(this,arguments)})(t);var r}))}(ge(n=B(n,ne)))}function Lg(n,e){const t=ge(n=B(n,ne)),r=new Cg;return function(n,e,t,r){const s=function(i,o){let a;return a="string"==typeof i?(new TextEncoder).encode(i):i,u=function(u,c){if(u instanceof Uint8Array)return wh(u,c);if(u instanceof ArrayBuffer)return wh(new Uint8Array(u),c);if(u instanceof ReadableStream)return u.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(a),new hg(u,o);var u}(t,hs(e));n.asyncQueue.enqueueAndForget((0,m.Z)(function*(){!function(n,e,t){const r=A(n);var s;(s=(0,m.Z)(function*(i,o,a){try{const u=yield o.getMetadata();if(yield function(g,I){const x=A(g),O=xe(I.createTime);return x.persistence.runTransaction("hasNewerBundle","readonly",V=>x.Kn.getBundleMetadata(V,I.id)).then(V=>!!V&&V.createTime.compareTo(O)>=0)}(i.localStore,u))return yield o.close(),void a._completeWith((g=u,{taskState:"Success",documentsLoaded:g.totalDocuments,bytesLoaded:g.totalBytes,totalDocuments:g.totalDocuments,totalBytes:g.totalBytes}));a._updateProgress(uh(u));const c=new Km(u,i.localStore,o.O);let h=yield o.Kc();for(;h;){const g=yield c.lc(h);g&&a._updateProgress(g),h=yield o.Kc()}const f=yield c.complete();yield _t(i,f.ws,void 0),yield function(g,I){const x=A(g);return x.persistence.runTransaction("Save bundle","readwrite",O=>x.Kn.saveBundleMetadata(O,I))}(i.localStore,u),a._completeWith(f.progress)}catch(u){Kr("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u)}var g}),function(i,o,a){return s.apply(this,arguments)})(r,e,t).then(()=>{r.sharedClientState.notifyBundleLoaded()})}(yield cu(n),s,r)}))}(t,n._databaseId,e,r),r}function Fg(n,e){return function(n,e){return n.asyncQueue.enqueue((0,m.Z)(function*(){return function(t,r){const s=A(t);return s.persistence.runTransaction("Get named query","readonly",i=>s.Kn.getNamedQuery(i,r))}(yield uu(n),e)}))}(ge(n=B(n,ne)),e).then(t=>t?new Le(n,null,t.query):null)}function Lh(n){if(n._initialized||n._terminated)throw new T(p.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Ft{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new T(p.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Te(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Ut{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ut(ye.fromBase64String(e))}catch(t){throw new T(p.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ut(ye.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class pn{constructor(e){this._methodName=e}}class Ni{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new T(p.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new T(p.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return q(this._lat,e._lat)||q(this._long,e._long)}}const Ug=/^__.*__$/;class Vg{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new un(e,this.data,this.fieldMask,t,this.fieldTransforms):new Xr(e,this.data,t,this.fieldTransforms)}}class Fh{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new un(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Uh(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw k()}}class Di{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.O=r,this.ignoreUndefinedProperties=s,void 0===i&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}Su(e){return new Di(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.O,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Du(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Su({path:r,Cu:!1});return s.Nu(e),s}xu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.Su({path:r,Cu:!1});return s.vu(),s}ku(e){return this.Su({path:void 0,Cu:!0})}Ou(e){return Mi(e,this.settings.methodName,this.settings.Mu||!1,this.path,this.settings.$u)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Nu(this.path.get(e))}Nu(e){if(0===e.length)throw this.Ou("Document fields must not be empty");if(Uh(this.Vu)&&Ug.test(e))throw this.Ou('Document fields cannot begin and end with "__"')}}class qg{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.O=r||hs(e)}Fu(e,t,r,s=!1){return new Di({Vu:e,methodName:t,$u:r,path:Te.emptyPath(),Cu:!1,Mu:s},this.databaseId,this.O,this.ignoreUndefinedProperties)}}function yn(n){const e=n._freezeSettings(),t=hs(n._databaseId);return new qg(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ki(n,e,t,r,s,i={}){const o=n.Fu(i.merge||i.mergeFields?2:0,e,t,s);pu("Data must be an object, but it was:",o,r);const a=Bh(r,o);let u,c;if(i.merge)u=new Rn(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const g=yu(e,f,t);if(!o.contains(g))throw new T(p.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);jh(h,g)||h.push(g)}u=new Rn(h),c=o.fieldTransforms.filter(f=>u.covers(f.field))}else u=null,c=o.fieldTransforms;return new Vg(new Re(a),u,c)}class gs extends pn{_toFieldTransform(e){if(2!==e.Vu)throw e.Ou(1===e.Vu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof gs}}function Vh(n,e,t){return new Di({Vu:3,$u:e.settings.$u,methodName:n._methodName,Cu:t},e.databaseId,e.O,e.ignoreUndefinedProperties)}class fu extends pn{_toFieldTransform(e){return new Yr(e.path,new Bn)}isEqual(e){return e instanceof fu}}class Bg extends pn{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){const t=Vh(this,e,!0),r=this.Bu.map(i=>vn(i,t)),s=new on(r);return new Yr(e.path,s)}isEqual(e){return this===e}}class Kg extends pn{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){const t=Vh(this,e,!0),r=this.Bu.map(i=>vn(i,t)),s=new an(r);return new Yr(e.path,s)}isEqual(e){return this===e}}class jg extends pn{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){const t=new Kn(e.O,Uc(e.O,this.Lu));return new Yr(e.path,t)}isEqual(e){return this===e}}function mu(n,e,t,r){const s=n.Fu(1,e,t);pu("Data must be an object, but it was:",s,r);const i=[],o=Re.empty();en(r,(u,c)=>{const h=Oi(e,u,t);c=(0,P.m9)(c);const f=s.xu(h);if(c instanceof gs)i.push(h);else{const g=vn(c,f);null!=g&&(i.push(h),o.set(h,g))}});const a=new Rn(i);return new Fh(o,a,s.fieldTransforms)}function gu(n,e,t,r,s,i){const o=n.Fu(1,e,t),a=[yu(e,r,t)],u=[s];if(i.length%2!=0)throw new T(p.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(yu(e,i[g])),u.push(i[g+1]);const c=[],h=Re.empty();for(let g=a.length-1;g>=0;--g)if(!jh(c,a[g])){const I=a[g];let x=u[g];x=(0,P.m9)(x);const O=o.xu(I);if(x instanceof gs)c.push(I);else{const V=vn(x,O);null!=V&&(c.push(I),h.set(I,V))}}const f=new Rn(c);return new Fh(h,f,o.fieldTransforms)}function qh(n,e,t,r=!1){return vn(t,n.Fu(r?4:3,e))}function vn(n,e){if(Kh(n=(0,P.m9)(n)))return pu("Unsupported field value:",e,n),Bh(n,e);if(n instanceof pn)return function(t,r){if(!Uh(r.Vu))throw r.Ou(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Ou(`${t._methodName}() is not currently supported inside arrays`);const s=t._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Cu&&4!==e.Vu)throw e.Ou("Nested arrays are not supported");return function(t,r){const s=[];let i=0;for(const o of t){let a=vn(o,r.ku(i));null==a&&(a={nullValue:"NULL_VALUE"}),s.push(a),i++}return{arrayValue:{values:s}}}(n,e)}return function(t,r){if(null===(t=(0,P.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Uc(r.O,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const s=Ee.fromDate(t);return{timestampValue:ns(r.O,s)}}if(t instanceof Ee){const s=new Ee(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ns(r.O,s)}}if(t instanceof Ni)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ut)return{bytesValue:rl(r.O,t._byteString)};if(t instanceof ae){const s=r.databaseId,i=t.firestore._databaseId;if(!i.isEqual(s))throw r.Ou(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Co(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.Ou(`Unsupported field value: ${Ci(t)}`)}(n,e)}function Bh(n,e){const t={};return Ic(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):en(n,(r,s)=>{const i=vn(s,e.Du(r));null!=i&&(t[r]=i)}),{mapValue:{fields:t}}}function Kh(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof Ee||n instanceof Ni||n instanceof Ut||n instanceof ae||n instanceof pn)}function pu(n,e,t){if(!Kh(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=Ci(t);throw e.Ou("an object"===r?n+" a custom object":n+" "+r)}var r}function yu(n,e,t){if((e=(0,P.m9)(e))instanceof Ft)return e._internalPath;if("string"==typeof e)return Oi(n,e);throw Mi("Field path arguments must be of type string or ",n,!1,void 0,t)}const Gg=new RegExp("[~\\*/\\[\\]]");function Oi(n,e,t){if(e.search(Gg)>=0)throw Mi(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ft(...e.split("."))._internalPath}catch(r){throw Mi(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Mi(n,e,t,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new T(p.INVALID_ARGUMENT,a+n+u)}function jh(n,e){return n.some(t=>t.isEqual(e))}class ps{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ae(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new $g(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ri("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class $g extends ps{data(){return super.data()}}function Ri(n,e){return"string"==typeof e?Oi(n,e):e instanceof Ft?e._internalPath:e._delegate._internalPath}class wn{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class _n extends ps{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ys(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ri("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class ys extends _n{data(e={}){return super.data(e)}}class In{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new wn(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ys(this._firestore,this._userDataWriter,r.key,r,new wn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new T(p.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let i=0;return r._snapshot.docChanges.map(o=>({type:"added",doc:new ys(r._firestore,r._userDataWriter,o.doc.key,o.doc,new wn(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:i++}))}{let i=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||3!==o.type).map(o=>{const a=new ys(r._firestore,r._userDataWriter,o.doc.key,o.doc,new wn(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,c=-1;return 0!==o.type&&(u=i.indexOf(o.doc.key),i=i.delete(o.doc.key)),1!==o.type&&(i=i.add(o.doc),c=i.indexOf(o.doc.key)),{type:zg(o.type),doc:a,oldIndex:u,newIndex:c}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function zg(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return k()}}function Qg(n,e){return n instanceof _n&&e instanceof _n?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof In&&e instanceof In&&n._firestore===e._firestore&&Mh(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function Gh(n){if(si(n)&&0===n.explicitOrderBy.length)throw new T(p.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class vs{}function Wg(n,...e){for(const t of e)n=t._apply(n);return n}class Hg extends vs{constructor(e,t,r){super(),this.Uu=e,this.qu=t,this.Ku=r,this.type="where"}_apply(e){const t=yn(e.firestore),r=function(s,i,o,a,u,c,h){let f;if(u.isKeyField()){if("array-contains"===c||"array-contains-any"===c)throw new T(p.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if("in"===c||"not-in"===c){Zh(h,c);const I=[];for(const x of h)I.push(Hh(a,s,x));f={arrayValue:{values:I}}}else f=Hh(a,s,h)}else"in"!==c&&"not-in"!==c&&"array-contains-any"!==c||Zh(h,c),f=qh(o,"where",h,"in"===c||"not-in"===c);const g=Ve.create(u,c,f);return function(I,x){if(x.S()){const V=Io(I);if(null!==V&&!V.isEqual(x.field))throw new T(p.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${V.toString()}' and '${x.field.toString()}'`);const pe=_o(I);null!==pe&&Yh(0,x.field,pe)}const O=function(V,pe){for(const qe of V.filters)if(pe.indexOf(qe.op)>=0)return qe.op;return null}(I,function(V){switch(V){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(x.op));if(null!==O)throw new T(p.INVALID_ARGUMENT,O===x.op?`Invalid query. You cannot use more than one '${x.op.toString()}' filter.`:`Invalid query. You cannot use '${x.op.toString()}' filters with '${O.toString()}' filters.`)}(s,g),g}(e._query,0,t,e.firestore._databaseId,this.Uu,this.qu,this.Ku);return new Le(e.firestore,e.converter,function(s,i){const o=s.filters.concat([i]);return new vt(s.path,s.collectionGroup,s.explicitOrderBy.slice(),o,s.limit,s.limitType,s.startAt,s.endAt)}(e._query,r))}}function Zg(n,e,t){const r=e,s=Ri("where",n);return new Hg(s,r,t)}class Yg extends vs{constructor(e,t){super(),this.Uu=e,this.Gu=t,this.type="orderBy"}_apply(e){const t=function(r,s,i){if(null!==r.startAt)throw new T(p.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new T(p.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new Un(s,i);return function(a,u){if(null===_o(a)){const c=Io(a);null!==c&&Yh(0,c,u.field)}}(r,o),o}(e._query,this.Uu,this.Gu);return new Le(e.firestore,e.converter,function(r,s){const i=r.explicitOrderBy.concat([s]);return new vt(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}function Xg(n,e="asc"){const t=e,r=Ri("orderBy",n);return new Yg(r,t)}class $h extends vs{constructor(e,t,r){super(),this.type=e,this.ju=t,this.Qu=r}_apply(e){return new Le(e.firestore,e.converter,Mc(e._query,this.ju,this.Qu))}}function Jg(n){return Dh("limit",n),new $h("limit",n,"F")}function ep(n){return Dh("limitToLast",n),new $h("limitToLast",n,"L")}class zh extends vs{constructor(e,t,r){super(),this.type=e,this.Wu=t,this.zu=r}_apply(e){const t=Wh(e,this.type,this.Wu,this.zu);return new Le(e.firestore,e.converter,(s=t,new vt((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)));var r,s}}function tp(...n){return new zh("startAt",n,!0)}function np(...n){return new zh("startAfter",n,!1)}class Qh extends vs{constructor(e,t,r){super(),this.type=e,this.Wu=t,this.zu=r}_apply(e){const t=Wh(e,this.type,this.Wu,this.zu);return new Le(e.firestore,e.converter,(s=t,new vt((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)));var r,s}}function rp(...n){return new Qh("endBefore",n,!1)}function sp(...n){return new Qh("endAt",n,!0)}function Wh(n,e,t,r){if(t[0]=(0,P.m9)(t[0]),t[0]instanceof ps)return function(s,i,o,a,u){if(!a)throw new T(p.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const c=[];for(const h of qn(s))if(h.field.isKeyField())c.push(Zs(i,a.key));else{const f=a.data.field(h.field);if(po(f))throw new T(p.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===f){const g=h.field.canonicalString();throw new T(p.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${g}' (used as the orderBy) does not exist.`)}c.push(f)}return new Fn(c,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=yn(n.firestore);return function(i,o,a,u,c,h){const f=i.explicitOrderBy;if(c.length>f.length)throw new T(p.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const g=[];for(let I=0;I<c.length;I++){const x=c[I];if(f[I].field.isKeyField()){if("string"!=typeof x)throw new T(p.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof x}`);if(!Eo(i)&&-1!==x.indexOf("/"))throw new T(p.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${x}' contains a slash.`);const O=i.path.child($.fromString(x));if(!N.isDocumentKey(O))throw new T(p.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${O}' is not because it contains an odd number of segments.`);const V=new N(O);g.push(Zs(o,V))}else{const O=qh(a,u,x);g.push(O)}}return new Fn(g,h)}(n._query,n.firestore._databaseId,s,e,t,r)}}function Hh(n,e,t){if("string"==typeof(t=(0,P.m9)(t))){if(""===t)throw new T(p.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Eo(e)&&-1!==t.indexOf("/"))throw new T(p.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child($.fromString(t));if(!N.isDocumentKey(r))throw new T(p.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Zs(n,new N(r))}if(t instanceof ae)return Zs(n,t._key);throw new T(p.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ci(t)}.`)}function Zh(n,e){if(!Array.isArray(n)||0===n.length)throw new T(p.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new T(p.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Yh(n,e,t){if(!t.isEqual(e))throw new T(p.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class vu{convertValue(e,t="none"){switch(sn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ie(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(tn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw k()}}convertObject(e,t){const r={};return en(e.fields,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertGeoPoint(e){return new Ni(ie(e.latitude),ie(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Ec(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Gr(e));default:return null}}convertTimestamp(e){const t=Nt(e);return new Ee(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=$.fromString(e);U(fl(r));const s=new nn(r.get(1),r.get(3)),i=new N(r.popFirst(5));return s.isEqual(t)||de(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Pi(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class ip extends vu{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ut(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ae(this.firestore,null,t)}}class Xh{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=yn(e)}set(e,t,r){this._verifyNotCommitted();const s=Vt(e,this._firestore),i=Pi(s.converter,t,r),o=ki(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,r);return this._mutations.push(o.toMutation(s._key,fe.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Vt(e,this._firestore);let o;return o="string"==typeof(t=(0,P.m9)(t))||t instanceof Ft?gu(this._dataReader,"WriteBatch.update",i._key,t,r,s):mu(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,fe.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Vt(e,this._firestore);return this._mutations=this._mutations.concat(new Jr(t._key,fe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new T(p.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Vt(n,e){if((n=(0,P.m9)(n)).firestore!==e)throw new T(p.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function op(n){n=B(n,ae);const e=B(n.firestore,ne);return xh(ge(e),n._key).then(t=>wu(e,n,t))}class En extends vu{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ut(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ae(this.firestore,null,t)}}function ap(n){n=B(n,ae);const e=B(n.firestore,ne),t=ge(e),r=new En(e);return function(n,e){const t=new Ie;return n.asyncQueue.enqueueAndForget((0,m.Z)(function*(){return(r=(0,m.Z)(function*(s,i,o){try{const a=yield function(u,c){const h=A(u);return h.persistence.runTransaction("read document","readonly",f=>h.Us.ys(f,c))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new T(p.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const u=rr(a,`Failed to get document '${i} from cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield uu(n),e,t);var r})),t.promise}(t,n._key).then(s=>new _n(e,r,n._key,s,new wn(null!==s&&s.hasLocalMutations,!0),n.converter))}function up(n){n=B(n,ae);const e=B(n.firestore,ne);return xh(ge(e),n._key,{source:"server"}).then(t=>wu(e,n,t))}function cp(n){n=B(n,Le);const e=B(n.firestore,ne),t=ge(e),r=new En(e);return Gh(n._query),Sh(t,n._query).then(s=>new In(e,r,n,s))}function lp(n){n=B(n,Le);const e=B(n.firestore,ne),t=ge(e),r=new En(e);return function(n,e){const t=new Ie;return n.asyncQueue.enqueueAndForget((0,m.Z)(function*(){return(r=(0,m.Z)(function*(s,i,o){try{const a=yield _i(s,i,!0),u=new hh(i,a.Ks),c=u.Ic(a.documents),h=u.applyChanges(c,!1);o.resolve(h.snapshot)}catch(a){const u=rr(a,`Failed to execute query '${i} against cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield uu(n),e,t);var r})),t.promise}(t,n._query).then(s=>new In(e,r,n,s))}function hp(n){n=B(n,Le);const e=B(n.firestore,ne),t=ge(e),r=new En(e);return Sh(t,n._query,{source:"server"}).then(s=>new In(e,r,n,s))}function dp(n,e,t){n=B(n,ae);const r=B(n.firestore,ne),s=Pi(n.converter,e,t);return ur(r,[ki(yn(r),"setDoc",n._key,s,null!==n.converter,t).toMutation(n._key,fe.none())])}function fp(n,e,t,...r){n=B(n,ae);const s=B(n.firestore,ne),i=yn(s);let o;return o="string"==typeof(e=(0,P.m9)(e))||e instanceof Ft?gu(i,"updateDoc",n._key,e,t,r):mu(i,"updateDoc",n._key,e),ur(s,[o.toMutation(n._key,fe.exists(!0))])}function mp(n){return ur(B(n.firestore,ne),[new Jr(n._key,fe.none())])}function gp(n,e){const t=B(n.firestore,ne),r=Oh(n),s=Pi(n.converter,e);return ur(t,[ki(yn(n.firestore),"addDoc",r._key,s,null!==n.converter,{}).toMutation(r._key,fe.exists(!1))]).then(()=>r)}function pp(n,...e){var t,r,s;n=(0,P.m9)(n);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||du(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(du(e[o])){const f=e[o];e[o]=null===(t=f.next)||void 0===t?void 0:t.bind(f),e[o+1]=null===(r=f.error)||void 0===r?void 0:r.bind(f),e[o+2]=null===(s=f.complete)||void 0===s?void 0:s.bind(f)}let u,c,h;if(n instanceof ae)c=B(n.firestore,ne),h=Vn(n._key.path),u={next:f=>{e[o]&&e[o](wu(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=B(n,Le);c=B(f.firestore,ne),h=f._query;const g=new En(c);u={next:I=>{e[o]&&e[o](new In(c,g,f,I))},error:e[o+1],complete:e[o+2]},Gh(n._query)}return function(f,g,I,x){const O=new bi(x),V=new Da(g,O,I);return f.asyncQueue.enqueueAndForget((0,m.Z)(function*(){return Sa(yield ar(f),V)})),()=>{O.Jc(),f.asyncQueue.enqueueAndForget((0,m.Z)(function*(){return Aa(yield ar(f),V)}))}}(ge(c),h,a,u)}function yp(n,e){return function(n,e){const t=new bi(e);return n.asyncQueue.enqueueAndForget((0,m.Z)(function*(){return r=yield ar(n),s=t,A(r).Zo.add(s),void s.next();var r,s})),()=>{t.Jc(),n.asyncQueue.enqueueAndForget((0,m.Z)(function*(){return r=yield ar(n),s=t,void A(r).Zo.delete(s);var r,s}))}}(ge(n=B(n,ne)),du(e)?e:{next:e})}function ur(n,e){return function(t,r){const s=new Ie;return t.asyncQueue.enqueueAndForget((0,m.Z)(function*(){return function(n,e,t){return Pa.apply(this,arguments)}(yield cu(t),r,s)})),s.promise}(ge(n),e)}function wu(n,e,t){const r=t.docs.get(e._key),s=new En(n);return new _n(n,s,e._key,r,new wn(t.hasPendingWrites,t.fromCache),e.converter)}class vp extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=yn(e)}get(e){const t=Vt(e,this._firestore),r=new ip(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||1!==s.length)return k();const i=s[0];if(i.isFoundDocument())return new ps(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new ps(this._firestore,r,t._key,null,t.converter);throw k()})}set(e,t,r){const s=Vt(e,this._firestore),i=Pi(s.converter,t,r),o=ki(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=Vt(e,this._firestore);let o;return o="string"==typeof(t=(0,P.m9)(t))||t instanceof Ft?gu(this._dataReader,"Transaction.update",i._key,t,r,s):mu(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=Vt(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Vt(e,this._firestore),r=new En(this._firestore);return super.get(e).then(s=>new _n(this._firestore,r,t._key,s._document,new wn(!1,!1),t.converter))}}function wp(n,e){return function(n,e){const t=new Ie;return n.asyncQueue.enqueueAndForget((0,m.Z)(function*(){const r=yield(s=n,Ai(s).then(i=>i.datastore));var s;new fg(n.asyncQueue,r,e,t).run()})),t.promise}(ge(n=B(n,ne)),t=>e(new vp(n,t)))}function _p(){return new gs("deleteField")}function Ip(){return new fu("serverTimestamp")}function Ep(...n){return new Bg("arrayUnion",n)}function Tp(...n){return new Kg("arrayRemove",n)}function xp(n){return new jg("increment",n)}!function(n,e=!0){On=Z.SDK_VERSION,(0,Z._registerComponent)(new w.wA("firestore",(t,{options:r})=>{const s=t.getProvider("app").getImmediate(),i=new ne(s,new qd(t.getProvider("auth-internal")),new jd(t.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i},"PUBLIC")),(0,Z.registerVersion)(gc,"3.4.5",n),(0,Z.registerVersion)(gc,"3.4.5","esm2017")}()},7264:(It,Ne,D)=>{D.d(Ne,{M:()=>P});var m=D(6274),Z=D(8718),w=D(5018),j=D(2741);let P=(()=>{class L{}return L.\u0275fac=function(S){return new(S||L)},L.\u0275mod=j.\u0275\u0275defineNgModule({type:L}),L.\u0275inj=j.\u0275\u0275defineInjector({imports:[[m.ez,Z.Bz,w.p]]}),L})()},8088:(It,Ne,D)=>{D.d(Ne,{D:()=>Tt});var m=D(1580),Z=D(4197),w=D(2741),j=D(8718),P=D(6491),L=D(9475),W=D(6274);const S=["connectionToastComponentReference"];function ce(Y,je){1&Y&&w.\u0275\u0275element(0,"div")}function R(Y,je){1&Y&&(w.\u0275\u0275elementStart(0,"div",8),w.\u0275\u0275elementStart(1,"button",9),w.\u0275\u0275text(2,"Log in"),w.\u0275\u0275elementEnd(),w.\u0275\u0275elementStart(3,"button",10),w.\u0275\u0275text(4,"Sign up"),w.\u0275\u0275elementEnd(),w.\u0275\u0275elementEnd()),2&Y&&(w.\u0275\u0275advance(1),w.\u0275\u0275property("routerLink","/auth/login"),w.\u0275\u0275advance(2),w.\u0275\u0275property("routerLink","/auth/signup"))}function He(Y,je){if(1&Y&&(w.\u0275\u0275elementStart(0,"li"),w.\u0275\u0275elementStart(1,"a",22),w.\u0275\u0275element(2,"i",23),w.\u0275\u0275text(3,"nR Personal"),w.\u0275\u0275elementEnd(),w.\u0275\u0275elementEnd()),2&Y){const M=w.\u0275\u0275nextContext(4);w.\u0275\u0275advance(1),w.\u0275\u0275property("href",M.personalUrl,w.\u0275\u0275sanitizeUrl)}}function ve(Y,je){1&Y&&w.\u0275\u0275element(0,"div",18)}function tt(Y,je){if(1&Y){const M=w.\u0275\u0275getCurrentView();w.\u0275\u0275elementStart(0,"div",11),w.\u0275\u0275elementStart(1,"a",12),w.\u0275\u0275element(2,"img",13),w.\u0275\u0275elementEnd(),w.\u0275\u0275elementStart(3,"ul",14),w.\u0275\u0275elementStart(4,"li",15),w.\u0275\u0275elementStart(5,"p",16),w.\u0275\u0275text(6),w.\u0275\u0275elementEnd(),w.\u0275\u0275elementStart(7,"p",17),w.\u0275\u0275text(8),w.\u0275\u0275elementEnd(),w.\u0275\u0275elementEnd(),w.\u0275\u0275element(9,"div",18),w.\u0275\u0275template(10,He,4,1,"li",3),w.\u0275\u0275template(11,ve,1,0,"div",19),w.\u0275\u0275elementStart(12,"li"),w.\u0275\u0275elementStart(13,"a",20),w.\u0275\u0275listener("click",function(H){return w.\u0275\u0275restoreView(M),w.\u0275\u0275nextContext(3).logout(H)}),w.\u0275\u0275element(14,"i",21),w.\u0275\u0275text(15,"Logout"),w.\u0275\u0275elementEnd(),w.\u0275\u0275elementEnd(),w.\u0275\u0275elementEnd(),w.\u0275\u0275elementEnd()}if(2&Y){const M=w.\u0275\u0275nextContext(3);w.\u0275\u0275advance(2),w.\u0275\u0275property("src",M.photo,w.\u0275\u0275sanitizeUrl),w.\u0275\u0275advance(4),w.\u0275\u0275textInterpolate(M.name),w.\u0275\u0275advance(2),w.\u0275\u0275textInterpolate(M.email),w.\u0275\u0275advance(2),w.\u0275\u0275property("ngIf","Personal"!=M.source),w.\u0275\u0275advance(1),w.\u0275\u0275property("ngIf","Personal"!=M.source)}}function lr(Y,je){if(1&Y&&(w.\u0275\u0275elementStart(0,"div"),w.\u0275\u0275template(1,ce,1,0,"div",5),w.\u0275\u0275template(2,R,5,2,"ng-template",null,6,w.\u0275\u0275templateRefExtractor),w.\u0275\u0275template(4,tt,16,5,"ng-template",null,7,w.\u0275\u0275templateRefExtractor),w.\u0275\u0275elementEnd()),2&Y){const M=w.\u0275\u0275reference(3),_=w.\u0275\u0275reference(5),H=w.\u0275\u0275nextContext(2);w.\u0275\u0275advance(1),w.\u0275\u0275property("ngIf",H.isLoggedIn)("ngIfThen",_)("ngIfElse",M)}}function Et(Y,je){if(1&Y&&(w.\u0275\u0275elementStart(0,"div"),w.\u0275\u0275template(1,lr,6,3,"div",3),w.\u0275\u0275elementEnd()),2&Y){const M=w.\u0275\u0275nextContext();w.\u0275\u0275advance(1),w.\u0275\u0275property("ngIf",!M.isAuthLoading)}}let Tt=(()=>{class Y{constructor(M,_,H){this.router=M,this.authApi=_,this.userApi=H,this.source="Application",this.navBrand="NetRink",this.isForms=!1,this.personalUrl=Z.N.personalUrl,this.isLoggedIn=!1,this.isAuthLoading=!1,this.name="",this.email="",this.photo="../../../../assets/images/utilities/photo-avatar.jpg"}ngOnInit(){this.getAuth(),this.getUser(),this.isForms||this.setSource()}setSource(){sessionStorage.setItem("app_source",this.navBrand)}getAuth(){this.isAuthLoading=!0,this.authApi.getAuth().subscribe(M=>{console.log(M),this.isAuthLoading=!1,M.emailVerified&&(this.isLoggedIn=!0,this.email=M.email)},M=>{console.log(M),this.isLoggedIn=!1,this.isAuthLoading=!1,localStorage.getItem("personal_id")&&this.connectionToast.openToast()})}getUser(){this.userApi.getUser().then(M=>{console.log(M),this.userData=M.data(),this.name=this.userData.first_name,""!=this.userData.photo&&(this.photo=this.userData.photo)},M=>{console.log(M),localStorage.getItem("personal_id")&&this.connectionToast.openToast()})}logout(M){M.stopPropagation(),console.log("u logging out? ...where u going?"),this.authApi.logout().then(_=>{console.log(_),localStorage.removeItem("personal_id"),localStorage.removeItem("hospital_id"),localStorage.removeItem("restaurant_id"),localStorage.removeItem("school_id"),localStorage.removeItem("enterprise_id"),localStorage.removeItem("association_id"),localStorage.removeItem("hotel_id"),localStorage.removeItem("shop_id"),localStorage.removeItem("production_id"),window.location.href="/"},_=>{console.log(_),this.connectionToast.openToast()})}}return Y.\u0275fac=function(M){return new(M||Y)(w.\u0275\u0275directiveInject(j.F0),w.\u0275\u0275directiveInject(P.Q),w.\u0275\u0275directiveInject(L.Q))},Y.\u0275cmp=w.\u0275\u0275defineComponent({type:Y,selectors:[["app-main-navbar"]],viewQuery:function(M,_){if(1&M&&w.\u0275\u0275viewQuery(S,5,m.Y),2&M){let H;w.\u0275\u0275queryRefresh(H=w.\u0275\u0275loadQuery())&&(_.connectionToast=H.first)}},inputs:{source:"source",navBrand:"navBrand",isForms:"isForms"},decls:7,vars:3,consts:[[1,"navbar","navbar-dark","bg-dark"],[1,"container"],[1,"navbar-brand",3,"routerLink"],[4,"ngIf"],["connectionToastComponentReference",""],[4,"ngIf","ngIfThen","ngIfElse"],["notLoggedinBlock",""],["loggedinBlock",""],[1,"d-flex","auth-btns"],["type","button",1,"btn","btn-secondary",3,"routerLink"],["type","button",1,"btn","btn-secondary","ms-2",3,"routerLink"],[1,"dropdown"],["href","#","role","button","id","dropdownMenuLink","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","btn-outline-light","dropdown-toggle","user-btn"],["width","26","height","26",1,"rounded-circle","border",3,"src"],["aria-labelledby","dropdownMenuLink",1,"dropdown-menu"],[1,"ms-3","me-2"],[1,"lead","mb-0","user-info"],[1,"small","text-muted","mb-0","user-info"],[1,"dropdown-divider"],["class","dropdown-divider",4,"ngIf"],["href","#",1,"dropdown-item",3,"click"],[1,"bi","bi-box-arrow-right","me-2"],["target","blank",1,"dropdown-item",3,"href"],[1,"bi","bi-person","me-2"]],template:function(M,_){1&M&&(w.\u0275\u0275elementStart(0,"nav",0),w.\u0275\u0275elementStart(1,"div",1),w.\u0275\u0275elementStart(2,"a",2),w.\u0275\u0275text(3),w.\u0275\u0275elementEnd(),w.\u0275\u0275template(4,Et,2,1,"div",3),w.\u0275\u0275elementEnd(),w.\u0275\u0275elementEnd(),w.\u0275\u0275element(5,"app-connection-toast",null,4)),2&M&&(w.\u0275\u0275advance(2),w.\u0275\u0275property("routerLink","/"),w.\u0275\u0275advance(1),w.\u0275\u0275textInterpolate(_.navBrand),w.\u0275\u0275advance(1),w.\u0275\u0275property("ngIf",!_.isForms))},directives:[j.yS,W.O5,m.Y,j.rH],styles:[".navbar-brand[_ngcontent-%COMP%]{font-size:26px}.auth-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:90px}.btn-outline-light[_ngcontent-%COMP%]:hover, .btn-outline-light[_ngcontent-%COMP%]:visited, .btn-outline-light[_ngcontent-%COMP%]:focus, .btn-outline-light[_ngcontent-%COMP%]:active{color:#f8f9fc;background-color:transparent}.dropdown-menu[_ngcontent-%COMP%]{z-index:1100;max-width:150px}.user-btn[_ngcontent-%COMP%]{border-radius:20px}.user-info[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]}),Y})()},1580:(It,Ne,D)=>{D.d(Ne,{Y:()=>j});var m=D(2741),Z=D(6274);const w=["buttonElementReference"];let j=(()=>{class P{constructor(){this.isShowToast=!1}ngOnInit(){}openToast(){console.log("opening connection toast"),this.isShowToast=!0,this.timer=setInterval(()=>{this.hideToast()},3e3)}hideToast(){this.isShowToast=!1,clearInterval(this.timer),console.log("closing toast...")}}return P.\u0275fac=function(W){return new(W||P)},P.\u0275cmp=m.\u0275\u0275defineComponent({type:P,selectors:[["app-connection-toast"]],viewQuery:function(W,S){if(1&W&&m.\u0275\u0275viewQuery(w,5,m.ElementRef),2&W){let ce;m.\u0275\u0275queryRefresh(ce=m.\u0275\u0275loadQuery())&&(S.buttonElement=ce.first)}},decls:5,vars:1,consts:[[1,"position-fixed","bottom-0","end-0","p-3",2,"z-index","11"],["id","liveToast","role","alert","aria-live","assertive","aria-atomic","true",1,"toast","text-white","bg-danger","border-0","connection-toast",3,"ngClass"],[1,"toast-body","p-3"],[1,"h4","bi","bi-x-circle","me-3"]],template:function(W,S){1&W&&(m.\u0275\u0275elementStart(0,"div",0),m.\u0275\u0275elementStart(1,"div",1),m.\u0275\u0275elementStart(2,"div",2),m.\u0275\u0275element(3,"i",3),m.\u0275\u0275text(4," Could not connect. "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&W&&(m.\u0275\u0275advance(1),m.\u0275\u0275property("ngClass",S.isShowToast?"show":"hide"))},directives:[Z.mk],styles:[""]}),P})()},5018:(It,Ne,D)=>{D.d(Ne,{p:()=>P});var m=D(6274),Z=D(8718),w=D(3324),j=D(2741);let P=(()=>{class L{}return L.\u0275fac=function(S){return new(S||L)},L.\u0275mod=j.\u0275\u0275defineNgModule({type:L}),L.\u0275inj=j.\u0275\u0275defineInjector({imports:[[m.ez,Z.Bz,w.u5]]}),L})()},6491:(It,Ne,D)=>{D.d(Ne,{Q:()=>P});var m=D(1921),Z=D(4197),w=D(2741),j=D(4259);let P=(()=>{class L{constructor(S){this.afAuth=S}login(S,ce){return this.afAuth.signInWithEmailAndPassword(S,ce)}signup(S,ce){return this.afAuth.createUserWithEmailAndPassword(S,ce)}sendEmailVerification(){var S=this;return(0,m.Z)(function*(){var ce;yield S.afAuth.currentUser.then(ve=>ce=ve);const He=`${S.getBaseUrl()}/auth/signup-success?id=${ce.uid}&email=${ce.email}`;return ce.sendEmailVerification({url:He})})()}sendPasswordResetEmail(S){return this.getBaseUrl(),this.afAuth.sendPasswordResetEmail(S)}logout(){return this.afAuth.signOut()}getAuth(){return this.afAuth.authState}getBaseUrl(){switch(sessionStorage.getItem("app_source")){case"netRink":return Z.N.baseUrl;case"nR Personal":return Z.N.personalUrl;case"nR Restaurant":return Z.N.restaurantUrl;case"nR School":return Z.N.schoolUrl;case"nR Enterprise":return Z.N.enterpriseUrl;case"nR Association":return Z.N.associationUrl;case"nR Hospital":return Z.N.hospitalUrl;case"nR Hotel":return Z.N.hotelUrl;case"nR Shop":return Z.N.shopUrl;case"nR Production":return Z.N.productionUrl;default:return Z.N.baseUrl}}}return L.\u0275fac=function(S){return new(S||L)(w.\u0275\u0275inject(j.zQ))},L.\u0275prov=w.\u0275\u0275defineInjectable({token:L,factory:L.\u0275fac,providedIn:"root"}),L})()},9475:(It,Ne,D)=>{D.d(Ne,{Q:()=>w});var m=D(2741),Z=D(9805);let w=(()=>{class j{constructor(L){this.afs=L,this.userRef=this.afs.collection("personal/users/personal_user")}createUser(L,W){return this.userRef.doc(L).set(W)}updateUser(L){return this.userRef.doc(String(localStorage.getItem("personal_id"))).update(L)}getUser(){return this.userRef.doc(String(localStorage.getItem("personal_id"))).ref.get()}}return j.\u0275fac=function(L){return new(L||j)(m.\u0275\u0275inject(Z.ST))},j.\u0275prov=m.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac,providedIn:"root"}),j})()},4197:(It,Ne,D)=>{D.d(Ne,{N:()=>m});const m={production:!1,baseUrl:"https://netrink-test-v1.web.app/",personalUrl:"https://netrink-test-personal-v1.web.app/",restaurantUrl:"https://netrink-test-restaurant-v1.web.app/",schoolUrl:"https://netrink-test-school-v1.web.app/",enterpriseUrl:"https://netrink-test-enterprise-v1.web.app/",associationUrl:"https://netrink-test-association-v1.web.app/",hospitalUrl:"https://netrink-test-hospital-v1.web.app/",hotelUrl:"https://netrink-test-hotel-v1.web.app/",shopUrl:"https://netrink-test-shop-v1.web.app/",productionUrl:"https://netrink-test-production-v1.web.app/",firebase:{apiKey:"AIzaSyC-pUZi6j5AecjEKiBaQL1nTZrKWB_J9w0",authDomain:"netrink-test-v1.firebaseapp.com",projectId:"netrink-test-v1",storageBucket:"netrink-test-v1.appspot.com",messagingSenderId:"140608103001",appId:"1:140608103001:web:ab3a30ff3ab42a3e78c748"}}}}]);